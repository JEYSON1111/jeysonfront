{"remainingRequest":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\pedidos2\\pedidos\\institucion\\ScreenInstitucion.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\pedidos2\\pedidos\\institucion\\ScreenInstitucion.vue","mtime":1712682816408},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\n  import {\r\n    mapState\r\n} from \"vuex\";\r\n  import flatPickr from 'vue-flatpickr-component';\r\n  import 'flatpickr/dist/flatpickr.css';\r\n  import vSelect from 'vue-select';\r\n  import axios from 'axios'\r\n  import PedidosRepository from \"../../../../repositories/PedidosRepository\";\r\n  export default {\r\n      components:{\r\n        flatPickr,\r\n        'v-select': vSelect,\r\n      },\r\n      data: () => ({\r\n        usuario:[],\r\n        pedido:{\r\n          id_pedido:0,\r\n          institucion:'',\r\n          asesor:'',\r\n          ruc:'',\r\n          direccionInstitucion:'',\r\n          nivel:'',\r\n          tipo_descripcion:'',\r\n          telefonoInstitucion:'',\r\n          periodo:'',\r\n          idperiodo:'',\r\n          tipo_venta:'',\r\n          fecha_envio:'',\r\n          fecha_entrega:'',\r\n          descuento:'',\r\n          estado:0,\r\n          contrato_generado:'',\r\n          id_asesor:0,\r\n          facturacion_vee:0,\r\n          observacion:'',\r\n        },\r\n        Eselect:'',\r\n        arrayInstituciones:[],\r\n        arrayPeriodos:[],\r\n        arregloNivel:[\r\n          {\r\n            id:1,\r\n            label:'Educación General Básica'\r\n          },\r\n          {\r\n            id:2,\r\n            label:'Bachillerato General Unificado'\r\n          },\r\n        ],\r\n        tiposEscuelas:[\r\n          \"Esc. Particulares\",\r\n          \"Esc. Fiscomisional\",\r\n          \"Esc. Fiscal\",\r\n        ],\r\n        tipos_venta: [\r\n          {id_tipo: 1, tipo_venta: 'Directa'},\r\n          {id_tipo: 2, tipo_venta: 'Comisión o lista'},\r\n        ],\r\n        configdateTimePicker: {\r\n          enableTime: true,\r\n          dateFormat: 'Y-m-d'\r\n        },\r\n        sendPedido:'',\r\n        counterDanger: false,\r\n        //variables de comentarios\r\n        comentarios:[],\r\n        popupComentarios:false,\r\n        input_comentario:'',\r\n        //fin variables de comentarios\r\n      }),\r\n      mounted() {\r\n        let me = this\r\n        this.usuario = JSON.parse(localStorage.getItem('usuario'));\r\n        this.setDatos()\r\n      },\r\n      computed:{\r\n        ...mapState([\"auth\",'userRoot','susuario','ObjectPedido','userAsesor']),\r\n      },\r\n      methods: {\r\n        setDatos(){\r\n          let me = this;\r\n          me.sendPedido = me.ObjectPedido\r\n          //crear\r\n          if(me.sendPedido.id_pedido == 0){\r\n            me.getInstituciones(me.usuario.cedula)\r\n            me.limpiar()\r\n          }\r\n          //editar\r\n          else{\r\n            me.getInstituciones(me.sendPedido.cedula_asesor)\r\n            me.pedido = {\r\n              id_pedido:            me.sendPedido.id_pedido,\r\n              estado:               me.sendPedido.estado,\r\n              institucion:          me.sendPedido.id_institucion,\r\n              asesor:               me.sendPedido.responsable,\r\n              ruc:                  me.sendPedido.ruc,\r\n              direccionInstitucion: me.sendPedido.direccionInstitucion,\r\n              nivel:                me.sendPedido.nivel,\r\n              tipo_descripcion:     me.sendPedido.tipo_descripcion,\r\n              telefonoInstitucion:  me.sendPedido.telefonoInstitucion,\r\n              periodo:              me.sendPedido.periodo,\r\n              idperiodo:            me.sendPedido.id_periodo,\r\n              tipo_venta:           me.sendPedido.tipo_venta,\r\n              fecha_envio:          me.sendPedido.fecha_envio,\r\n              fecha_entrega:        me.sendPedido.fecha_entrega,\r\n              descuento:            me.sendPedido.descuento,\r\n              contrato_generado:    me.sendPedido.contrato_generado,\r\n              id_asesor:            me.sendPedido.id_asesor,\r\n              facturacion_vee:      me.sendPedido.facturacion_vee,\r\n              observacion:          me.sendPedido.observacion\r\n            }\r\n          }\r\n        },\r\n        getInstituciones(cedula){\r\n          let me = this\r\n          this.$http.get(this.$server_url+'get_instituciones_asesor/'+cedula)\r\n          .then(res => {\r\n              me.arrayInstituciones = res.data\r\n          })\r\n        },\r\n        guardarPedido(){\r\n          let me = this\r\n          if(me.sendPedido.estado == 2){\r\n            me.$vs.notify({\r\n              color: 'warning',\r\n              title: 'Mensaje',\r\n              text: 'No se puede modificar el pedido anulado',\r\n              time:5000,\r\n              })\r\n            return false\r\n          }\r\n          if(me.pedido.ruc == \"\" || me.pedido.ruc == \"null\"){\r\n            me.$vs.notify({\r\n              color: 'warning',\r\n              title: 'Mensaje',\r\n              text: 'El ruc no puede quedar vacio',\r\n              time:5000,\r\n              })\r\n            return false\r\n          }\r\n          if(me.codigo_institucion_milton == '22507'){\r\n            me.$vs.notify({\r\n              color: 'warning',\r\n              title: 'Mensaje',\r\n              text: 'El id institución hay que cambiar informar a soporte por favor',\r\n              time:5000,\r\n              })\r\n            return false\r\n          }\r\n          if(me.pedido.contrato_generado == null || me.pedido.contrato_generado == \"null\" || me.pedido.contrato_generado == \"\"){\r\n          }else{\r\n            me.$vs.notify({\r\n              color: 'warning',\r\n              title: 'Mensaje',\r\n              text: 'El pedido ya tiene el contrato ' + me.pedido.contrato_generado +\" No puede realizar cambios\"\r\n              })\r\n            return false;\r\n          }\r\n          if(me.pedido.nivel == null || me.pedido.nivel == \"\" || me.pedido.nivel == undefined){\r\n            me.$vs.notify({\r\n              color: 'warning',\r\n              title: 'Mensaje',\r\n              text: 'Seleccione un nivel por favor'\r\n              })\r\n            return false;\r\n          }\r\n          if( me.pedido.idperiodo == '' || me.pedido.tipo_venta == '' || me.pedido.fecha_envio == '' || me.pedido.fecha_entrega == '' || me.pedido.institucion == '' || me.pedido.direccionInstitucion == '' || me.pedido.ruc == '' || me.pedido.tipo_descripcion == '' || me.pedido.telefonoInstitucion == ''){\r\n            me.$vs.notify({ text: 'Llene todos los campos antes de guardar.', color: 'warning', iconPack: 'feather', icon: 'icon-alert-triangle' })\r\n            return\r\n          }\r\n          let formData = new FormData();\r\n          formData.append('informacionPedido',   'yes');\r\n          formData.append('id_pedido',            me.pedido.id_pedido);\r\n          formData.append('tipo_venta',           me.pedido.tipo_venta);\r\n          formData.append('tipo_venta_descr',     me.pedido.tipo_venta == 1 ? 'Venta directa' : 'Comisión o lista');\r\n          formData.append('fecha_envio',          me.pedido.fecha_envio);\r\n          formData.append('fecha_entrega',        me.pedido.fecha_entrega);\r\n          formData.append('institucion',          me.pedido.institucion);\r\n          formData.append('periodo',              me.pedido.idperiodo);\r\n          formData.append('descuento',            me.pedido.descuento);\r\n          formData.append('id_asesor',            me.pedido.id_asesor);\r\n          formData.append('facturacion_vee',      me.pedido.facturacion_vee);\r\n          formData.append('observacion',          me.pedido.observacion);\r\n          //para actualizar la institucion\r\n          formData.append('ruc',                  me.pedido.ruc);\r\n          formData.append('direccionInstitucion', me.pedido.direccionInstitucion);\r\n          formData.append('nivel',                me.pedido.nivel);\r\n          formData.append('tipo_descripcion',     me.pedido.tipo_descripcion);\r\n          formData.append('telefonoInstitucion',  me.pedido.telefonoInstitucion);\r\n          //fin para actualizar la institucion\r\n          me.$vs.loading();\r\n          //axios.post(this.$data_url+'api/guardarPedido',formData)\r\n          this.$http.post(this.$server_url+'pedidos', formData)\r\n          .then(res => {\r\n            me.$vs.loading.close();\r\n            if(res.data.status == 0){\r\n              me.$vs.notify({ text: res.data.message, color: 'danger', iconPack: 'feather', icon: 'icon-check', time:8000 })\r\n              return\r\n            }\r\n            if( res.data.error ){\r\n              alert(res.data.error)\r\n              return\r\n            }else{\r\n              me.$vs.notify({\r\n              color: 'primary',\r\n              title: 'Mensaje',\r\n              text: 'Se guardo correctamente'\r\n              })\r\n              me.rechargePedido(res.data.pedido.id_pedido)\r\n\r\n            }\r\n          })\r\n          .catch(err => {\r\n            console.log(err)\r\n            me.$vs.loading.close();\r\n          })\r\n        },\r\n        rechargePedido(id_pedido){\r\n          let me = this\r\n          PedidosRepository.getPedidoXID(id_pedido).then(r => { this.$store.dispatch('setPedido',r.data[0]); this.setDatos(); })\r\n        },\r\n        buscaPedidoGenerado(tr){\r\n          let me = this\r\n          //limpiar\r\n          me.pedido.ruc                   = \"\"\r\n          me.pedido.direccionInstitucion  = \"\"\r\n          me.pedido.nivel                 = \"\"\r\n          me.pedido.tipo_descripcion      = \"\"\r\n          me.pedido.telefonoInstitucion   = \"\"\r\n          if(me.pedido.institucion == null || me.pedido.institucion == \"\" || me.pedido.institucion == undefined){\r\n            me.$vs.notify({\r\n            text:'Seleccione una institución por favor',\r\n            color:'warning',\r\n            iconPack: 'feather',\r\n            icon:'icon-check'})\r\n            return\r\n          }\r\n          //proceso\r\n          let setValores                  = me.arrayInstituciones.filter(p => p.idInstitucion == me.pedido.institucion)[0]\r\n          me.pedido.ruc                   = setValores.ruc\r\n          me.pedido.direccionInstitucion  = setValores.direccionInstitucion\r\n          me.pedido.nivel                 = setValores.nivel\r\n          me.pedido.tipo_descripcion      = setValores.tipo_descripcion\r\n          me.pedido.telefonoInstitucion   = setValores.telefonoInstitucion\r\n          localStorage.setItem(\"institucion_selected_pedido\", me.pedido.institucion)\r\n          localStorage.setItem(\"id_asesor_pedido\", me.pedido.id_asesor)\r\n        },\r\n          //METODOS PARA COMENTARIOS\r\n        ver_comentarios(){\r\n          let me = this\r\n          me.$vs.loading();\r\n          this.$http.get(this.$server_url+'get_comentarios_pedido/'+me.pedido.id_pedido)\r\n          .then(res => {\r\n            me.comentarios = res.data\r\n            // me.cant_sms = res.data.length\r\n            me.$vs.loading.close();\r\n          })\r\n          .catch(err => {\r\n            me.$vs.loading.close();\r\n          })\r\n        },\r\n        guardar_comentario(){\r\n          let me = this\r\n          let formData = new FormData();\r\n          formData.append('id_pedido',  me.pedido.id_pedido);\r\n          formData.append('comentario', me.input_comentario);\r\n          formData.append('id_usuario', me.usuario.idusuario);\r\n          formData.append('id_group',   me.usuario.id_group)\r\n          me.$vs.loading();\r\n          this.$http.post(this.$server_url+'guardar_comentario', formData)\r\n          .then(res => {\r\n            me.input_comentario = ''\r\n            me.ver_comentarios()\r\n            me.$vs.loading.close();\r\n          })\r\n          .catch(err => {\r\n            console.log(err)\r\n              me.$vs.loading.close();\r\n          })\r\n        },\r\n        limpiar(){\r\n          let me = this;\r\n          me.pedido = {\r\n            id_pedido:               0,\r\n            estado:0,\r\n            institucion:'',\r\n            asesor:                   me.usuario.nombres + \" \"+me.usuario.apellidos,\r\n            ruc:'',\r\n            direccionInstitucion:'',\r\n            nivel:'',\r\n            tipo_descripcion:'',\r\n            telefonoInstitucion:'',\r\n            periodo:                me.sendPedido.periodo,\r\n            idperiodo:              me.sendPedido.id_periodo,\r\n            tipo_venta:'',\r\n            fecha_envio:'',\r\n            fecha_entrega:'',\r\n            descuento:'',\r\n            contrato_generado:'',\r\n            id_asesor:                me.usuario.idusuario,\r\n            facturacion_vee:          0,\r\n            observacion:              ''\r\n          }\r\n        }\r\n      },\r\n  }\r\n  ",{"version":3,"sources":["ScreenInstitucion.vue"],"names":[],"mappings":";AA4FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ScreenInstitucion.vue","sourceRoot":"src/views/pedidos2/pedidos/institucion","sourcesContent":["<template>\r\n    <vx-card\r\n    :title=\"sendPedido.id_pedido == 0 ? 'Crear Pedido':'Informacion Pedido #'+sendPedido.id_pedido\"\r\n    >\r\n      <div class=\"vx-row\">\r\n        <div class=\"vx-col md:w-4/5 w-full mb-3\">\r\n          <div class=\"label_inputs\">Institución</div>\r\n          <v-select :options=\"arrayInstituciones\" :reduce=\"arrayInstituciones => arrayInstituciones.idInstitucion\" label=\"nombre_institucion\" v-model=\"pedido.institucion\" class=\"w-full\" @input=\"buscaPedidoGenerado(pedido.institucion)\" />\r\n        </div>\r\n        <div class=\"vx-col md:w-1/5 w-full mb-3\">\r\n          <div class=\"label_inputs\">Asesor</div>\r\n          <p style=\"font-weight: 500;\" class=\"text-primary\">{{pedido.asesor}}</p>\r\n        </div>\r\n        <div class=\"vx-col lg:w-1/3 md:w-full sm:w-full mb-base\">\r\n          <vs-input type=\"text\" label=\"Ruc institución\" v-model=\"pedido.ruc\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col lg:w-1/3 md:w-full sm:w-full mb-base\">\r\n          <vs-input type=\"text\" label=\"Dirección institución\" v-model=\"pedido.direccionInstitucion\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col lg:w-1/3 md:w-full sm:w-full mb-base\">\r\n          <div class=\"label_inputs\">Nivel</div>\r\n          <v-select :options=\"arregloNivel\" :reduce=\"arregloNivel => arregloNivel.id\" label=\"label\" v-model=\"pedido.nivel\" class=\"w-full\" />\r\n        </div>\r\n        <!--ESC PARTICULARES-->\r\n        <div class=\"vx-col lg:w-1/3 md:w-full sm:w-full mb-base\">\r\n          <div class=\"label_inputs\">Seleccione el tipo de escuela:</div>\r\n          <v-select :options=\"tiposEscuelas\" @input=\"pedido.tipo_descripcion = Eselect\" :reduce=\"tiposEscuelas => tiposEscuelas\" v-model=\"Eselect\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col lg:w-1/3 md:w-full sm:w-full mb-base\">\r\n          <vs-input type=\"text\" label=\"Tipo institución(Ejem. Esc. Particulares)\" disabled placeholder=\"Ejem. Esc. Particulares\" v-model=\"pedido.tipo_descripcion\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col lg:w-1/3 md:w-full sm:w-full mb-base\">\r\n          <vs-input type=\"number\" label=\"Télefono institución\" v-model=\"pedido.telefonoInstitucion\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col lg:w-1/3 md:w-full sm:w-full mb-3\">\r\n          <vs-input type=\"text\" label=\"Período\" disabled v-model=\"pedido.periodo\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col lg:w-1/3 md:w-full sm:w-full mb-3\">\r\n          <div class=\"label_inputs\">Tipo de venta</div>\r\n          <v-select :options=\"tipos_venta\" :reduce=\"tipos_venta => tipos_venta.id_tipo\" label=\"tipo_venta\" v-model=\"pedido.tipo_venta\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col lg:w-1/3 md:w-full sm:w-full mb-3\">\r\n          <div class=\"label_inputs\">Fecha solicitud</div>\r\n          <flat-pickr :config=\"configdateTimePicker\" v-model=\"pedido.fecha_envio\" placeholder=\"Fecha solicitud\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col lg:w-1/3 md:w-full sm:w-full mb-3\">\r\n          <div class=\"label_inputs\">Fecha entrega</div>\r\n          <flat-pickr :config=\"configdateTimePicker\" v-model=\"pedido.fecha_entrega\" placeholder=\"Fecha entrega\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col lg:w-1/3 md:w-full sm:w-full mb-3\">\r\n            <vs-input type=\"number\" label=\"Comisión %\" v-model=\"pedido.descuento\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col lg:w-1/3 md:w-full sm:w-full mb-3\" v-if=\"userRoot || userAsesor\">\r\n          <small>Facturador vee:</small>\r\n          <ul class=\"flex\">\r\n            <li>\r\n              <vs-radio v-model=\"pedido.facturacion_vee\" class=\"mr-3\"  vs-name=\"radios1facturacion_vee\" vs-value=\"0\">No</vs-radio>\r\n            </li>\r\n            <li>\r\n              <vs-radio v-model=\"pedido.facturacion_vee\"  vs-name=\"radios1facturacion_vee\" vs-value=\"1\">Si</vs-radio>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n        <!--OBSERVACION-->\r\n        <div style=\"width: 100%;\" class=\"mt-5\">\r\n          <vs-textarea  counter=\"500\" style=\"width:100%;\" height=\"200px\"  label=\"Observación\" :counter-danger.sync=\"counterDanger\" v-model=\"pedido.observacion\" />\r\n        </div>\r\n      </div>\r\n      <div class=\"flex justify-center\">\r\n          <vs-button color=\"warning\" class=\"mr-2\" type=\"border\" icon-pack=\"feather\" icon=\"icon-save\" v-if=\"usuario.id_group != 22\" @click=\"guardarPedido\">Guardar pedido</vs-button>\r\n          <vs-button color=\"success\" v-if=\"pedido.id_pedido > 0\"  type=\"gradient\" @click=\"input_comentario = ''; ver_comentarios(); popupComentarios = true\">Ver comentarios</vs-button>\r\n      </div>\r\n      <!--MODALES-->\r\n      <!--POPUP COMENTARIOS-->\r\n      <vs-popup fullscreen title=\"Comentarios\" :active.sync=\"popupComentarios\">\r\n        <div class=\"w-full\" align=\"center\">\r\n          <vs-textarea v-model=\"input_comentario\" class=\"w-ful mb-3\" />\r\n          <vs-button type=\"line\" color=\"success\" @click=\"guardar_comentario\">Enviar</vs-button>\r\n        </div>\r\n        <vs-divider></vs-divider>\r\n        <vs-list>\r\n          <div :key=\"index\" v-for=\"(item, index) in comentarios\">\r\n            <vs-list-header :title=\"item.nombres + ' ' + item.apellidos\"></vs-list-header>\r\n            <vs-list-item :subtitle=\"item.comentario\">\r\n              <span style=\"font-size: 12px;\" class=\"m-2\"> {{item.created_at}} </span>\r\n            </vs-list-item>\r\n          </div>\r\n        </vs-list>\r\n      </vs-popup>\r\n    </vx-card>\r\n  </template>\r\n  <script>\r\n  import {\r\n    mapState\r\n} from \"vuex\";\r\n  import flatPickr from 'vue-flatpickr-component';\r\n  import 'flatpickr/dist/flatpickr.css';\r\n  import vSelect from 'vue-select';\r\n  import axios from 'axios'\r\n  import PedidosRepository from \"../../../../repositories/PedidosRepository\";\r\n  export default {\r\n      components:{\r\n        flatPickr,\r\n        'v-select': vSelect,\r\n      },\r\n      data: () => ({\r\n        usuario:[],\r\n        pedido:{\r\n          id_pedido:0,\r\n          institucion:'',\r\n          asesor:'',\r\n          ruc:'',\r\n          direccionInstitucion:'',\r\n          nivel:'',\r\n          tipo_descripcion:'',\r\n          telefonoInstitucion:'',\r\n          periodo:'',\r\n          idperiodo:'',\r\n          tipo_venta:'',\r\n          fecha_envio:'',\r\n          fecha_entrega:'',\r\n          descuento:'',\r\n          estado:0,\r\n          contrato_generado:'',\r\n          id_asesor:0,\r\n          facturacion_vee:0,\r\n          observacion:'',\r\n        },\r\n        Eselect:'',\r\n        arrayInstituciones:[],\r\n        arrayPeriodos:[],\r\n        arregloNivel:[\r\n          {\r\n            id:1,\r\n            label:'Educación General Básica'\r\n          },\r\n          {\r\n            id:2,\r\n            label:'Bachillerato General Unificado'\r\n          },\r\n        ],\r\n        tiposEscuelas:[\r\n          \"Esc. Particulares\",\r\n          \"Esc. Fiscomisional\",\r\n          \"Esc. Fiscal\",\r\n        ],\r\n        tipos_venta: [\r\n          {id_tipo: 1, tipo_venta: 'Directa'},\r\n          {id_tipo: 2, tipo_venta: 'Comisión o lista'},\r\n        ],\r\n        configdateTimePicker: {\r\n          enableTime: true,\r\n          dateFormat: 'Y-m-d'\r\n        },\r\n        sendPedido:'',\r\n        counterDanger: false,\r\n        //variables de comentarios\r\n        comentarios:[],\r\n        popupComentarios:false,\r\n        input_comentario:'',\r\n        //fin variables de comentarios\r\n      }),\r\n      mounted() {\r\n        let me = this\r\n        this.usuario = JSON.parse(localStorage.getItem('usuario'));\r\n        this.setDatos()\r\n      },\r\n      computed:{\r\n        ...mapState([\"auth\",'userRoot','susuario','ObjectPedido','userAsesor']),\r\n      },\r\n      methods: {\r\n        setDatos(){\r\n          let me = this;\r\n          me.sendPedido = me.ObjectPedido\r\n          //crear\r\n          if(me.sendPedido.id_pedido == 0){\r\n            me.getInstituciones(me.usuario.cedula)\r\n            me.limpiar()\r\n          }\r\n          //editar\r\n          else{\r\n            me.getInstituciones(me.sendPedido.cedula_asesor)\r\n            me.pedido = {\r\n              id_pedido:            me.sendPedido.id_pedido,\r\n              estado:               me.sendPedido.estado,\r\n              institucion:          me.sendPedido.id_institucion,\r\n              asesor:               me.sendPedido.responsable,\r\n              ruc:                  me.sendPedido.ruc,\r\n              direccionInstitucion: me.sendPedido.direccionInstitucion,\r\n              nivel:                me.sendPedido.nivel,\r\n              tipo_descripcion:     me.sendPedido.tipo_descripcion,\r\n              telefonoInstitucion:  me.sendPedido.telefonoInstitucion,\r\n              periodo:              me.sendPedido.periodo,\r\n              idperiodo:            me.sendPedido.id_periodo,\r\n              tipo_venta:           me.sendPedido.tipo_venta,\r\n              fecha_envio:          me.sendPedido.fecha_envio,\r\n              fecha_entrega:        me.sendPedido.fecha_entrega,\r\n              descuento:            me.sendPedido.descuento,\r\n              contrato_generado:    me.sendPedido.contrato_generado,\r\n              id_asesor:            me.sendPedido.id_asesor,\r\n              facturacion_vee:      me.sendPedido.facturacion_vee,\r\n              observacion:          me.sendPedido.observacion\r\n            }\r\n          }\r\n        },\r\n        getInstituciones(cedula){\r\n          let me = this\r\n          this.$http.get(this.$server_url+'get_instituciones_asesor/'+cedula)\r\n          .then(res => {\r\n              me.arrayInstituciones = res.data\r\n          })\r\n        },\r\n        guardarPedido(){\r\n          let me = this\r\n          if(me.sendPedido.estado == 2){\r\n            me.$vs.notify({\r\n              color: 'warning',\r\n              title: 'Mensaje',\r\n              text: 'No se puede modificar el pedido anulado',\r\n              time:5000,\r\n              })\r\n            return false\r\n          }\r\n          if(me.pedido.ruc == \"\" || me.pedido.ruc == \"null\"){\r\n            me.$vs.notify({\r\n              color: 'warning',\r\n              title: 'Mensaje',\r\n              text: 'El ruc no puede quedar vacio',\r\n              time:5000,\r\n              })\r\n            return false\r\n          }\r\n          if(me.codigo_institucion_milton == '22507'){\r\n            me.$vs.notify({\r\n              color: 'warning',\r\n              title: 'Mensaje',\r\n              text: 'El id institución hay que cambiar informar a soporte por favor',\r\n              time:5000,\r\n              })\r\n            return false\r\n          }\r\n          if(me.pedido.contrato_generado == null || me.pedido.contrato_generado == \"null\" || me.pedido.contrato_generado == \"\"){\r\n          }else{\r\n            me.$vs.notify({\r\n              color: 'warning',\r\n              title: 'Mensaje',\r\n              text: 'El pedido ya tiene el contrato ' + me.pedido.contrato_generado +\" No puede realizar cambios\"\r\n              })\r\n            return false;\r\n          }\r\n          if(me.pedido.nivel == null || me.pedido.nivel == \"\" || me.pedido.nivel == undefined){\r\n            me.$vs.notify({\r\n              color: 'warning',\r\n              title: 'Mensaje',\r\n              text: 'Seleccione un nivel por favor'\r\n              })\r\n            return false;\r\n          }\r\n          if( me.pedido.idperiodo == '' || me.pedido.tipo_venta == '' || me.pedido.fecha_envio == '' || me.pedido.fecha_entrega == '' || me.pedido.institucion == '' || me.pedido.direccionInstitucion == '' || me.pedido.ruc == '' || me.pedido.tipo_descripcion == '' || me.pedido.telefonoInstitucion == ''){\r\n            me.$vs.notify({ text: 'Llene todos los campos antes de guardar.', color: 'warning', iconPack: 'feather', icon: 'icon-alert-triangle' })\r\n            return\r\n          }\r\n          let formData = new FormData();\r\n          formData.append('informacionPedido',   'yes');\r\n          formData.append('id_pedido',            me.pedido.id_pedido);\r\n          formData.append('tipo_venta',           me.pedido.tipo_venta);\r\n          formData.append('tipo_venta_descr',     me.pedido.tipo_venta == 1 ? 'Venta directa' : 'Comisión o lista');\r\n          formData.append('fecha_envio',          me.pedido.fecha_envio);\r\n          formData.append('fecha_entrega',        me.pedido.fecha_entrega);\r\n          formData.append('institucion',          me.pedido.institucion);\r\n          formData.append('periodo',              me.pedido.idperiodo);\r\n          formData.append('descuento',            me.pedido.descuento);\r\n          formData.append('id_asesor',            me.pedido.id_asesor);\r\n          formData.append('facturacion_vee',      me.pedido.facturacion_vee);\r\n          formData.append('observacion',          me.pedido.observacion);\r\n          //para actualizar la institucion\r\n          formData.append('ruc',                  me.pedido.ruc);\r\n          formData.append('direccionInstitucion', me.pedido.direccionInstitucion);\r\n          formData.append('nivel',                me.pedido.nivel);\r\n          formData.append('tipo_descripcion',     me.pedido.tipo_descripcion);\r\n          formData.append('telefonoInstitucion',  me.pedido.telefonoInstitucion);\r\n          //fin para actualizar la institucion\r\n          me.$vs.loading();\r\n          //axios.post(this.$data_url+'api/guardarPedido',formData)\r\n          this.$http.post(this.$server_url+'pedidos', formData)\r\n          .then(res => {\r\n            me.$vs.loading.close();\r\n            if(res.data.status == 0){\r\n              me.$vs.notify({ text: res.data.message, color: 'danger', iconPack: 'feather', icon: 'icon-check', time:8000 })\r\n              return\r\n            }\r\n            if( res.data.error ){\r\n              alert(res.data.error)\r\n              return\r\n            }else{\r\n              me.$vs.notify({\r\n              color: 'primary',\r\n              title: 'Mensaje',\r\n              text: 'Se guardo correctamente'\r\n              })\r\n              me.rechargePedido(res.data.pedido.id_pedido)\r\n\r\n            }\r\n          })\r\n          .catch(err => {\r\n            console.log(err)\r\n            me.$vs.loading.close();\r\n          })\r\n        },\r\n        rechargePedido(id_pedido){\r\n          let me = this\r\n          PedidosRepository.getPedidoXID(id_pedido).then(r => { this.$store.dispatch('setPedido',r.data[0]); this.setDatos(); })\r\n        },\r\n        buscaPedidoGenerado(tr){\r\n          let me = this\r\n          //limpiar\r\n          me.pedido.ruc                   = \"\"\r\n          me.pedido.direccionInstitucion  = \"\"\r\n          me.pedido.nivel                 = \"\"\r\n          me.pedido.tipo_descripcion      = \"\"\r\n          me.pedido.telefonoInstitucion   = \"\"\r\n          if(me.pedido.institucion == null || me.pedido.institucion == \"\" || me.pedido.institucion == undefined){\r\n            me.$vs.notify({\r\n            text:'Seleccione una institución por favor',\r\n            color:'warning',\r\n            iconPack: 'feather',\r\n            icon:'icon-check'})\r\n            return\r\n          }\r\n          //proceso\r\n          let setValores                  = me.arrayInstituciones.filter(p => p.idInstitucion == me.pedido.institucion)[0]\r\n          me.pedido.ruc                   = setValores.ruc\r\n          me.pedido.direccionInstitucion  = setValores.direccionInstitucion\r\n          me.pedido.nivel                 = setValores.nivel\r\n          me.pedido.tipo_descripcion      = setValores.tipo_descripcion\r\n          me.pedido.telefonoInstitucion   = setValores.telefonoInstitucion\r\n          localStorage.setItem(\"institucion_selected_pedido\", me.pedido.institucion)\r\n          localStorage.setItem(\"id_asesor_pedido\", me.pedido.id_asesor)\r\n        },\r\n          //METODOS PARA COMENTARIOS\r\n        ver_comentarios(){\r\n          let me = this\r\n          me.$vs.loading();\r\n          this.$http.get(this.$server_url+'get_comentarios_pedido/'+me.pedido.id_pedido)\r\n          .then(res => {\r\n            me.comentarios = res.data\r\n            // me.cant_sms = res.data.length\r\n            me.$vs.loading.close();\r\n          })\r\n          .catch(err => {\r\n            me.$vs.loading.close();\r\n          })\r\n        },\r\n        guardar_comentario(){\r\n          let me = this\r\n          let formData = new FormData();\r\n          formData.append('id_pedido',  me.pedido.id_pedido);\r\n          formData.append('comentario', me.input_comentario);\r\n          formData.append('id_usuario', me.usuario.idusuario);\r\n          formData.append('id_group',   me.usuario.id_group)\r\n          me.$vs.loading();\r\n          this.$http.post(this.$server_url+'guardar_comentario', formData)\r\n          .then(res => {\r\n            me.input_comentario = ''\r\n            me.ver_comentarios()\r\n            me.$vs.loading.close();\r\n          })\r\n          .catch(err => {\r\n            console.log(err)\r\n              me.$vs.loading.close();\r\n          })\r\n        },\r\n        limpiar(){\r\n          let me = this;\r\n          me.pedido = {\r\n            id_pedido:               0,\r\n            estado:0,\r\n            institucion:'',\r\n            asesor:                   me.usuario.nombres + \" \"+me.usuario.apellidos,\r\n            ruc:'',\r\n            direccionInstitucion:'',\r\n            nivel:'',\r\n            tipo_descripcion:'',\r\n            telefonoInstitucion:'',\r\n            periodo:                me.sendPedido.periodo,\r\n            idperiodo:              me.sendPedido.id_periodo,\r\n            tipo_venta:'',\r\n            fecha_envio:'',\r\n            fecha_entrega:'',\r\n            descuento:'',\r\n            contrato_generado:'',\r\n            id_asesor:                me.usuario.idusuario,\r\n            facturacion_vee:          0,\r\n            observacion:              ''\r\n          }\r\n        }\r\n      },\r\n  }\r\n  </script>\r\n\r\n  <style>\r\n  .label_inputs{\r\n    font-size: 12px;\r\n    color: rgb(143, 143, 143);\r\n    margin-top: 4px;\r\n    padding-left: 4px;\r\n  }\r\n\r\n  </style>\r\n"]}]}