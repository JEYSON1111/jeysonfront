{"remainingRequest":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\periodos\\periodos.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\periodos\\periodos.vue","mtime":1712682816418},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\nimport flatPickr from 'vue-flatpickr-component';\r\nimport 'flatpickr/dist/flatpickr.css';\r\nimport Vue from 'vue'\r\nimport axios from 'axios'\r\nimport vSelect from 'vue-select'\r\nimport moment from 'moment'\r\nimport $ from 'jquery'\r\nexport default {\r\n    data: () => ({\r\n        //para el modal\r\n        popupActivo1: false,\r\n        popupActivo2: false,\r\n        //para actualizar\r\n        update: true,\r\n        id: 0,\r\n        titleModal: '',\r\n        arregloPeriodos: [],\r\n        usuario: '',\r\n        usuario_id: '',\r\n        periodo: {\r\n          fecha_inicial: '',\r\n          fecha_final: '',\r\n          descripcion: '',\r\n          codigo_contrato:'',\r\n          region_idregion: '1',\r\n          periodoescolar: '',\r\n          fromDate:null,\r\n          toDate:null,\r\n          pedido_facturacion:0,\r\n          pedido_gerencia:0,\r\n          pedido_bodega:0,\r\n          pedido_asesor:0,\r\n          obsequios_admin:0,\r\n          obsequios_facturador:0,\r\n          obsequios_gerencia:0,\r\n          obsequio_asesor:0,\r\n          cambiar_periodo:0,\r\n        },\r\n        configdateTimePicker: {\r\n          enableTime: true,\r\n          dateFormat: 'Y-m-d'\r\n        },\r\n        userRoot:false,\r\n        filtroCambioPeriodo:0,\r\n    }),\r\n    components:{\r\n        flatPickr,\r\n    },\r\n    mounted() {\r\n      let me = this;\r\n      me.usuario = JSON.parse(localStorage.getItem('usuario'));\r\n      me.usuario_id = me.usuario.idusuario\r\n      console.log(me.usuario_id)\r\n      me.getAdmin();\r\n      me.getUserRoot(me.usuario);\r\n    },\r\n    methods: {\r\n      getUserRoot(dato) {\r\n        let me = this;\r\n        this.$http.get(this.$server_url + 'permisos/' + dato.idusuario)\r\n          .then((result) => {\r\n            if (result.data.length > 0) {\r\n              me.userRoot = true;\r\n            }\r\n            if(this.usuario.id_group == 11 || this.userRoot == true){\r\n              this.disableAsesor = false\r\n              this.disableFacturador = true\r\n            }else{\r\n              this.disableAsesor = true\r\n              this.disableFacturador = false\r\n            }\r\n          })\r\n          .catch((err) => {\r\n              console.log(err)\r\n          })\r\n      },\r\n        getAdmin() {\r\n            let me = this;\r\n            me.$vs.loading()\r\n            this.$http.get(this.$server_url+'periodo')\r\n                .then(function (response) {\r\n                    me.arregloPeriodos = response.data;\r\n                    let datos = response.data\r\n                    if(datos.length > 0){\r\n                      //solo puede activo 2 periodos para cambiar\r\n                      let preData = datos.filter(p => p.cambiar_periodo == '1')\r\n                      me.filtroCambioPeriodo = preData\r\n                    }\r\n                    me.$vs.loading.close()\r\n                })\r\n                .catch(function (error) {\r\n                    me.$vs.loading.close()\r\n                })\r\n        },\r\n        addPeriodo() {\r\n            let me = this;\r\n            if (me.userRoot) {\r\n              me.id = 0\r\n              me.popupActivo2 = true;\r\n            } else {\r\n              me.$vs.notify({\r\n                time: 8000,\r\n                text: 'No tiene permiso para agregar periodos escolares, consulte con el administradores.',\r\n                color: 'danger',\r\n                iconPack: 'feather',\r\n                icon: 'icon-alert-triangle'\r\n              })\r\n            }\r\n        },\r\n        //para agregar periodo\r\n        agregarPeriodo() {\r\n            let me = this;\r\n            let formData = new FormData();\r\n            //validacion\r\n            if(me.periodo.codigo_contrato == null || me.periodo.codigo_contrato == \"\" || me.periodo.codigo_contrato == undefined || me.periodo.codigo_contrato == \"null\"){\r\n                me.$vs.notify({\r\n                    text: 'Código de contrato obligatorio',\r\n                    color: 'warning',\r\n                    iconPack: 'feather',\r\n                    icon: 'icon-check'\r\n                })\r\n                return\r\n            }\r\n            formData.append('id',                   me.id);\r\n            formData.append('fecha_inicial',        me.periodo.fecha_inicial);\r\n            formData.append('fecha_final',          me.periodo.fecha_final);\r\n            formData.append('descripcion',          me.periodo.descripcion);\r\n            formData.append('region_idregion',      me.periodo.region_idregion);\r\n            formData.append('periodoescolar',       me.periodo.periodoescolar);\r\n            formData.append('fhasta_limite',        me.periodo.toDate);\r\n            formData.append('codigo_contrato',      me.periodo.codigo_contrato);\r\n            //pedidos\r\n            formData.append('pedido_facturacion',   me.periodo.pedido_facturacion);\r\n            formData.append('pedido_gerencia',      me.periodo.pedido_gerencia)\r\n            formData.append('pedido_bodega',        me.periodo.pedido_bodega);\r\n            formData.append('pedido_asesor',        me.periodo.pedido_asesor);\r\n            //obsequios\r\n            formData.append('obsequios_admin',      me.periodo.obsequios_admin);\r\n            formData.append('obsequios_facturador', me.periodo.obsequios_facturador);\r\n            formData.append('obsequios_gerencia',   me.periodo.obsequios_gerencia);\r\n            formData.append('obsequio_asesor',      me.periodo.obsequio_asesor);\r\n            //cambiar periodo\r\n            formData.append('cambiar_periodo',      me.periodo.cambiar_periodo)\r\n            me.$vs.loading()\r\n            this.$http.post(this.$server_url+'periodo', formData)\r\n                .then(res => {\r\n                    me.getAdmin();\r\n                    me.popupActivo1 = false\r\n                    me.popupActivo2 = false\r\n                    me.$vs.loading.close()\r\n                    me.$vs.notify({\r\n                        text: 'Periodo guardado exitosamente',\r\n                        color: 'success',\r\n                        iconPack: 'feather',\r\n                        icon: 'icon-check'\r\n                    })\r\n                })\r\n        },\r\n        openModal(data = {}) {\r\n            let me = this;\r\n            if (me.userRoot) {\r\n                this.popupActivo1 = true;\r\n                this.id                             = data.idperiodoescolar;\r\n                this.titleModal                     = \"Modificar Periodo\";\r\n                this.periodo.fecha_inicial          = data.fecha_inicial;\r\n                this.periodo.fecha_final            = data.fecha_final;\r\n                this.periodo.descripcion            = data.descripcion;\r\n                this.periodo.region_idregion        = data.region_idregion;\r\n                this.periodo.periodoescolar         = data.periodoescolar;\r\n                this.periodo.fromDate               = data.finicio_limite;\r\n                this.periodo.toDate                 = data.fhasta_limite;\r\n                this.periodo.codigo_contrato        = data.codigo_contrato\r\n                //pedidos\r\n                this.periodo.pedido_facturacion     = data.pedido_facturacion\r\n                this.periodo.pedido_gerencia        = data.pedido_gerencia\r\n                this.periodo.pedido_bodega          = data.pedido_bodega\r\n                this.periodo.pedido_asesor          = data.pedido_asesor\r\n                //obsequios\r\n                this.periodo.obsequios_admin        = data.obsequios_admin\r\n                this.periodo.obsequios_facturador   = data.obsequios_facturador\r\n                this.periodo.obsequios_gerencia     = data.obsequios_gerencia\r\n                this.periodo.obsequio_asesor        = data.obsequio_asesor\r\n                //cambiar periodo\r\n                this.periodo.cambiar_periodo        = data.cambiar_periodo\r\n                me.popupActivo2                     = true\r\n            } else {\r\n                me.$vs.notify({\r\n                    time: 8000,\r\n                    text: 'No tiene permiso para editar periodos escolares, consulte con el administrador.',\r\n                    color: 'danger',\r\n                    iconPack: 'feather',\r\n                    icon: 'icon-alert-triangle'\r\n                })\r\n            }\r\n        },\r\n        limpiarcampos() {\r\n            this.id                             = 0;\r\n            this.titleModal                     = \"Crear Periodo\";\r\n            this.periodo.fecha_inicial          = \"\";\r\n            this.periodo.fecha_final            = \"\";\r\n            this.periodo.descripcion            = \"\";\r\n            this.periodo.region_idregion        = \"\";\r\n            this.periodo.periodoescolar         = \"\";\r\n            this.periodo.fromDate               = \"\";\r\n            this.periodo.toDate                 = \"\";\r\n            this.periodo.codigo_contrato        = \"\";\r\n            //pedidos\r\n            this.periodo.pedido_facturacion     = 0\r\n            this.periodo.pedido_gerencia        = 0\r\n            this.periodo.pedido_bodega          = 0\r\n            this.periodo.pedido_asesor          = 0\r\n            //obsequios\r\n            this.periodo.obsequios_admin        = 0\r\n            this.periodo.obsequios_facturador   = 0\r\n            this.periodo.obsequios_gerencia     = 0\r\n            this.periodo.obsequio_asesor        = 0\r\n            //cambiar periodo\r\n            this.periodo.cambiar_periodo        = 0\r\n        },\r\n        // desactivar el estado de la tabla\r\n        desactivar(idperiodoescolar) {\r\n            let me = this;\r\n            if (me.userRoot) {\r\n                let me = this;\r\n                let formData = new FormData();\r\n                formData.append('idperiodoescolar', idperiodoescolar);\r\n                me.$vs.loading()\r\n                this.$http.post(this.$server_url+'periodo/desactivar', formData)\r\n                    .then(res => {\r\n                        me.getAdmin();\r\n                        me.$vs.loading.close()\r\n                        me.$vs.notify({\r\n                            text: 'Periodo  actualizado',\r\n                            color: 'success',\r\n                            iconPack: 'feather',\r\n                            icon: 'icon-check'\r\n                        })\r\n                    })\r\n            } else {\r\n                me.$vs.notify({\r\n                    time: 8000,\r\n                    text: 'No tiene permiso para desactivar periodos escolares, consulte con el administrador.',\r\n                    color: 'danger',\r\n                    iconPack: 'feather',\r\n                    icon: 'icon-alert-triangle'\r\n                })\r\n            }\r\n        },\r\n        activar(idperiodoescolar) {\r\n            let me = this;\r\n            if (me.usuario_id == 5103 || me.usuario_id == 4853 || me.usuario_id == 35748) {\r\n                let formData = new FormData();\r\n                formData.append('idperiodoescolar', idperiodoescolar);\r\n                me.$vs.loading()\r\n                this.$http.post(this.$server_url+'periodo/activar', formData)\r\n                    .then(res => {\r\n                        me.getAdmin();\r\n                        me.$vs.loading.close()\r\n                        me.$vs.notify({\r\n                            text: 'Periodo  actualizado',\r\n                            color: 'success',\r\n                            iconPack: 'feather',\r\n                            icon: 'icon-check'\r\n                        })\r\n                    })\r\n            } else {\r\n                me.$vs.notify({\r\n                    time: 8000,\r\n                    text: 'No tiene permiso para activar periodos escolares, consulte con el administrador.',\r\n                    color: 'danger',\r\n                    iconPack: 'feather',\r\n                    icon: 'icon-alert-triangle'\r\n                })\r\n            }\r\n        },\r\n    },\r\n}\r\n",{"version":3,"sources":["periodos.vue"],"names":[],"mappings":";AA4PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"periodos.vue","sourceRoot":"src/views/periodos","sourcesContent":["<template>\r\n<div>\r\n  <div>\r\n    <vs-alert active=\"true\" class=\"mt-2\" color=\"danger\" v-if=\"filtroCambioPeriodo.length > 2\">\r\n      <p class=\"text-center\"><ion-icon name=\"warning-outline\"></ion-icon> Existe más de 2 <b>períodos</b> para asignación en las instituciones</p>\r\n    </vs-alert>\r\n  </div>\r\n  <br>\r\n    <!--Contenido del boton agregar un periodo-->\r\n    <div class=\"centerx\">\r\n        <vs-popup classContent=\"popup-example\" :title=\"titleModal\" :active.sync=\"popupActivo2\">\r\n            <div class=\"vx-col w-full mt-5\">\r\n                <label>Fecha inicial</label>\r\n                <flat-pickr :config=\"configdateTimePicker\"    v-model=\"periodo.fecha_inicial\" placeholder=\"Fecha Final\" class=\"m-1 inputx w-full\" style=\"display: inline-block;\" />\r\n            </div>\r\n            <div class=\"vx-col w-full mt-5\">\r\n                <label>Fecha Final</label>\r\n                <flat-pickr :config=\"configdateTimePicker\"    v-model=\"periodo.fecha_final\" placeholder=\"Fecha Final\" class=\"m-1 inputx w-full\" style=\"display: inline-block;\" />\r\n            </div>\r\n            <div class=\"vx-col w-full mt-5\">\r\n                <label>Descripcion</label>\r\n                <vs-input class=\"inputx w-full\" placeholder=\"Descripcion\" v-model=\"periodo.descripcion\" />\r\n            </div>\r\n            <div class=\"vx-col w-full mt-5\">\r\n                <label>Código contrato(Ejem.C23)</label>\r\n                <vs-input class=\"inputx w-full\" placeholder=\"Cod contrato\" v-model=\"periodo.codigo_contrato\" />\r\n            </div>\r\n            <div class=\"vx-col w-full mt-5\">\r\n              <ul class=\"leftx\">\r\n                  <li class=\"modelx\">\r\n                      Seleccione la region\r\n                  </li>\r\n                  <br>\r\n                  <li>\r\n                      <vs-radio v-model=\"periodo.region_idregion\" vs-name=\"radios1\" vs-value=\"1\">Sierra</vs-radio>\r\n                  </li>\r\n                  <li>\r\n                      <vs-radio v-model=\"periodo.region_idregion\" vs-name=\"radios1\" vs-value=\"2\">Costa</vs-radio>\r\n                  </li>\r\n              </ul>\r\n            </div>\r\n            <div class=\"vx-col w-full mt-5\">\r\n              <label>Periodo escolar</label>\r\n              <vs-input class=\"inputx w-full\" placeholder=\"Periodo escolar\" v-model=\"periodo.periodoescolar\" />\r\n            </div>\r\n            <vs-divider>Permisos pedidos</vs-divider>\r\n            <!--PERIODO FACTURADOR-->\r\n            <div class=\"vx-col w-full mt-5\">\r\n                Visible para pedidos(facturador)\r\n                <ul class=\"flex mt-1\">\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.pedido_facturacion\" vs-name=\"radios1pedido_facturacion\" vs-value=\"1\">Si</vs-radio>\r\n                    </li>\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.pedido_facturacion\" class=\"ml-2\" vs-name=\"radios1pedido_facturacion\" vs-value=\"0\">No</vs-radio>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n            <!--PERIODO GERENCIA-->\r\n            <div class=\"vx-col w-full mt-5\">\r\n                Visible para pedidos(Gerencia)\r\n                <ul class=\"flex mt-1\">\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.pedido_gerencia\" vs-name=\"radios1gerencia\" vs-value=\"1\">Si</vs-radio>\r\n                    </li>\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.pedido_gerencia\" class=\"ml-2\" vs-name=\"radios1gerencia\" vs-value=\"0\">No</vs-radio>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n            <!--PERIODO BODEGA-->\r\n            <div class=\"vx-col w-full mt-5\">\r\n                Visible para pedidos(Bodega)\r\n                <ul class=\"flex mt-1\">\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.pedido_bodega\" vs-name=\"radios1pedido_bodega\" vs-value=\"1\">Si</vs-radio>\r\n                    </li>\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.pedido_bodega\" class=\"ml-2\" vs-name=\"radios1pedido_bodega\" vs-value=\"0\">No</vs-radio>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n            <!--PERIODO ASESOR-->\r\n            <div class=\"vx-col w-full mt-5\">\r\n                Visible para pedidos(Asesor)\r\n                <ul class=\"flex mt-1\">\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.pedido_asesor\" vs-name=\"radios1pedido_asesor\" vs-value=\"1\">Si</vs-radio>\r\n                    </li>\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.pedido_asesor\" class=\"ml-2\" vs-name=\"radios1pedido_asesor\" vs-value=\"0\">No</vs-radio>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n            <vs-divider>Permisos obsequios</vs-divider>\r\n            <!--PERIODO OBSEQUIO ADMIN-->\r\n            <div class=\"vx-col w-full mt-5\">\r\n                Visible para Obsequios(Admin)\r\n                <ul class=\"flex mt-1\">\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.obsequios_admin\" vs-name=\"radios1obsequios_admin\" vs-value=\"1\">Si</vs-radio>\r\n                    </li>\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.obsequios_admin\" class=\"ml-2\" vs-name=\"radios1obsequios_admin\" vs-value=\"0\">No</vs-radio>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n            <!--PERIODO OBSEQUIO FACTURADOR-->\r\n            <div class=\"vx-col w-full mt-5\">\r\n                Visible para Obsequios(Facturador)\r\n                <ul class=\"flex mt-1\">\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.obsequios_facturador\" vs-name=\"radios1obsequios_facturador\" vs-value=\"1\">Si</vs-radio>\r\n                    </li>\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.obsequios_facturador\" class=\"ml-2\" vs-name=\"radios1obsequios_facturador\" vs-value=\"0\">No</vs-radio>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n            <!--PERIODO OBSEQUIO GERENCIA-->\r\n            <div class=\"vx-col w-full mt-5\">\r\n                Visible para Obsequios(Gerencia)\r\n                <ul class=\"flex mt-1\">\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.obsequios_gerencia\" vs-name=\"radios1obsequios_gerencia\" vs-value=\"1\">Si</vs-radio>\r\n                    </li>\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.obsequios_gerencia\" class=\"ml-2\" vs-name=\"radios1obsequios_gerencia\" vs-value=\"0\">No</vs-radio>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n            <!--PERIODO OBSEQUIO ASESOR-->\r\n            <div class=\"vx-col w-full mt-5\">\r\n                Visible para Obsequios(Asesor)\r\n                <ul class=\"flex mt-1\">\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.obsequio_asesor\" vs-name=\"radios1obsequio_asesor\" vs-value=\"1\">Si</vs-radio>\r\n                    </li>\r\n                    <li>\r\n                        <vs-radio v-model=\"periodo.obsequio_asesor\" class=\"ml-2\" vs-name=\"radios1obsequio_asesor\" vs-value=\"0\">No</vs-radio>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n            <vs-divider>Permisos activación periodo</vs-divider>\r\n            <!--PERIODO OBSEQUIO ADMIN-->\r\n            <div class=\"vx-col w-full mt-5\">\r\n              Visible para el asesor cambiar de período\r\n              <ul class=\"flex mt-1\">\r\n                  <li>\r\n                      <vs-radio v-model=\"periodo.cambiar_periodo\" vs-name=\"radios1cambiar_periodo\" vs-value=\"1\">Si</vs-radio>\r\n                  </li>\r\n                  <li>\r\n                      <vs-radio v-model=\"periodo.cambiar_periodo\" class=\"ml-2\" vs-name=\"radios1cambiar_periodo\" vs-value=\"0\">No</vs-radio>\r\n                  </li>\r\n              </ul>\r\n            </div>\r\n            <vs-divider color=\"warning\">Limitacion para el asesor</vs-divider>\r\n            <div class=\"vx-col w-full mt-5\">\r\n                <flat-pickr :config=\"configdateTimePicker\"    v-model=\"periodo.toDate\" placeholder=\"Fecha Limite\" class=\"m-1 inputx w-full\" style=\"display: inline-block;\" />\r\n            </div>\r\n            <br>\r\n            <vs-button @click=\"agregarPeriodo();\" color=\"primary\" type=\"filled\">Guardar Cambios</vs-button>\r\n        </vs-popup>\r\n    </div>\r\n    <!--FIN DEL CONTENIDO POPUP PARA AGREGAR UN Agregar / Editar-->\r\n    <vx-card title=\"Periodo Escolar\" v-if=\"usuario.id_group == '1'\">\r\n      <!--PERIODOS ACTIVOS ASESOS CAMBIAR-->\r\n      <b class=\"font-semibold text-success\">Períodos para asignación de instituciones:</b>\r\n      <ul class=\"features mt-1\">\r\n        <li v-for=\"(item,key) in filtroCambioPeriodo\" :key=\"key\">\r\n          <span class=\"icon\">\r\n            <svg height=\"24\" width=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path d=\"M0 0h24v24H0z\" fill=\"none\"></path>\r\n              <path fill=\"currentColor\" d=\"M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414z\"></path>\r\n            </svg>\r\n          </span>\r\n          <span><strong>Periodo: </strong>{{ item.periodoescolar }}</span>\r\n        </li>\r\n      </ul>\r\n      <!--FIN PERIODOS ACTIVOS ASESORS PUEDE CAMBIAR-->\r\n      <small  v-if=\"usuario.id_group == 1\" align=\"left\">Ruta: /a_periodos</small>\r\n      <!--Tabla para el listado de la tabla periodos-->\r\n      <vs-table stripe max-items=\"50\" search pagination :data=\"arregloPeriodos\">\r\n          <template slot=\"header\">\r\n              <vs-button @click=\"limpiarcampos();addPeriodo();\" style=\"margin-left: 5px;\" color=\"success\" type=\"filled\">\r\n                  + Agregar periodo\r\n              </vs-button>\r\n          </template>\r\n          <template slot=\"thead\">\r\n              <vs-th>Nombre</vs-th>\r\n              <vs-th>Periodo</vs-th>\r\n              <vs-th>Region</vs-th>\r\n              <vs-th>Fecha limite período</vs-th>\r\n              <vs-th>Cod. contrato</vs-th>\r\n              <vs-th>Estado</vs-th>\r\n              <vs-th>Acciones</vs-th>\r\n          </template>\r\n          <template slot-scope=\"{data}\">\r\n              <vs-tr :key=\"indextr\" v-for=\"(tr, indextr) in data\">\r\n                  <vs-td :data=\"data[indextr].descripcion\">\r\n                      {{data[indextr].descripcion}}\r\n                  </vs-td>\r\n                  <vs-td :data=\"data[indextr].periodoescolar\">\r\n                      {{data[indextr].periodoescolar}}\r\n                      <div>\r\n                          id - {{ tr.idperiodoescolar }}\r\n                      </div>\r\n                  </vs-td>\r\n                  <vs-td :data=\"data[indextr].region_idregion\">\r\n                      <label v-if=\"data[indextr].region_idregion == '1'\">SIERRA</label>\r\n                      <label v-if=\"data[indextr].region_idregion == '2'\">COSTA</label>\r\n                  </vs-td>\r\n                  <vs-td :data=\"data[indextr].fecha_final\">\r\n                      {{data[indextr].fecha_final}}\r\n                  </vs-td>\r\n                  <vs-td>\r\n                      {{ tr.codigo_contrato }}\r\n                  </vs-td>\r\n                  <vs-td :data=\"data[indextr].estado\">\r\n                      <label v-if=\"data[indextr].estado == '1'\" class=\"text-success\">Activo</label>\r\n                      <label v-if=\"data[indextr].estado == '0'\" class=\"text-danger\">Inactivo</label>\r\n                      <vs-divider>Pedidos</vs-divider>\r\n                      <div class=\"flex\" style=\"flex-direction: column;\">\r\n                          <vs-chip v-if=\"tr.pedido_facturacion == 1\">facturación</vs-chip>\r\n                          <vs-chip v-if=\"tr.pedido_gerencia == 1\" style=\"margin: 5px 0px;\">Gerencia</vs-chip>\r\n                          <vs-chip v-if=\"tr.pedido_bodega == 1\" style=\"margin: 5px 0px;\" >Bodega</vs-chip>\r\n                          <vs-chip v-if=\"tr.pedido_asesor == 1\" style=\"margin: 5px 0px;\">Asesor</vs-chip>\r\n                      </div>\r\n                      <vs-divider>Obsequios</vs-divider>\r\n                      <div class=\"flex\" style=\"flex-direction: column;\">\r\n                          <vs-chip v-if=\"tr.obsequios_admin == 1\">Admin</vs-chip>\r\n                          <vs-chip v-if=\"tr.obsequios_facturador == 1\" style=\"margin: 5px 0px;\">Facturador</vs-chip>\r\n                          <vs-chip v-if=\"tr.obsequios_gerencia == 1\" style=\"margin: 5px 0px;\">Gerencia</vs-chip>\r\n                          <vs-chip v-if=\"tr.obsequio_asesor == 1\" style=\"margin: 5px 0px;\">Asesor</vs-chip>\r\n                      </div>\r\n                      <!--CAMBIAR PERIODO-->\r\n                      <vs-chip v-if=\"tr.cambiar_periodo == 1\" class=\"ml-2 mt-1\" color=\"dark\">Activo para asignar periodo</vs-chip>\r\n                  </vs-td>\r\n                  <vs-td :data=\"tr\">\r\n                      <div class=\"flex\">\r\n                          <vs-button type=\"border\" size=\"small\" icon-pack=\"feather\" icon=\"icon-edit\" class=\"mr-2\" color=\"success\" @click=\"update = true; openModal(data[indextr]);\"></vs-button>\r\n                          <vs-button type=\"border\" v-if=\"data[indextr].estado == '1'\" size=\"small\" icon-pack=\"feather\" icon=\"icon-x\" class=\"mr-2\" color=\"danger\" @click=\"desactivar(data[indextr].idperiodoescolar)\"></vs-button>\r\n                          <vs-button color=\"primary\" v-if=\"data[indextr].estado == '0'\" size=\"small\" type=\"border\" icon-pack=\"feather\" icon=\"icon-check\" @click=\"activar(data[indextr].idperiodoescolar)\"></vs-button>\r\n                      </div>\r\n                  </vs-td>\r\n              </vs-tr>\r\n          </template>\r\n      </vs-table>\r\n    </vx-card>\r\n</div>\r\n</template>\r\n<script>\r\nimport flatPickr from 'vue-flatpickr-component';\r\nimport 'flatpickr/dist/flatpickr.css';\r\nimport Vue from 'vue'\r\nimport axios from 'axios'\r\nimport vSelect from 'vue-select'\r\nimport moment from 'moment'\r\nimport $ from 'jquery'\r\nexport default {\r\n    data: () => ({\r\n        //para el modal\r\n        popupActivo1: false,\r\n        popupActivo2: false,\r\n        //para actualizar\r\n        update: true,\r\n        id: 0,\r\n        titleModal: '',\r\n        arregloPeriodos: [],\r\n        usuario: '',\r\n        usuario_id: '',\r\n        periodo: {\r\n          fecha_inicial: '',\r\n          fecha_final: '',\r\n          descripcion: '',\r\n          codigo_contrato:'',\r\n          region_idregion: '1',\r\n          periodoescolar: '',\r\n          fromDate:null,\r\n          toDate:null,\r\n          pedido_facturacion:0,\r\n          pedido_gerencia:0,\r\n          pedido_bodega:0,\r\n          pedido_asesor:0,\r\n          obsequios_admin:0,\r\n          obsequios_facturador:0,\r\n          obsequios_gerencia:0,\r\n          obsequio_asesor:0,\r\n          cambiar_periodo:0,\r\n        },\r\n        configdateTimePicker: {\r\n          enableTime: true,\r\n          dateFormat: 'Y-m-d'\r\n        },\r\n        userRoot:false,\r\n        filtroCambioPeriodo:0,\r\n    }),\r\n    components:{\r\n        flatPickr,\r\n    },\r\n    mounted() {\r\n      let me = this;\r\n      me.usuario = JSON.parse(localStorage.getItem('usuario'));\r\n      me.usuario_id = me.usuario.idusuario\r\n      console.log(me.usuario_id)\r\n      me.getAdmin();\r\n      me.getUserRoot(me.usuario);\r\n    },\r\n    methods: {\r\n      getUserRoot(dato) {\r\n        let me = this;\r\n        this.$http.get(this.$server_url + 'permisos/' + dato.idusuario)\r\n          .then((result) => {\r\n            if (result.data.length > 0) {\r\n              me.userRoot = true;\r\n            }\r\n            if(this.usuario.id_group == 11 || this.userRoot == true){\r\n              this.disableAsesor = false\r\n              this.disableFacturador = true\r\n            }else{\r\n              this.disableAsesor = true\r\n              this.disableFacturador = false\r\n            }\r\n          })\r\n          .catch((err) => {\r\n              console.log(err)\r\n          })\r\n      },\r\n        getAdmin() {\r\n            let me = this;\r\n            me.$vs.loading()\r\n            this.$http.get(this.$server_url+'periodo')\r\n                .then(function (response) {\r\n                    me.arregloPeriodos = response.data;\r\n                    let datos = response.data\r\n                    if(datos.length > 0){\r\n                      //solo puede activo 2 periodos para cambiar\r\n                      let preData = datos.filter(p => p.cambiar_periodo == '1')\r\n                      me.filtroCambioPeriodo = preData\r\n                    }\r\n                    me.$vs.loading.close()\r\n                })\r\n                .catch(function (error) {\r\n                    me.$vs.loading.close()\r\n                })\r\n        },\r\n        addPeriodo() {\r\n            let me = this;\r\n            if (me.userRoot) {\r\n              me.id = 0\r\n              me.popupActivo2 = true;\r\n            } else {\r\n              me.$vs.notify({\r\n                time: 8000,\r\n                text: 'No tiene permiso para agregar periodos escolares, consulte con el administradores.',\r\n                color: 'danger',\r\n                iconPack: 'feather',\r\n                icon: 'icon-alert-triangle'\r\n              })\r\n            }\r\n        },\r\n        //para agregar periodo\r\n        agregarPeriodo() {\r\n            let me = this;\r\n            let formData = new FormData();\r\n            //validacion\r\n            if(me.periodo.codigo_contrato == null || me.periodo.codigo_contrato == \"\" || me.periodo.codigo_contrato == undefined || me.periodo.codigo_contrato == \"null\"){\r\n                me.$vs.notify({\r\n                    text: 'Código de contrato obligatorio',\r\n                    color: 'warning',\r\n                    iconPack: 'feather',\r\n                    icon: 'icon-check'\r\n                })\r\n                return\r\n            }\r\n            formData.append('id',                   me.id);\r\n            formData.append('fecha_inicial',        me.periodo.fecha_inicial);\r\n            formData.append('fecha_final',          me.periodo.fecha_final);\r\n            formData.append('descripcion',          me.periodo.descripcion);\r\n            formData.append('region_idregion',      me.periodo.region_idregion);\r\n            formData.append('periodoescolar',       me.periodo.periodoescolar);\r\n            formData.append('fhasta_limite',        me.periodo.toDate);\r\n            formData.append('codigo_contrato',      me.periodo.codigo_contrato);\r\n            //pedidos\r\n            formData.append('pedido_facturacion',   me.periodo.pedido_facturacion);\r\n            formData.append('pedido_gerencia',      me.periodo.pedido_gerencia)\r\n            formData.append('pedido_bodega',        me.periodo.pedido_bodega);\r\n            formData.append('pedido_asesor',        me.periodo.pedido_asesor);\r\n            //obsequios\r\n            formData.append('obsequios_admin',      me.periodo.obsequios_admin);\r\n            formData.append('obsequios_facturador', me.periodo.obsequios_facturador);\r\n            formData.append('obsequios_gerencia',   me.periodo.obsequios_gerencia);\r\n            formData.append('obsequio_asesor',      me.periodo.obsequio_asesor);\r\n            //cambiar periodo\r\n            formData.append('cambiar_periodo',      me.periodo.cambiar_periodo)\r\n            me.$vs.loading()\r\n            this.$http.post(this.$server_url+'periodo', formData)\r\n                .then(res => {\r\n                    me.getAdmin();\r\n                    me.popupActivo1 = false\r\n                    me.popupActivo2 = false\r\n                    me.$vs.loading.close()\r\n                    me.$vs.notify({\r\n                        text: 'Periodo guardado exitosamente',\r\n                        color: 'success',\r\n                        iconPack: 'feather',\r\n                        icon: 'icon-check'\r\n                    })\r\n                })\r\n        },\r\n        openModal(data = {}) {\r\n            let me = this;\r\n            if (me.userRoot) {\r\n                this.popupActivo1 = true;\r\n                this.id                             = data.idperiodoescolar;\r\n                this.titleModal                     = \"Modificar Periodo\";\r\n                this.periodo.fecha_inicial          = data.fecha_inicial;\r\n                this.periodo.fecha_final            = data.fecha_final;\r\n                this.periodo.descripcion            = data.descripcion;\r\n                this.periodo.region_idregion        = data.region_idregion;\r\n                this.periodo.periodoescolar         = data.periodoescolar;\r\n                this.periodo.fromDate               = data.finicio_limite;\r\n                this.periodo.toDate                 = data.fhasta_limite;\r\n                this.periodo.codigo_contrato        = data.codigo_contrato\r\n                //pedidos\r\n                this.periodo.pedido_facturacion     = data.pedido_facturacion\r\n                this.periodo.pedido_gerencia        = data.pedido_gerencia\r\n                this.periodo.pedido_bodega          = data.pedido_bodega\r\n                this.periodo.pedido_asesor          = data.pedido_asesor\r\n                //obsequios\r\n                this.periodo.obsequios_admin        = data.obsequios_admin\r\n                this.periodo.obsequios_facturador   = data.obsequios_facturador\r\n                this.periodo.obsequios_gerencia     = data.obsequios_gerencia\r\n                this.periodo.obsequio_asesor        = data.obsequio_asesor\r\n                //cambiar periodo\r\n                this.periodo.cambiar_periodo        = data.cambiar_periodo\r\n                me.popupActivo2                     = true\r\n            } else {\r\n                me.$vs.notify({\r\n                    time: 8000,\r\n                    text: 'No tiene permiso para editar periodos escolares, consulte con el administrador.',\r\n                    color: 'danger',\r\n                    iconPack: 'feather',\r\n                    icon: 'icon-alert-triangle'\r\n                })\r\n            }\r\n        },\r\n        limpiarcampos() {\r\n            this.id                             = 0;\r\n            this.titleModal                     = \"Crear Periodo\";\r\n            this.periodo.fecha_inicial          = \"\";\r\n            this.periodo.fecha_final            = \"\";\r\n            this.periodo.descripcion            = \"\";\r\n            this.periodo.region_idregion        = \"\";\r\n            this.periodo.periodoescolar         = \"\";\r\n            this.periodo.fromDate               = \"\";\r\n            this.periodo.toDate                 = \"\";\r\n            this.periodo.codigo_contrato        = \"\";\r\n            //pedidos\r\n            this.periodo.pedido_facturacion     = 0\r\n            this.periodo.pedido_gerencia        = 0\r\n            this.periodo.pedido_bodega          = 0\r\n            this.periodo.pedido_asesor          = 0\r\n            //obsequios\r\n            this.periodo.obsequios_admin        = 0\r\n            this.periodo.obsequios_facturador   = 0\r\n            this.periodo.obsequios_gerencia     = 0\r\n            this.periodo.obsequio_asesor        = 0\r\n            //cambiar periodo\r\n            this.periodo.cambiar_periodo        = 0\r\n        },\r\n        // desactivar el estado de la tabla\r\n        desactivar(idperiodoescolar) {\r\n            let me = this;\r\n            if (me.userRoot) {\r\n                let me = this;\r\n                let formData = new FormData();\r\n                formData.append('idperiodoescolar', idperiodoescolar);\r\n                me.$vs.loading()\r\n                this.$http.post(this.$server_url+'periodo/desactivar', formData)\r\n                    .then(res => {\r\n                        me.getAdmin();\r\n                        me.$vs.loading.close()\r\n                        me.$vs.notify({\r\n                            text: 'Periodo  actualizado',\r\n                            color: 'success',\r\n                            iconPack: 'feather',\r\n                            icon: 'icon-check'\r\n                        })\r\n                    })\r\n            } else {\r\n                me.$vs.notify({\r\n                    time: 8000,\r\n                    text: 'No tiene permiso para desactivar periodos escolares, consulte con el administrador.',\r\n                    color: 'danger',\r\n                    iconPack: 'feather',\r\n                    icon: 'icon-alert-triangle'\r\n                })\r\n            }\r\n        },\r\n        activar(idperiodoescolar) {\r\n            let me = this;\r\n            if (me.usuario_id == 5103 || me.usuario_id == 4853 || me.usuario_id == 35748) {\r\n                let formData = new FormData();\r\n                formData.append('idperiodoescolar', idperiodoescolar);\r\n                me.$vs.loading()\r\n                this.$http.post(this.$server_url+'periodo/activar', formData)\r\n                    .then(res => {\r\n                        me.getAdmin();\r\n                        me.$vs.loading.close()\r\n                        me.$vs.notify({\r\n                            text: 'Periodo  actualizado',\r\n                            color: 'success',\r\n                            iconPack: 'feather',\r\n                            icon: 'icon-check'\r\n                        })\r\n                    })\r\n            } else {\r\n                me.$vs.notify({\r\n                    time: 8000,\r\n                    text: 'No tiene permiso para activar periodos escolares, consulte con el administrador.',\r\n                    color: 'danger',\r\n                    iconPack: 'feather',\r\n                    icon: 'icon-alert-triangle'\r\n                })\r\n            }\r\n        },\r\n    },\r\n}\r\n</script>\r\n<style scoped>\r\n.features {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n.features li {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n}\r\n.features li + * {\r\n  margin-top: 0.75rem;\r\n}\r\n.features .icon {\r\n  background-color: #1FCAC5;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: #fff;\r\n  border-radius: 50%;\r\n  width: 20px;\r\n  height: 20px;\r\n}\r\n.features .icon svg {\r\n  width: 14px;\r\n  height: 14px;\r\n}\r\n.features + * {\r\n  margin-top: 1.25rem;\r\n}\r\n\r\n</style>\r\n\r\n"]}]}