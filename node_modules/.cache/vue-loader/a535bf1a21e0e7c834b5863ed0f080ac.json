{"remainingRequest":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\home\\components\\asesor\\escuelasAsesor.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\home\\components\\asesor\\escuelasAsesor.vue","mtime":1712682815970},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\nexport default {\r\n    data() {\r\n        return{\r\n          usuario:[],\r\n          escuelas:[],\r\n          region:'2',\r\n          isAdmin:'',\r\n          asesorDesdeAdmin:'',\r\n          periodoSelect:[],\r\n          popupActualizarPeriodo:false,\r\n          institucion:{},\r\n        }\r\n    },\r\n    created() {\r\n      let me = this;\r\n      me.usuario = JSON.parse(localStorage.getItem(\"usuario\"))\r\n      me.isAdmin = localStorage.getItem(\"adminSeguimiento\")\r\n      me.getEscuelas(); \r\n    },\r\n    methods:{\r\n      //cantidad de escuelas del asesor\r\n      async getEscuelas() {\r\n        let me = this;\r\n        if(me.isAdmin == \"yes\"){\r\n          me.asesorDesdeAdmin = localStorage.getItem(\"institucion_seguimiento_asesor_id\") \r\n        }else{\r\n          me.asesorDesdeAdmin = me.usuario.cedula\r\n        }\r\n        this.$http.get(this.$server_url+'escuelasAsesor?cedula=' + me.asesorDesdeAdmin+'&region='+me.region+'&individual=yes'+'&porRegion=yes')\r\n          .then(function (response) {\r\n            me.escuelas = response.data;      \r\n          })\r\n          .catch(function (error) {       \r\n          })\r\n      },\r\n      getPeriodos(){\r\n        let me = this\r\n        me.$vs.loading()\r\n        me.periodoSelect = []\r\n        this.$http.get(this.$server_url+'get_periodos_pedidos')\r\n        .then(res => {\r\n          me.$vs.loading.close()\r\n          let datos = res.data\r\n          if(datos.length == 0 ){\r\n            me.$vs.notify({\r\n            text:'No existe períodos para activar Comuniquese con soporte',\r\n            color:'warning',\r\n            iconPack: 'feather',\r\n            icon:'icon-check',\r\n            time:5000,\r\n            })\r\n            return\r\n          }\r\n          //obtener el perido activo de la region para activar a la escuela en ese periodo\r\n          if(datos.length > 0){\r\n            me.periodoSelect = datos.filter(p => p.cambiar_periodo == 1 && p.region_idregion == me.region)\r\n            //si no existe el periodo activo para la region para poder cambiar\r\n            if( me.periodoSelect.length == 0 ){\r\n              me.$vs.notify({\r\n              text:'No existe un período configurado para activar Comuniquese con soporte',\r\n              color:'warning',\r\n              iconPack: 'feather',\r\n              icon:'icon-check',\r\n              time:5000,\r\n              })\r\n              return\r\n            }\r\n            //si existe mas de un periodo activo para la region\r\n            if( me.periodoSelect.length > 1 ){\r\n              me.$vs.notify({\r\n              text:'Existe más de un período configurado para activar Comuniquese con soporte',\r\n              color:'warning',\r\n              iconPack: 'feather',\r\n              icon:'icon-check',\r\n              time:5000,\r\n              })\r\n              return\r\n            }\r\n            me.popupActualizarPeriodo = true;\r\n          }\r\n        })\r\n        .catch(function (error) {\r\n          me.$vs.loading.close();\r\n        })\r\n      },\r\n      changePeriodo() {\r\n        let me = this;\r\n        me.$vs.loading();\r\n        let data = new FormData();\r\n        data.append('idperiodoescolar', me.periodoSelect[0].idperiodoescolar);\r\n        data.append('idinstitucion',    me.institucion.id)\r\n        this.$http.post(this.$server_url + 'verifica_periodo', data)\r\n          .then(res => {\r\n            me.$vs.loading.close();\r\n            if (res.data == 1) {\r\n              me.$vs.notify({\r\n                time: 8000,\r\n                text: 'Este periodo ya se encuentra asignado a la institucion ' + me.institucion.label,\r\n                color: 'danger',\r\n                iconPack: 'feather',\r\n                icon: 'icon-alert-triangle'\r\n              })\r\n            } else {\r\n              me.$vs.notify({\r\n                text: 'Periodo agregado correctamente a la institucion ' + me.institucion.label,\r\n                color: 'success',\r\n                iconPack: 'feather',\r\n                icon: 'icon-check'\r\n              })\r\n            }\r\n            me.getEscuelas()\r\n            me.institucion            = {}\r\n            me.popupActualizarPeriodo = false;\r\n          })\r\n          .catch(err => {\r\n              console.log(err);\r\n              me.$vs.loading.close();\r\n          })\r\n      },\r\n      SeguimientoInstitucion(tr){\r\n        let me = this;\r\n        if(me.isAdmin == \"yes\"){\r\n          me.$router.push('/administrador/seguimiento/institucion')\r\n        }else{\r\n          me.$router.push('/asesor/seguimiento/institucion')\r\n        }\r\n        localStorage.setItem('institucion_seguimiento_id',tr.id)\r\n        localStorage.setItem('institucion_seguimiento_nombre',tr.label)\r\n        localStorage.setItem('institucion_seguimiento_periodo_id',tr.id_periodo)\r\n        localStorage.setItem('institucion_seguimiento_periodo',tr.periodo)\r\n      },\r\n    }\r\n}\r\n",{"version":3,"sources":["escuelasAsesor.vue"],"names":[],"mappings":";AAyEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"escuelasAsesor.vue","sourceRoot":"src/views/home/components/asesor","sourcesContent":["<template>\r\n  <div>\r\n    <vs-card v-if=\"usuario.id_group == 11 || usuario.id_group == 1\"> \r\n      <div>\r\n        <vs-table max-items=\"10\" search pagination :data=\"escuelas\">\r\n          <template slot=\"header\">\r\n            <ul class=\"leftx\" style=\"display:flex;flex-direction: row;\">\r\n              <li class=\"ml-2\">\r\n              <vs-radio v-model=\"region\" vs-name=\"radios1\" @input=\"getEscuelas()\" vs-value=\"1\">Sierra</vs-radio>\r\n              </li>\r\n              <li class=\"ml-2\">\r\n              <vs-radio v-model=\"region\" vs-name=\"radios1\" @input=\"getEscuelas()\" vs-value=\"2\">Costa</vs-radio>\r\n              </li>\r\n              <li>\r\n                <vs-chip class=\"ml-3\" transparent color=\"danger\" style=\"margin-top:-3px;\">\r\n                  Cantidad {{ escuelas.length }}\r\n                </vs-chip>\r\n              </li>\r\n            </ul>\r\n          </template>\r\n          <template slot=\"thead\">\r\n            <vs-th>Instituciones</vs-th>\r\n            <vs-th>Ciudad</vs-th>\r\n            <vs-th>Período</vs-th>\r\n            <vs-th>Acciones</vs-th>\r\n          </template>\r\n          <template slot-scope=\"{data}\">\r\n            <vs-tr :key=\"indextr\" v-for=\"(tr, indextr) in data\">\r\n              <vs-td>\r\n                  {{data[indextr].label}}<br>\r\n                  <vs-chip color=\"warning\" class=\"mt-1\" v-if=\"tr.visitas > 0\">\r\n                      Visitas Pendientes\r\n                  </vs-chip>\r\n              </vs-td>\r\n              <vs-td>\r\n                  {{data[indextr].nombre_ciudad}}<br>\r\n              </vs-td>\r\n              <vs-td>\r\n                  <p> {{ tr.periodo }}</p>\r\n                    <vs-chip :color=\"tr.estado == 1?'primary':'danger'\">\r\n                      {{tr.estado == 1 ?'Activo':'No activo'}}\r\n                  </vs-chip> \r\n              </vs-td>\r\n              <vs-td>\r\n                <div style=\"display:flex;\">\r\n                  <vx-tooltip text=\"Activar a período actual\" position=\"top\" color=\"danger\">\r\n                    <vs-button @click=\"institucion = tr;getPeriodos();\" color=\"dark\" icon-pack=\"feather\" type=\"line\" icon=\"icon-aperture\">Activar a período actual</vs-button>\r\n                  </vx-tooltip>\r\n                  <vx-tooltip text=\"Seguimiento de la institución\" position=\"top\" color=\"danger\">\r\n                    <vs-button radius @click =\"SeguimientoInstitucion(tr)\" color=\"success\" class=\"ml-2\" type=\"line\" icon=\"event_note\"></vs-button>\r\n                  </vx-tooltip>\r\n                </div>\r\n              </vs-td>   \r\n            </vs-tr>\r\n          </template>\r\n        </vs-table>   \r\n      </div>\r\n      <!--MODALES-->\r\n      <!--MODAL PARA CAMBIAR DE PERIODO-->\r\n      <vs-popup classContent=\"popup-example\" title=\"Actualizar a periodo actual\" :active.sync=\"popupActualizarPeriodo\">\r\n        <vx-card v-if=\"popupActualizarPeriodo\">\r\n          <p><b>Insitución:</b>       {{ institucion.label }}  </p>\r\n          <p class=\"font-bold text-2xl text-warning mt-2\">Estas seguro de cambiar al periodo {{ periodoSelect[0].periodoescolar }}?</p>\r\n          <div class=\"flex justify-center mt-2\">\r\n            <vs-button class=\"mr-3 mb-2\" @click=\"changePeriodo()\">Si, deseo cambiar</vs-button>\r\n            <vs-button color=\"warning\" type=\"border\" class=\"mb-2\" @click=\"popupActualizarPeriodo = false;\">Cancelar</vs-button>\r\n          </div>\r\n        </vx-card>\r\n      </vs-popup>\r\n    </vs-card>\r\n  </div>\r\n</template>\r\n<script>\r\nexport default {\r\n    data() {\r\n        return{\r\n          usuario:[],\r\n          escuelas:[],\r\n          region:'2',\r\n          isAdmin:'',\r\n          asesorDesdeAdmin:'',\r\n          periodoSelect:[],\r\n          popupActualizarPeriodo:false,\r\n          institucion:{},\r\n        }\r\n    },\r\n    created() {\r\n      let me = this;\r\n      me.usuario = JSON.parse(localStorage.getItem(\"usuario\"))\r\n      me.isAdmin = localStorage.getItem(\"adminSeguimiento\")\r\n      me.getEscuelas(); \r\n    },\r\n    methods:{\r\n      //cantidad de escuelas del asesor\r\n      async getEscuelas() {\r\n        let me = this;\r\n        if(me.isAdmin == \"yes\"){\r\n          me.asesorDesdeAdmin = localStorage.getItem(\"institucion_seguimiento_asesor_id\") \r\n        }else{\r\n          me.asesorDesdeAdmin = me.usuario.cedula\r\n        }\r\n        this.$http.get(this.$server_url+'escuelasAsesor?cedula=' + me.asesorDesdeAdmin+'&region='+me.region+'&individual=yes'+'&porRegion=yes')\r\n          .then(function (response) {\r\n            me.escuelas = response.data;      \r\n          })\r\n          .catch(function (error) {       \r\n          })\r\n      },\r\n      getPeriodos(){\r\n        let me = this\r\n        me.$vs.loading()\r\n        me.periodoSelect = []\r\n        this.$http.get(this.$server_url+'get_periodos_pedidos')\r\n        .then(res => {\r\n          me.$vs.loading.close()\r\n          let datos = res.data\r\n          if(datos.length == 0 ){\r\n            me.$vs.notify({\r\n            text:'No existe períodos para activar Comuniquese con soporte',\r\n            color:'warning',\r\n            iconPack: 'feather',\r\n            icon:'icon-check',\r\n            time:5000,\r\n            })\r\n            return\r\n          }\r\n          //obtener el perido activo de la region para activar a la escuela en ese periodo\r\n          if(datos.length > 0){\r\n            me.periodoSelect = datos.filter(p => p.cambiar_periodo == 1 && p.region_idregion == me.region)\r\n            //si no existe el periodo activo para la region para poder cambiar\r\n            if( me.periodoSelect.length == 0 ){\r\n              me.$vs.notify({\r\n              text:'No existe un período configurado para activar Comuniquese con soporte',\r\n              color:'warning',\r\n              iconPack: 'feather',\r\n              icon:'icon-check',\r\n              time:5000,\r\n              })\r\n              return\r\n            }\r\n            //si existe mas de un periodo activo para la region\r\n            if( me.periodoSelect.length > 1 ){\r\n              me.$vs.notify({\r\n              text:'Existe más de un período configurado para activar Comuniquese con soporte',\r\n              color:'warning',\r\n              iconPack: 'feather',\r\n              icon:'icon-check',\r\n              time:5000,\r\n              })\r\n              return\r\n            }\r\n            me.popupActualizarPeriodo = true;\r\n          }\r\n        })\r\n        .catch(function (error) {\r\n          me.$vs.loading.close();\r\n        })\r\n      },\r\n      changePeriodo() {\r\n        let me = this;\r\n        me.$vs.loading();\r\n        let data = new FormData();\r\n        data.append('idperiodoescolar', me.periodoSelect[0].idperiodoescolar);\r\n        data.append('idinstitucion',    me.institucion.id)\r\n        this.$http.post(this.$server_url + 'verifica_periodo', data)\r\n          .then(res => {\r\n            me.$vs.loading.close();\r\n            if (res.data == 1) {\r\n              me.$vs.notify({\r\n                time: 8000,\r\n                text: 'Este periodo ya se encuentra asignado a la institucion ' + me.institucion.label,\r\n                color: 'danger',\r\n                iconPack: 'feather',\r\n                icon: 'icon-alert-triangle'\r\n              })\r\n            } else {\r\n              me.$vs.notify({\r\n                text: 'Periodo agregado correctamente a la institucion ' + me.institucion.label,\r\n                color: 'success',\r\n                iconPack: 'feather',\r\n                icon: 'icon-check'\r\n              })\r\n            }\r\n            me.getEscuelas()\r\n            me.institucion            = {}\r\n            me.popupActualizarPeriodo = false;\r\n          })\r\n          .catch(err => {\r\n              console.log(err);\r\n              me.$vs.loading.close();\r\n          })\r\n      },\r\n      SeguimientoInstitucion(tr){\r\n        let me = this;\r\n        if(me.isAdmin == \"yes\"){\r\n          me.$router.push('/administrador/seguimiento/institucion')\r\n        }else{\r\n          me.$router.push('/asesor/seguimiento/institucion')\r\n        }\r\n        localStorage.setItem('institucion_seguimiento_id',tr.id)\r\n        localStorage.setItem('institucion_seguimiento_nombre',tr.label)\r\n        localStorage.setItem('institucion_seguimiento_periodo_id',tr.id_periodo)\r\n        localStorage.setItem('institucion_seguimiento_periodo',tr.periodo)\r\n      },\r\n    }\r\n}\r\n</script>"]}]}