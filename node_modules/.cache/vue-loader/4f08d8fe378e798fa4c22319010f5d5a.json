{"remainingRequest":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\soporte\\ticketCerrado.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\soporte\\ticketCerrado.vue","mtime":1712682816546},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\nimport flatPickr from 'vue-flatpickr-component';\r\nimport 'flatpickr/dist/flatpickr.css';\r\nimport vSelect from 'vue-select';\r\nimport pdfMake from \"pdfmake/build/pdfmake\";\r\nvar pdfFonts = require ('pdfmake/build/vfs_fonts.js');\r\npdfMake.vfs = pdfFonts.pdfMake.vfs;\r\n\r\nexport default{\r\n  created () {\r\n      let me = this;\r\n      me.usuario = JSON.parse(localStorage.getItem(\"usuario\"))\r\n  },\r\n  components:{\r\n       'v-select': vSelect,\r\n        flatPickr,\r\n  },\r\n    data(){\r\n        return{\r\n            usuario:[],\r\n            instituciones:[],\r\n            popupFiltroReporte:false,\r\n            ticket:{\r\n                razonBusqueda:'',\r\n            },\r\n            tickets:[],\r\n            ticketsRespuesta:[],\r\n            ticketsReporteGeneral:[],\r\n            ticket_id:0,\r\n            valorBusqueda:'0',\r\n            busqueda:'cedula',\r\n            fromDate: null,\r\n            toDate: null,\r\n            configdateTimePicker: {\r\n                enableTime: true,\r\n                dateFormat: 'Y-m-d'\r\n            },\r\n            reporteTicket:{\r\n                institucion:\"\",\r\n            }\r\n        }\r\n    },\r\n    methods:{\r\n        //para dar seguimiento al ticket\r\n        SeguimientoTicket(ticket_id,asunto,usuario,email,estado){\r\n            let me = this;\r\n            localStorage.setItem(\"ticket_id\",ticket_id);\r\n            localStorage.setItem(\"asunto\",asunto);\r\n            localStorage.setItem(\"usuario_ticket\",usuario);\r\n            localStorage.setItem(\"email_ticket\",email);\r\n            localStorage.setItem(\"estado_ticket\",estado);\r\n            localStorage.setItem(\"ticketAyuda\",\"no\");\r\n            me.$router.push('/soporte/ticket/abierto/');\r\n        },\r\n         openConfirm(ticket_id){\r\n            let me =this;\r\n            me.ticket_id = ticket_id;\r\n            me.$vs.dialog({\r\n                type:'confirm',\r\n                color: 'danger',\r\n                title: `Confirm`,\r\n                text: 'Estas seguro/a de cambiar de estado el ticket.',\r\n                accept:me.AbrirTicket\r\n            })\r\n        },\r\n       AbrirTicket(){\r\n            let me = this;\r\n            me.$vs.loading();\r\n            this.$http.get(this.$server_url+\"ticket?estadoChange=yes&estado=1&ticket_id=\"+me.ticket_id)\r\n                .then(function (res) {                \r\n                    me.$vs.loading.close()\r\n                    me.$vs.notify({\r\n                    text:'Ticket cambiado con exito',\r\n                    color:'success',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                    me.busquedaFiltroEstudiante();\r\n                })\r\n                .catch(function (error) {\r\n                    console.log(error + ' error');\r\n                    me.$vs.loading.close()\r\n                })\r\n        },\r\n        busquedaFiltroEstudiante(){\r\n            let me = this;\r\n            me.tickets = [];\r\n            //para el filtro por numero del ticket\r\n            if(me.busqueda == 'numero'){\r\n                if(me.ticket.razonBusqueda.length < 1){      \r\n                    me.$vs.notify({\r\n                    text:'Minimo 1 caracter de busqueda',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})  \r\n                    return false;    \r\n                }\r\n            }\r\n            //para el filtro por fechas\r\n            if(me.busqueda == 'fecha'){\r\n                 if(me.fromDate == null){\r\n                      me.$vs.notify({\r\n                        text: 'Debe escoger una fecha inicio',\r\n                        color:'warning',\r\n                        iconPack: 'feather',\r\n                        icon:'icon-check'})\r\n                    return false;\r\n                }\r\n                if(me.toDate == null){\r\n                    me.$vs.notify({\r\n                        text: 'Debe escoger una fecha final',\r\n                        color:'warning',\r\n                        iconPack: 'feather',\r\n                        icon:'icon-check'})\r\n                        return false;\r\n                }\r\n                if(me.fromDate > me.toDate){\r\n                    me.$vs.notify({\r\n                        text: 'La fecha inicio no puede mayor que la fecha final',\r\n                        color:'warning',\r\n                        iconPack: 'feather',\r\n                        icon:'icon-check'})\r\n                    return false;\r\n                }\r\n            }\r\n            if(me.busqueda == 'cedula' || me.busqueda == 'institucion' ){\r\n                if(me.ticket.razonBusqueda.length < 5){     \r\n                    me.$vs.notify({\r\n                    text:'Minimo 5 caracteres de busqueda',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})  \r\n                    return false;    \r\n                }\r\n            }\r\n            me.$vs.loading();\r\n            this.$http.get(this.$server_url+'ticket?busqueda='+me.busqueda+'&razonBusqueda='+me.ticket.razonBusqueda+'&fromDate='+me.fromDate+'&toDate='+me.toDate)\r\n                .then(function (res) {\r\n                     me.$vs.loading.close()\r\n                     if(res.data.status == '0'){\r\n                        me.$vs.notify({\r\n                        text: res.data.message,\r\n                        color:'primary',\r\n                        iconPack: 'feather',\r\n                        icon:'icon-check'})\r\n                        return false;\r\n                    }else{\r\n                        let datos = res.data.ticketCerrado\r\n                        if(me.usuario.id_group == '1'){\r\n                        me.tickets = datos.filter(p => p.ticket_asesor == '0')\r\n                        me.cantTickets = me.tickets.length\r\n                        }else{\r\n                            me.tickets = datos.filter(p => p.ticket_asesor == '1' && p.vendedorInstitucion == me.usuario.cedula)\r\n                            me.cantTickets = me.tickets.length\r\n                        }\r\n                        me.instituciones = res.data.filtroInstituciones\r\n                        // me.fromDate = null;\r\n                        // me.toDate = null;\r\n                        me.ticket.razonBusqueda = '';\r\n                    }\r\n                })\r\n                .catch(function (error) {\r\n                    console.log(error + ' error');\r\n                    me.$vs.loading.close()\r\n                })\r\n        },\r\n        getTicketRespuesta(ticket_id,asunto,codigo,nombreInstitucion) {\r\n            let me = this;\r\n            localStorage.setItem(\"asunto\",asunto);\r\n            localStorage.setItem(\"ticket_id\",ticket_id);\r\n             localStorage.setItem(\"ticket_codigo\",codigo);\r\n            localStorage.setItem(\"ticket_nombreInstitucion\",nombreInstitucion);\r\n            me.$vs.loading();\r\n            this.$http.get(this.$server_url+'ticket?RespuestaTicketAbiertoReporte=yes&ticket_id='+ticket_id)\r\n                .then(function (res) {\r\n                    me.ticketsRespuesta = res.data\r\n                    me.$vs.loading.close()\r\n                    me.reporte();\r\n                })\r\n                .catch(function (error) {\r\n                    console.log(error + ' error');\r\n                    me.$vs.loading.close()\r\n                })\r\n        },\r\n        //filtro reporte por fechas\r\n        ModalReporteGeneral(){\r\n            let me = this;\r\n            me.popupFiltroReporte = true;\r\n        },\r\n        filtrarReporteGeneral(){\r\n            let me = this;\r\n            if(me.reporteTicket.institucion == \"\"){\r\n                me.$vs.notify({\r\n                    text: 'Debe escoger una institucion',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                return false;\r\n            }\r\n           if(me.fromDate == null){\r\n               me.$vs.notify({\r\n                    text: 'Debe escoger una fecha inicio',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                return false;\r\n           }\r\n            if(me.toDate == null){\r\n               me.$vs.notify({\r\n                    text: 'Debe escoger una fecha final',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                return false;\r\n           }\r\n            if(me.fromDate > me.toDate){\r\n                 me.$vs.notify({\r\n                    text: 'La fecha inicio no puede mayor que la fecha final',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                return false;\r\n            }\r\n            localStorage.setItem(\"ticket_nombreInstitucion\",me.reporteTicket.institucion.nombreInstitucion);\r\n            me.$vs.loading();\r\n            this.$http.get(this.$server_url+'ticket?reporteGeneral=yes&institucion_id='+me.reporteTicket.institucion.idInstitucion+'&fromDate='+me.fromDate+'&toDate='+me.toDate)\r\n                .then(function (res) {\r\n                    me.ticketsReporteGeneral = res.data\r\n                    me.$vs.loading.close()\r\n                    if(res.data.status == '0'){\r\n                        me.$vs.notify({\r\n                        text: res.data.message,\r\n                        color:'primary',\r\n                        iconPack: 'feather',\r\n                        icon:'icon-check'})\r\n                        return false;\r\n                    }else{\r\n                        me.reporteGeneral();\r\n                        me.popupFiltroReporte = false;\r\n                        me.fromDate = null;\r\n                        me.toDate = null;\r\n                    }\r\n                })\r\n                .catch(function (error) {\r\n                    console.log(error + ' error');\r\n                    me.$vs.loading.close()\r\n                })\r\n        },\r\n        //para generar el reporte General\r\n        reporteGeneral() {\r\n            var body = [];\r\n            body.push([{text: 'Ticket'},{text: 'Usuario'},{text: 'asunto'}, {text: 'Duracion'},]);\r\n            for (var key in this.ticketsReporteGeneral) \r\n            {\r\n                if (this.ticketsReporteGeneral.hasOwnProperty(key))\r\n                {\r\n                    var item = this.ticketsReporteGeneral[key];\r\n                    var fila = new Array();\r\n                    fila.push([ { text:'Ticket #: '+item.ticket_id.toString(), style: 'codigo' }, { text:'Grupo: '+item.rol.toString(), style: 'codigo' },{ text:'codigo: '+item.codigo.toString(), style: 'usuario' },{ text:'Interacciones: '+item.cantidad.toString(), style: 'usuario' },])\r\n                    fila.push([ { text:'Nombres: '+item.usuario.toString(), style: 'codigo' },{ text:'cedula: '+item.cedula.toString(), style: 'usuario' },])\r\n                    fila.push( item.descripcion.toString() );\r\n                    fila.push( item.dias.toString() + ' dias'  );\r\n                    body.push(fila);\r\n                }\r\n            }\r\n            var dd = {\r\n                content: [\r\n                    { text:'Reporte General de tickets de'+' '+localStorage.getItem(\"ticket_nombreInstitucion\"), style: 'header' },\r\n                    ' ',\r\n                    ' ',\r\n                    {\r\n                        table: \r\n                        {\r\n                            headerRows: 1,\r\n                            body: body\r\n                        }\r\n                    }\r\n                ],\r\n                styles: {\r\n                    header: {\r\n                        fontSize: 18,\r\n                        bold: true,\r\n                        alignment: 'center'\r\n                    },\r\n                     codigo: {\r\n                    italics: true,\r\n                    alignment: 'left',\r\n                    },\r\n                    usuario: {\r\n                    italics: true,\r\n                    alignment: 'left',\r\n                    },\r\n                }\r\n            };\r\n         pdfMake.createPdf(dd).download(\"TicketGeneral.pdf\");\r\n        },\r\n        //para generar el reporte\r\n        reporte() {\r\n            var body = [];\r\n            body.push([{text: 'Grupo'},{text: 'Usuario'},{text: 'mensaje'}, {text: 'fecha'},]);\r\n            for (var key in this.ticketsRespuesta) \r\n            {\r\n                if (this.ticketsRespuesta.hasOwnProperty(key))\r\n                {\r\n                    var item = this.ticketsRespuesta[key];\r\n                    var fila = new Array();\r\n                    fila.push( item.rol.toString() );\r\n                    fila.push([ { text:'Nombres: '+item.usuario.toString(), style: 'codigo' },{ text:'cedula: '+item.cedula.toString(), style: 'usuario' },])\r\n                    fila.push( item.descripcion.toString() );\r\n                    fila.push( item.fecha.toString()  );\r\n                    body.push(fila);\r\n                }\r\n            }\r\n            var dd = {\r\n                content: [\r\n                    { text:'Ticket #'+localStorage.getItem(\"ticket_id\")+ ' '+localStorage.getItem(\"asunto\") , style: 'header' },\r\n                    ' ',\r\n                    ' ',\r\n                    { text:'Codigo: '+localStorage.getItem(\"ticket_codigo\"), style: 'codigo' },\r\n                    \r\n                    { text:'Institucion: '+localStorage.getItem(\"ticket_nombreInstitucion\"), style: 'institucion' },\r\n                    ' ',\r\n                    ' ',\r\n                    {\r\n                        table: \r\n                        {\r\n                            headerRows: 1,\r\n                            body: body\r\n                        }\r\n                    }\r\n                ],\r\n                styles: {\r\n                    header: {\r\n                        fontSize: 18,\r\n                        bold: true,\r\n                        alignment: 'center'\r\n                    },\r\n                    codigo: {\r\n                    italics: true,\r\n                    alignment: 'left',\r\n                    bold: true,\r\n                    },\r\n                    usuario: {\r\n                    italics: true,\r\n                    alignment: 'left',\r\n                    },\r\n                    institucion: {\r\n                    italics: true,\r\n                    alignment: 'left',\r\n                    bold: true,\r\n                    }\r\n                }\r\n            };\r\n         pdfMake.createPdf(dd).download(\"TicketIndividual.pdf\");\r\n       },\r\n    },\r\n}\r\n",{"version":3,"sources":["ticketCerrado.vue"],"names":[],"mappings":";AAwLA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ticketCerrado.vue","sourceRoot":"src/views/soporte","sourcesContent":["<template>\r\n    <div>\r\n        <vs-card>\r\n            <vs-row vs-justify=\"flex-start\">\r\n                <vs-col type=\"flex\" vs-justify=\"flex-start\" vs-align=\"flex-start\" class=\"m-2\" vs-w=\"12\">\r\n                    <p>Filtro de busqueda</p>\r\n                    <br>\r\n                    <vs-card>\r\n\r\n                        <vs-row>\r\n                            <vs-divider color=\"success\">*Filtro por Fechas</vs-divider>\r\n\r\n                            <vs-col  vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"6\">\r\n                            <flat-pickr :config=\"configdateTimePicker\" v-model=\"fromDate\"  placeholder=\"Fecha Inicio\" class=\"m-1\" style=\"display: inline-block;width: 100%;\" />\r\n                            </vs-col>\r\n\r\n                            <vs-col  vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"6\">\r\n                            <flat-pickr :config=\"configdateTimePicker\" v-model=\"toDate\" placeholder=\"Fecha Fin\" class=\"m-1\" style=\"display: inline-block;width: 100%\" />\r\n                            </vs-col>\r\n                            <vs-divider color=\"success\">Filtro por criterio</vs-divider>\r\n\r\n                            <br/>  <br/>\r\n                            <vs-col  vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n                                    <vs-input class=\"w-full\" icon-after=\"true\" label-placeholder=\"icon-after\" style=\"margin:0px 0px 20px 0px;\"  icon=\"search\" placeholder=\"Ingrese el criterio de busqueda\"  v-model=\"ticket.razonBusqueda\"/>\r\n                           \r\n                            </vs-col>\r\n                        </vs-row>\r\n                    \r\n                        \r\n                        <div style=\"\">\r\n                        \r\n                            <ul class=\"leftx\" style=\"display:flex;margin:0px 0px 0px 20px;\">\r\n                                <li class=\"modelx\">\r\n                        \r\n                                </li>\r\n                                <li style=\"margin:10px 20px 0px 0px;\">\r\n                                    <vs-radio vs-name=\"radios1\" vs-value=\"0\" v-model=\"valorBusqueda\" @input=\"busqueda='cedula'\">Cedula</vs-radio>\r\n                                </li>\r\n\r\n                                <li style=\"margin:10px 10px 0px 0px;\">\r\n                                    <vs-radio vs-name=\"radios1\" vs-value=\"1\" v-model=\"valorBusqueda\"  @input=\"busqueda='institucion'\">Institucion</vs-radio>\r\n                                </li>\r\n\r\n                                <li style=\"margin:10px 20px 0px 0px;\">\r\n                                \r\n                                    <vs-radio vs-name=\"radios1\" vs-value=\"2\" v-model=\"valorBusqueda\" @input=\"busqueda='numero'\">Ticket</vs-radio>\r\n                                </li>\r\n\r\n                                 <li style=\"margin:10px 20px 0px 0px;\">\r\n                                    <vs-radio vs-name=\"radios1\" vs-value=\"3\" v-model=\"valorBusqueda\" @input=\"busqueda='fecha'\">Fecha</vs-radio>\r\n                                </li>\r\n\r\n                                <li>\r\n                                    <vs-button color=\"warning\" type=\"filled\" style=\"margin-left:10px;\" @click=\"busquedaFiltroEstudiante();\" icon=\"search\"></vs-button>\r\n                                </li>\r\n                            \r\n                            </ul>\r\n                        </div>    \r\n\r\n                    </vs-card>\r\n                </vs-col>\r\n            </vs-row>\r\n\r\n             <br/>\r\n\r\n             \r\n\r\n            <div v-if=\"tickets.length >0 \">\r\n                <br/>\r\n                <p style=\"font-size:14px;\" >Cantidad: <span style=\"color:coral;font-weight:bold;\">{{ cantTickets }}</span></p>\r\n            \r\n                <br/>\r\n                    <vx-tooltip style=\"display: inline-block;\" text=\"Reporte General\" position=\"top\" color=\"primary\">\r\n                         <vs-button class=\"modal-default-button\" style=\"margin-left:20px;\"  size=\"small\" @click=\"ModalReporteGeneral()\" color=\"warning\"  type=\"filled\" icon-pack=\"feather\" icon=\"icon-file-text\"> </vs-button>\r\n                    </vx-tooltip> &nbsp;\r\n                <!-- <vs-button color=\"dark\" @click=\"limpiar();popupAddTema=true;\"   type=\"filled\">Crear Area</vs-button> -->\r\n                <vs-table max-items=\"10\" search pagination :data=\"tickets\" style=\"margin-top:-40px\">\r\n                    <template slot=\"thead\">\r\n                        <vs-th>Ticket #</vs-th>\r\n                        <vs-th>Grupo</vs-th>\r\n                        <vs-th>Asunto</vs-th>\r\n                        <vs-th>Codigo</vs-th>\r\n                        <vs-th>Fecha</vs-th>\r\n                        <vs-th>Usuario</vs-th>\r\n                        <vs-th>Estado</vs-th>\r\n                        <vs-th>Acciones</vs-th>\r\n                    </template>\r\n                    <template slot-scope=\"{data}\">\r\n                        <vs-tr :key=\"indextr\" v-for=\"(tr, indextr) in data\">\r\n                            <vs-td>\r\n                             {{data[indextr].ticket_id}}<br>\r\n                            \r\n                            </vs-td>\r\n                            <vs-td>\r\n                            \r\n                                {{data[indextr].rol}}<br>\r\n                                \r\n                            </vs-td>\r\n                            <vs-td>\r\n                                {{data[indextr].descripcion}}<br>\r\n                            </vs-td>\r\n                            <vs-td>\r\n                                <div v-if=\"tr.codigo == '0'\">\r\n\r\n                                </div>\r\n                                <div v-else>\r\n                                     {{data[indextr].codigo}}<br>\r\n                                </div>\r\n\r\n                           \r\n                            </vs-td>\r\n                            <vs-td>\r\n                                <p style=\"font-size:11px;\">{{ tr.fecha_ticket }} </p>\r\n                                <p  style=\"font-size:11px;margin-top;3px;\">{{ tr.fecha_ticket_final }}</p>\r\n                                <p style=\"color:coral;font-size:11px;\">Duracion:<span style=\"color:#9CC5E5;\">{{tr.dias}} dias</span></p>\r\n                            </vs-td>\r\n                            <vs-td>\r\n                                <p style=\"color:coral;font-size:12px;letter-spacing:1px;\">Nombre: <span style=\"color:#2A9FF6;letter-spacing:0px;\">{{ tr.usuario }}</span></p>\r\n                                <p style=\"color:coral;font-size:12px;letter-spacing:1px;\">Cedula: <span style=\"color:#2A9FF6;letter-spacing:0px;\">{{ tr.cedula }}</span></p>\r\n                                <p style=\"color:coral;font-size:12px;letter-spacing:1px;\">Email: <span style=\"color:#2A9FF6;letter-spacing:0px;\">{{ tr.email }}</span></p>\r\n                                <p style=\"color:coral;font-size:12px;letter-spacing:1px;\">Institucion: <span style=\"color:#2A9FF6;letter-spacing:0px;\">{{ tr.nombreInstitucion }}</span></p>\r\n                            </vs-td>\r\n\r\n                            <vs-td>\r\n                                <div v-if=\"tr.estado == '1'\">\r\n                                    <p>Abierto</p>\r\n                                </div>\r\n                                <div v-else>\r\n                                    <p>Cerrada</p>    \r\n                                </div>\r\n                            </vs-td>\r\n\r\n                            <vs-td>\r\n                                <div style=\"display:flex;\">\r\n                                    <vx-tooltip style=\"display: inline-block;\" text=\"Siguimiento del ticket\" position=\"top\" color=\"primary\">\r\n                                    <vs-button class=\"modal-default-button\" size=\"small\" color=\"success\" @click=\"SeguimientoTicket(tr.ticket_id,tr.descripcion,tr.usuario,tr.email,tr.estado)\" type=\"filled\" icon-pack=\"feather\" icon=\"icon-edit\"> </vs-button>\r\n                                    </vx-tooltip> &nbsp;\r\n\r\n                                    <vx-tooltip style=\"display: inline-block;\" text=\"Activar ticket\" position=\"top\" color=\"primary\">\r\n                                    <vs-button class=\"modal-default-button\"  @click=\"openConfirm(tr.ticket_id)\" size=\"small\" color=\"primary\"  type=\"filled\" icon-pack=\"feather\" icon=\"icon-check\"> </vs-button>\r\n                                    </vx-tooltip> &nbsp;\r\n\r\n                                    <vx-tooltip style=\"display: inline-block;\" text=\"Reporte ticket\" position=\"top\" color=\"primary\">\r\n                                    <vs-button class=\"modal-default-button\" @click=\"getTicketRespuesta(tr.ticket_id,tr.descripcion,tr.codigo,tr.nombreInstitucion)\" size=\"small\" color=\"dark\"  type=\"filled\" icon-pack=\"feather\" icon=\"icon-file-text\"> </vs-button>\r\n                                    </vx-tooltip> &nbsp;  \r\n\r\n                                </div>\r\n                        \r\n                            </vs-td>\r\n                      \r\n                        </vs-tr>\r\n                    </template>\r\n                </vs-table>   \r\n            </div>\r\n            <div v-else class=\"p-3\">\r\n                <p> No existe tickets cerrados aun. </p>\r\n            </div>\r\n        </vs-card>\r\n        <!--MODALES-->\r\n        <!--Modal para filtro de reporte de ticket por institucion-->\r\n        <vs-popup class=\"holamundo\"  title=\"Filtro de Reporte General de Tickets\" :active.sync=\"popupFiltroReporte\">\r\n            <p style=\"color:coral;font-weight:500;margin-bottom:10px;font-size:11px;\">* Seleccione una institucion</p>\r\n            <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" style=\"margin-bottom:20px;\" vs-w=\"12\">\r\n                <v-select :options=\"instituciones\" :reduce=\"instituciones => instituciones\" label=\"nombreInstitucion\" class=\"w-full\" v-model=\"reporteTicket.institucion\" />\r\n            </vs-col>\r\n            <vs-row>\r\n                <p style=\"color:coral;font-weight:500;margin-bottom:10px;font-size:11px;\">* Seleccione una fecha inicio - hasta para filtrar el Reporte</p>\r\n                <vs-col  vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"6\">\r\n                   <flat-pickr :config=\"configdateTimePicker\" v-model=\"fromDate\"  placeholder=\"Fecha Inicio\" class=\"m-1\" style=\"display: inline-block;width: 100%;\" />\r\n                </vs-col>\r\n                <vs-col  vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"6\">\r\n                  <flat-pickr :config=\"configdateTimePicker\" v-model=\"toDate\" placeholder=\"Fecha Fin\" class=\"m-1\" style=\"display: inline-block;width: 100%\" />\r\n                </vs-col>\r\n            </vs-row>\r\n             <vs-row>\r\n                <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\" style=\"margin-top:20px;\">\r\n                    <vs-button  type=\"gradient\" @click=\"filtrarReporteGeneral()\">Generar Pdf</vs-button>\r\n                </vs-col>\r\n            </vs-row>\r\n        </vs-popup>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport flatPickr from 'vue-flatpickr-component';\r\nimport 'flatpickr/dist/flatpickr.css';\r\nimport vSelect from 'vue-select';\r\nimport pdfMake from \"pdfmake/build/pdfmake\";\r\nvar pdfFonts = require ('pdfmake/build/vfs_fonts.js');\r\npdfMake.vfs = pdfFonts.pdfMake.vfs;\r\n\r\nexport default{\r\n  created () {\r\n      let me = this;\r\n      me.usuario = JSON.parse(localStorage.getItem(\"usuario\"))\r\n  },\r\n  components:{\r\n       'v-select': vSelect,\r\n        flatPickr,\r\n  },\r\n    data(){\r\n        return{\r\n            usuario:[],\r\n            instituciones:[],\r\n            popupFiltroReporte:false,\r\n            ticket:{\r\n                razonBusqueda:'',\r\n            },\r\n            tickets:[],\r\n            ticketsRespuesta:[],\r\n            ticketsReporteGeneral:[],\r\n            ticket_id:0,\r\n            valorBusqueda:'0',\r\n            busqueda:'cedula',\r\n            fromDate: null,\r\n            toDate: null,\r\n            configdateTimePicker: {\r\n                enableTime: true,\r\n                dateFormat: 'Y-m-d'\r\n            },\r\n            reporteTicket:{\r\n                institucion:\"\",\r\n            }\r\n        }\r\n    },\r\n    methods:{\r\n        //para dar seguimiento al ticket\r\n        SeguimientoTicket(ticket_id,asunto,usuario,email,estado){\r\n            let me = this;\r\n            localStorage.setItem(\"ticket_id\",ticket_id);\r\n            localStorage.setItem(\"asunto\",asunto);\r\n            localStorage.setItem(\"usuario_ticket\",usuario);\r\n            localStorage.setItem(\"email_ticket\",email);\r\n            localStorage.setItem(\"estado_ticket\",estado);\r\n            localStorage.setItem(\"ticketAyuda\",\"no\");\r\n            me.$router.push('/soporte/ticket/abierto/');\r\n        },\r\n         openConfirm(ticket_id){\r\n            let me =this;\r\n            me.ticket_id = ticket_id;\r\n            me.$vs.dialog({\r\n                type:'confirm',\r\n                color: 'danger',\r\n                title: `Confirm`,\r\n                text: 'Estas seguro/a de cambiar de estado el ticket.',\r\n                accept:me.AbrirTicket\r\n            })\r\n        },\r\n       AbrirTicket(){\r\n            let me = this;\r\n            me.$vs.loading();\r\n            this.$http.get(this.$server_url+\"ticket?estadoChange=yes&estado=1&ticket_id=\"+me.ticket_id)\r\n                .then(function (res) {                \r\n                    me.$vs.loading.close()\r\n                    me.$vs.notify({\r\n                    text:'Ticket cambiado con exito',\r\n                    color:'success',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                    me.busquedaFiltroEstudiante();\r\n                })\r\n                .catch(function (error) {\r\n                    console.log(error + ' error');\r\n                    me.$vs.loading.close()\r\n                })\r\n        },\r\n        busquedaFiltroEstudiante(){\r\n            let me = this;\r\n            me.tickets = [];\r\n            //para el filtro por numero del ticket\r\n            if(me.busqueda == 'numero'){\r\n                if(me.ticket.razonBusqueda.length < 1){      \r\n                    me.$vs.notify({\r\n                    text:'Minimo 1 caracter de busqueda',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})  \r\n                    return false;    \r\n                }\r\n            }\r\n            //para el filtro por fechas\r\n            if(me.busqueda == 'fecha'){\r\n                 if(me.fromDate == null){\r\n                      me.$vs.notify({\r\n                        text: 'Debe escoger una fecha inicio',\r\n                        color:'warning',\r\n                        iconPack: 'feather',\r\n                        icon:'icon-check'})\r\n                    return false;\r\n                }\r\n                if(me.toDate == null){\r\n                    me.$vs.notify({\r\n                        text: 'Debe escoger una fecha final',\r\n                        color:'warning',\r\n                        iconPack: 'feather',\r\n                        icon:'icon-check'})\r\n                        return false;\r\n                }\r\n                if(me.fromDate > me.toDate){\r\n                    me.$vs.notify({\r\n                        text: 'La fecha inicio no puede mayor que la fecha final',\r\n                        color:'warning',\r\n                        iconPack: 'feather',\r\n                        icon:'icon-check'})\r\n                    return false;\r\n                }\r\n            }\r\n            if(me.busqueda == 'cedula' || me.busqueda == 'institucion' ){\r\n                if(me.ticket.razonBusqueda.length < 5){     \r\n                    me.$vs.notify({\r\n                    text:'Minimo 5 caracteres de busqueda',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})  \r\n                    return false;    \r\n                }\r\n            }\r\n            me.$vs.loading();\r\n            this.$http.get(this.$server_url+'ticket?busqueda='+me.busqueda+'&razonBusqueda='+me.ticket.razonBusqueda+'&fromDate='+me.fromDate+'&toDate='+me.toDate)\r\n                .then(function (res) {\r\n                     me.$vs.loading.close()\r\n                     if(res.data.status == '0'){\r\n                        me.$vs.notify({\r\n                        text: res.data.message,\r\n                        color:'primary',\r\n                        iconPack: 'feather',\r\n                        icon:'icon-check'})\r\n                        return false;\r\n                    }else{\r\n                        let datos = res.data.ticketCerrado\r\n                        if(me.usuario.id_group == '1'){\r\n                        me.tickets = datos.filter(p => p.ticket_asesor == '0')\r\n                        me.cantTickets = me.tickets.length\r\n                        }else{\r\n                            me.tickets = datos.filter(p => p.ticket_asesor == '1' && p.vendedorInstitucion == me.usuario.cedula)\r\n                            me.cantTickets = me.tickets.length\r\n                        }\r\n                        me.instituciones = res.data.filtroInstituciones\r\n                        // me.fromDate = null;\r\n                        // me.toDate = null;\r\n                        me.ticket.razonBusqueda = '';\r\n                    }\r\n                })\r\n                .catch(function (error) {\r\n                    console.log(error + ' error');\r\n                    me.$vs.loading.close()\r\n                })\r\n        },\r\n        getTicketRespuesta(ticket_id,asunto,codigo,nombreInstitucion) {\r\n            let me = this;\r\n            localStorage.setItem(\"asunto\",asunto);\r\n            localStorage.setItem(\"ticket_id\",ticket_id);\r\n             localStorage.setItem(\"ticket_codigo\",codigo);\r\n            localStorage.setItem(\"ticket_nombreInstitucion\",nombreInstitucion);\r\n            me.$vs.loading();\r\n            this.$http.get(this.$server_url+'ticket?RespuestaTicketAbiertoReporte=yes&ticket_id='+ticket_id)\r\n                .then(function (res) {\r\n                    me.ticketsRespuesta = res.data\r\n                    me.$vs.loading.close()\r\n                    me.reporte();\r\n                })\r\n                .catch(function (error) {\r\n                    console.log(error + ' error');\r\n                    me.$vs.loading.close()\r\n                })\r\n        },\r\n        //filtro reporte por fechas\r\n        ModalReporteGeneral(){\r\n            let me = this;\r\n            me.popupFiltroReporte = true;\r\n        },\r\n        filtrarReporteGeneral(){\r\n            let me = this;\r\n            if(me.reporteTicket.institucion == \"\"){\r\n                me.$vs.notify({\r\n                    text: 'Debe escoger una institucion',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                return false;\r\n            }\r\n           if(me.fromDate == null){\r\n               me.$vs.notify({\r\n                    text: 'Debe escoger una fecha inicio',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                return false;\r\n           }\r\n            if(me.toDate == null){\r\n               me.$vs.notify({\r\n                    text: 'Debe escoger una fecha final',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                return false;\r\n           }\r\n            if(me.fromDate > me.toDate){\r\n                 me.$vs.notify({\r\n                    text: 'La fecha inicio no puede mayor que la fecha final',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                return false;\r\n            }\r\n            localStorage.setItem(\"ticket_nombreInstitucion\",me.reporteTicket.institucion.nombreInstitucion);\r\n            me.$vs.loading();\r\n            this.$http.get(this.$server_url+'ticket?reporteGeneral=yes&institucion_id='+me.reporteTicket.institucion.idInstitucion+'&fromDate='+me.fromDate+'&toDate='+me.toDate)\r\n                .then(function (res) {\r\n                    me.ticketsReporteGeneral = res.data\r\n                    me.$vs.loading.close()\r\n                    if(res.data.status == '0'){\r\n                        me.$vs.notify({\r\n                        text: res.data.message,\r\n                        color:'primary',\r\n                        iconPack: 'feather',\r\n                        icon:'icon-check'})\r\n                        return false;\r\n                    }else{\r\n                        me.reporteGeneral();\r\n                        me.popupFiltroReporte = false;\r\n                        me.fromDate = null;\r\n                        me.toDate = null;\r\n                    }\r\n                })\r\n                .catch(function (error) {\r\n                    console.log(error + ' error');\r\n                    me.$vs.loading.close()\r\n                })\r\n        },\r\n        //para generar el reporte General\r\n        reporteGeneral() {\r\n            var body = [];\r\n            body.push([{text: 'Ticket'},{text: 'Usuario'},{text: 'asunto'}, {text: 'Duracion'},]);\r\n            for (var key in this.ticketsReporteGeneral) \r\n            {\r\n                if (this.ticketsReporteGeneral.hasOwnProperty(key))\r\n                {\r\n                    var item = this.ticketsReporteGeneral[key];\r\n                    var fila = new Array();\r\n                    fila.push([ { text:'Ticket #: '+item.ticket_id.toString(), style: 'codigo' }, { text:'Grupo: '+item.rol.toString(), style: 'codigo' },{ text:'codigo: '+item.codigo.toString(), style: 'usuario' },{ text:'Interacciones: '+item.cantidad.toString(), style: 'usuario' },])\r\n                    fila.push([ { text:'Nombres: '+item.usuario.toString(), style: 'codigo' },{ text:'cedula: '+item.cedula.toString(), style: 'usuario' },])\r\n                    fila.push( item.descripcion.toString() );\r\n                    fila.push( item.dias.toString() + ' dias'  );\r\n                    body.push(fila);\r\n                }\r\n            }\r\n            var dd = {\r\n                content: [\r\n                    { text:'Reporte General de tickets de'+' '+localStorage.getItem(\"ticket_nombreInstitucion\"), style: 'header' },\r\n                    ' ',\r\n                    ' ',\r\n                    {\r\n                        table: \r\n                        {\r\n                            headerRows: 1,\r\n                            body: body\r\n                        }\r\n                    }\r\n                ],\r\n                styles: {\r\n                    header: {\r\n                        fontSize: 18,\r\n                        bold: true,\r\n                        alignment: 'center'\r\n                    },\r\n                     codigo: {\r\n                    italics: true,\r\n                    alignment: 'left',\r\n                    },\r\n                    usuario: {\r\n                    italics: true,\r\n                    alignment: 'left',\r\n                    },\r\n                }\r\n            };\r\n         pdfMake.createPdf(dd).download(\"TicketGeneral.pdf\");\r\n        },\r\n        //para generar el reporte\r\n        reporte() {\r\n            var body = [];\r\n            body.push([{text: 'Grupo'},{text: 'Usuario'},{text: 'mensaje'}, {text: 'fecha'},]);\r\n            for (var key in this.ticketsRespuesta) \r\n            {\r\n                if (this.ticketsRespuesta.hasOwnProperty(key))\r\n                {\r\n                    var item = this.ticketsRespuesta[key];\r\n                    var fila = new Array();\r\n                    fila.push( item.rol.toString() );\r\n                    fila.push([ { text:'Nombres: '+item.usuario.toString(), style: 'codigo' },{ text:'cedula: '+item.cedula.toString(), style: 'usuario' },])\r\n                    fila.push( item.descripcion.toString() );\r\n                    fila.push( item.fecha.toString()  );\r\n                    body.push(fila);\r\n                }\r\n            }\r\n            var dd = {\r\n                content: [\r\n                    { text:'Ticket #'+localStorage.getItem(\"ticket_id\")+ ' '+localStorage.getItem(\"asunto\") , style: 'header' },\r\n                    ' ',\r\n                    ' ',\r\n                    { text:'Codigo: '+localStorage.getItem(\"ticket_codigo\"), style: 'codigo' },\r\n                    \r\n                    { text:'Institucion: '+localStorage.getItem(\"ticket_nombreInstitucion\"), style: 'institucion' },\r\n                    ' ',\r\n                    ' ',\r\n                    {\r\n                        table: \r\n                        {\r\n                            headerRows: 1,\r\n                            body: body\r\n                        }\r\n                    }\r\n                ],\r\n                styles: {\r\n                    header: {\r\n                        fontSize: 18,\r\n                        bold: true,\r\n                        alignment: 'center'\r\n                    },\r\n                    codigo: {\r\n                    italics: true,\r\n                    alignment: 'left',\r\n                    bold: true,\r\n                    },\r\n                    usuario: {\r\n                    italics: true,\r\n                    alignment: 'left',\r\n                    },\r\n                    institucion: {\r\n                    italics: true,\r\n                    alignment: 'left',\r\n                    bold: true,\r\n                    }\r\n                }\r\n            };\r\n         pdfMake.createPdf(dd).download(\"TicketIndividual.pdf\");\r\n       },\r\n    },\r\n}\r\n</script>"]}]}