{"remainingRequest":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\asesor\\seguimiento\\components\\muestras.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\asesor\\seguimiento\\components\\muestras.vue","mtime":1712682815530},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\nimport axios from 'axios'\r\nimport vSelect from 'vue-select'\r\nimport flatPickr from 'vue-flatpickr-component';\r\nimport 'flatpickr/dist/flatpickr.css';\r\nimport muestraCrearVue from './components/muestraCrear.vue';\r\nimport muestraDetalle from './components/muestraDetalle.vue'\r\nexport default {\r\n    data() {\r\n       return{\r\n            counterDanger: false,\r\n           devolucion:{\r\n               fecha_devolucion:null,\r\n               foto_devolucion:'',\r\n               id:0,\r\n               comentario_devolucion:'',\r\n               foto_devolucion:'',\r\n           },\r\n           configdateTimePicker: {\r\n                enableTime: true,\r\n                dateFormat: 'Y-m-d'\r\n            },\r\n           listado:true,\r\n           muestraCrear:false,\r\n           muestraEditar:false,\r\n           counterDanger: false,\r\n           visitas:[],\r\n           institucion:'',\r\n           institucion_id:'',\r\n           periodo:'',\r\n           periodo_id:'',\r\n           usuario:[],\r\n         \r\n            envioDatos:{\r\n                id:'',\r\n                fecha_entrega:null,\r\n                observacion:'',\r\n                solicitante:'',\r\n                nombreInstitucion:'',\r\n                foto_evidencia:'',\r\n            },\r\n            id:0,\r\n            update:false,\r\n            title:'',\r\n            titleFechaGenera:'',\r\n            isAdmin:'',\r\n            asesorDesdeAdmin:'',\r\n            institucion_filtrar:'',\r\n            escuelas:[], \r\n            popupDevolucion:false,\r\n            errorImage:'',\r\n            tamanioError:'',\r\n            archivoName:'',\r\n\r\n       } \r\n    },\r\n  \r\n      components:{\r\n        flatPickr,\r\n        muestraCrearVue,\r\n        vSelect,\r\n        muestraDetalle,\r\n    },\r\n    created(){\r\n        let me = this;\r\n        me.usuario = JSON.parse(localStorage.getItem(\"usuario\"))\r\n        me.isAdmin = localStorage.getItem(\"adminSeguimiento\")\r\n        me.getEscuelas()\r\n        me.title = \"Genera\"+\" \" +\"Muestra\"\r\n        me.titleFechaGenera = \"Fecha entrega\"+ \" \" + \"Muestra\"\r\n  \r\n    }, \r\n    methods:{\r\n    \r\n        //cantidad de escuelas del asesor\r\n        async getVisitas() {\r\n            let me = this;\r\n            if(me.isAdmin == \"yes\"){\r\n            \r\n                me.asesorDesdeAdmin = localStorage.getItem(\"institucion_seguimiento_asesor_id\") \r\n            }else{\r\n                me.asesorDesdeAdmin = me.usuario.idusuario\r\n            }\r\n            \r\n            this.$http.get(this.$server_url+'asesor/seguimiento?institucion_id='+me.institucion_id+'&periodo_id='+me.periodo_id+'&asesor_id='+me.asesorDesdeAdmin+'&muestra=yes')\r\n                .then(function (response) {\r\n               \r\n                    me.visitas = response.data\r\n                })\r\n                .catch(function (error) {\r\n                    \r\n                })\r\n        },\r\n\r\n        //cantidad de escuelas del asesor\r\n        async getEscuelas() {\r\n            let me = this;\r\n            this.$http.get(this.$server_url+'escuelasAsesor?cedula=' + me.usuario.cedula+'&individual=yes'+'&porRegiones=yes'+'&asesor_id='+me.usuario.idusuario)\r\n\r\n            // this.$http.get(this.$server_url+'escuelasAsesor?asesor_id=' + me.usuario.idusuario+'&individual=yes'+'&porRegiones=yes')\r\n                .then(function (response) {\r\n                    let datos = response.data.instituciones\r\n                    me.escuelas = datos    \r\n\r\n                })\r\n                .catch(function (error) {       \r\n                })\r\n        },\r\n\r\n    \r\n\r\n        filtrarInstitucion(){\r\n \r\n            let me = this\r\n            me.visitas = []\r\n            localStorage.setItem('institucion_seguimiento_id',me.institucion_filtrar.id)\r\n            localStorage.setItem('institucion_seguimiento_nombre',me.institucion_filtrar.label)\r\n            localStorage.setItem('institucion_seguimiento_periodo_id',me.institucion_filtrar.id_periodo)\r\n            localStorage.setItem('institucion_seguimiento_periodo',me.institucion_filtrar.periodo)\r\n            me.institucion = localStorage.getItem(\"institucion_seguimiento_nombre\")\r\n            me.institucion_id = localStorage.getItem(\"institucion_seguimiento_id\")\r\n            me.periodo = localStorage.getItem(\"institucion_seguimiento_periodo\")\r\n            me.periodo_id = localStorage.getItem(\"institucion_seguimiento_periodo_id\")\r\n            me.getVisitas()\r\n        },\r\n\r\n        openModalEdit(tr){\r\n            let me = this;\r\n            me.envioDatos.id = tr.muestra_id \r\n            me.envioDatos.observacion = tr.observacion\r\n            me.envioDatos.solicitante = tr.persona_solicita\r\n            me.envioDatos.nombreInstitucion =  localStorage.getItem(\"institucion_seguimiento_nombre\")\r\n            me.envioDatos.fecha_entrega = tr.fecha_entrega\r\n            me.envioDatos.foto_evidencia = tr.foto_evidencia\r\n            me.muestraEditar = true\r\n            me.listado = false\r\n          \r\n        },\r\n\r\n        openModalDevolucion(tr){\r\n            let me = this;\r\n            me.popupDevolucion = true\r\n            me.devolucion.fecha_devolucion = tr.fecha_devolucion\r\n            me.devolucion.foto_devolucion = tr.foto_devolucion\r\n            me.devolucion.fecha_entrega = tr.fecha_entrega\r\n            me.devolucion.foto_devolucion = tr.foto_devolucion\r\n            me.devolucion.id = tr.muestra_id\r\n            if(tr.comentario_devolucion == \"null\"){\r\n                me.devolucion.comentario_devolucion = \"\"\r\n            }else{\r\n                me.devolucion.comentario_devolucion = tr.comentario_devolucion\r\n            }\r\n           \r\n\r\n        },\r\n      \r\n        limpiar(){\r\n            let  me = this;\r\n            me.seguimiento.observacion = \"\"\r\n            me.Fgenerar = null\r\n\r\n        },\r\n         fieldEdit(e){\r\n            let me = this;\r\n            me.errorImage = 'no'\r\n            me.tamanioError=\"no\"\r\n            this.attachments = [];\r\n            let selectedFiles=e.target.files;\r\n            let validar = e.target.files[0].type;\r\n\r\n            let tamanio = e.target.files[0].size;\r\n            \r\n            if(tamanio > 1000000){\r\n                me.tamanioError=\"yes\"\r\n                me.$vs.notify({\r\n                    text:'El tamaño de la imagen excede 1MB',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})  \r\n                    return false;  \r\n            }\r\n                \r\n            if(validar == 'image/png' || validar == 'image/jpg' || validar == 'image/jpeg'){\r\n                for(let i=0;i<selectedFiles.length;i++){\r\n\r\n                    this.attachments.push(selectedFiles[i]);\r\n                    localStorage.setItem('nameArchivo',this.attachments[0].name)\r\n                    me.archivoName = localStorage.getItem(\"nameArchivo\")\r\n                    }\r\n                    me.errorImage = 'no'\r\n            }else{\r\n                me.errorImage = 'yes'\r\n                me.$vs.notify({\r\n                text:'Formato de imagen no aceptada solo se acepta png/jpg/jpeg',\r\n                color:'success',\r\n                iconPack: 'feather',\r\n                icon:'icon-check'})\r\n                return false; \r\n            }\r\n\r\n        },\r\n        \r\n         ActualizarEvidencia(){\r\n            let me = this;\r\n       \r\n\r\n            if(me.devolucion.fecha_devolucion == null || me.devolucion.fecha_devolucion == \"\" || me.devolucion.fecha_devolucion == undefined){\r\n                 me.$vs.notify({\r\n                  text:'Debe agregar una fecha de devolución',\r\n                  color:'success',\r\n                  iconPack: 'feather',\r\n                  icon:'icon-check'})\r\n                return false;\r\n            }\r\n\r\n            if(me.devolucion.fecha_devolucion <  me.devolucion.fecha_entrega){\r\n                 me.$vs.notify({\r\n                  text:'La fecha de devolución no puede ser menor a la fecha de entrega',\r\n                  color:'success',\r\n                  iconPack: 'feather',\r\n                  icon:'icon-check'})\r\n                return false;\r\n            }\r\n\r\n          \r\n            // if(me.attachments==  || me.devolucion.foto_devolucion == null ){\r\n            //     if(me.attachments == undefined){\r\n            //         me.$vs.notify({\r\n            //         text:'Seleccione una imagen antes de enviar',\r\n            //         color:'warning',\r\n            //         iconPack: 'feather',\r\n            //         icon:'icon-check'})  \r\n            //         return false; \r\n            //     }\r\n            // }\r\n         \r\n            if(me.tamanioError == 'yes'){\r\n                me.$vs.notify({\r\n                    text:'El tamaño de la imagen excede 1MB',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})  \r\n                    return false;  \r\n            }\r\n           \r\n            if(me.errorImage == 'yes'){\r\n                me.$vs.notify({\r\n                    text:'El formato de la imagen solo se acepta jpg/png/jpeg',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})  \r\n                    return false;      \r\n            }   \r\n\r\n           \r\n            \r\n            \r\n\r\n            let formData = new FormData();\r\n\r\n            //Si se envia imagenes\r\n            if(me.attachments == undefined){\r\n\r\n            }else{\r\n                for(let i=0; i<this.attachments.length;i++){\r\n                    if(me.attachments.length == 0){\r\n                    }else{\r\n                    formData.append('enviarArchivo','yes');\r\n                    formData.append('archivo[]',this.attachments[i]);\r\n                    }\r\n                }\r\n            }\r\n\r\n\r\n            \r\n            formData.append('id',                   me.devolucion.id);\r\n            formData.append('fecha_devolucion',     me.devolucion.fecha_devolucion);\r\n            formData.append('comentario_devolucion',     me.devolucion.comentario_devolucion);\r\n            formData.append('devolucion', \"yes\");\r\n\r\n            const config = { headers: { 'Content-Type': 'multipart/form-data' } };\r\n            document.querySelectorAll('.upload-file').value=[];\r\n            me.$vs.loading()\r\n            axios.post(this.$data_url+'api/EditarDetalle',formData, config)\r\n        \r\n                .then(function (res) {\r\n                    me.$vs.loading.close();\r\n                    me.$vs.notify({\r\n                        text: res.data.message,\r\n                        color: 'primary',\r\n                        iconPack: 'feather',\r\n                        icon: 'icon-alert-triangle'\r\n                    })\r\n                    me.popupDevolucion =false;\r\n                    me.getVisitas();\r\n                    me.attachments = [];\r\n                    me.archivoName='';\r\n                })\r\n                .catch(function (error) {\r\n                    me.$vs.loading.close();\r\n                })\r\n        },\r\n    }\r\n}\r\n",{"version":3,"sources":["muestras.vue"],"names":[],"mappings":";AA2MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;AAIA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AAMA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"muestras.vue","sourceRoot":"src/views/asesor/seguimiento/components","sourcesContent":["<template>\r\n    <div>\r\n     <vs-row v-if=\"listado == true\">\r\n    \r\n        <p @click=\"muestraCrear = true; listado = false;\" style=\"cursor:pointer\">\r\n            <vs-chip color=\"primary\" style=\"cursor:pointer\"  class=\"mt-2\">\r\n                <vs-avatar icon=\"edit\"  @click=\"popupAgregarSeguimiento = true;\"/>\r\n                Agregar  Muestra\r\n            </vs-chip>\r\n        </p> \r\n        <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n            <div class=\"vx-col w-full mt-5\">\r\n                 Seleccione una institucion para filtrar el listado:\r\n                 <v-select :options=\"escuelas\" @input=\"filtrarInstitucion()\" :reduce=\"escuelas => escuelas\" label=\"label\" class=\"w-full\" v-model=\"institucion_filtrar\" />\r\n            </div>\r\n        </vs-col>\r\n       \r\n        <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n             <vs-table stripe :data=\"visitas\" search pagination max-items=\"10\" style=\"width: 100%;\">\r\n                <template slot=\"header\">\r\n                \r\n                    <vs-list>\r\n                        <vs-list-header title=\"Información\"></vs-list-header>\r\n                        <vs-list-item title=\"Institución\" :subtitle=\"institucion\"></vs-list-item>\r\n                        <vs-list-item title=\"Período\" :subtitle=\"periodo\"></vs-list-item>\r\n                    </vs-list>             \r\n                </template>\r\n                <template slot=\"thead\">\r\n                    <vs-th>\r\n                    Muestra\r\n                    </vs-th>\r\n                    <vs-th>\r\n                    Fecha Entrega\r\n                    </vs-th>      \r\n                    <vs-th>\r\n                    Observación\r\n                    </vs-th>\r\n                    <vs-th>\r\n                    Devolución\r\n                    </vs-th>\r\n                    <vs-th>\r\n                    Comentario Devolución\r\n                    </vs-th>\r\n                    <vs-th>\r\n                    Acciones\r\n                    </vs-th>\r\n\r\n                </template>\r\n            \r\n                <template slot-scope=\"{data}\">\r\n                    <vs-tr :key=\"indextr\" v-for=\"(tr, indextr) in data\" >\r\n                        <vs-td :data=\"data[indextr].num_visita\" width=\"12%\">\r\n                            <vs-chip color=\"primary\">\r\n                            Muestra Nº {{data[indextr].num_muestra}}\r\n                            </vs-chip>\r\n                           \r\n                        </vs-td>\r\n                        <vs-td :data=\"data[indextr].fecha_entrega\" width=\"20%\">\r\n                            Solicitante:\r\n                            <br>        \r\n                            <span style=\"font-weight:600;  \" >\r\n                            {{ tr.persona_solicita }}<br>\r\n                            </span>\r\n                            Fecha Entrega:\r\n                            <br>        \r\n                            <span style=\"font-weight:600;  \" >\r\n                            {{ tr.fecha_entrega }}<br>\r\n                            </span>\r\n                            <vx-tooltip style=\"display: inline-block;\" text=\"Ver evidencia\" position=\"top\" color=\"primary\">\r\n                                <a :href=\"$data_url+'archivos/'+'seguimiento/'+'muestra/'+tr.foto_evidencia\"  style=\"display:inline-block;margin-left:-20px;\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n                                    <i class=\"fa fa-camera ml-5\" aria-hidden=\"true\"></i>\r\n                                    Evidencia\r\n                                </a>\r\n                            </vx-tooltip> &nbsp;        \r\n                                <br>\r\n\r\n                        </vs-td>\r\n\r\n                        <vs-td height=\"30%\" width=\"20%\">\r\n                            <div class=\"overflow-y-auto h-24\">\r\n                                {{tr.observacion}}\r\n                            </div>\r\n                        </vs-td>\r\n                        <vs-td>\r\n                            Fecha Devolucion:\r\n                            <br> \r\n                                \r\n                            <span style=\"font-weight:600;\" >\r\n                            {{ tr.fecha_devolucion }}<br>\r\n                            </span>\r\n                            <vx-tooltip style=\"display: inline-block;\" text=\"Ver evidencia\" position=\"top\" color=\"primary\" v-if=\"tr.foto_devolucion !=null\">\r\n                                <a :href=\"$server_url+'archivos/'+'seguimiento/'+'muestra/'+tr.foto_devolucion\"  style=\"display:inline-block;margin-left:-20px;\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n                                    <i class=\"fa fa-camera ml-5\" aria-hidden=\"true\"></i>\r\n                                    Evidencia\r\n                                </a>\r\n                            </vx-tooltip> &nbsp;        \r\n                                <br>\r\n                        </vs-td>\r\n                             <vs-td height=\"30%\" width=\"20%\">\r\n                            <div class=\"overflow-y-auto h-24\">\r\n                                {{tr.comentario_devolucion}}\r\n                            </div>\r\n                        </vs-td>\r\n                        <vs-td>\r\n                            <div>\r\n                                <vx-tooltip style=\"display: inline-block;\" text=\"Editar\" position=\"top\" color=\"primary\">\r\n                                    <vs-button radius color=\"success\" @click=\"openModalEdit(tr);update = true\" type=\"line\" icon=\"edit\"></vs-button>\r\n                                </vx-tooltip> &nbsp; \r\n                                <vx-tooltip style=\"display: inline-block;\" text=\"Añadir devolucion\" position=\"top\" color=\"primary\">\r\n                                    <vs-button radius color=\"warning\" @click=\"openModalDevolucion(tr)\" type=\"line\" icon=\"swap_horiz\"></vs-button>\r\n                                </vx-tooltip> &nbsp; \r\n                            </div>\r\n                           \r\n                        </vs-td>\r\n                    </vs-tr>\r\n                </template>\r\n            </vs-table>\r\n        </vs-col>\r\n    </vs-row>\r\n\r\n    <!--CREAR-->\r\n    <div v-if=\"muestraCrear == true\">\r\n        <vs-button radius color=\"success\" @click=\"listado = true;tipoMuestra = false; muestraCrear = false;muestraEditar=false;\" type=\"gradient\" icon=\"reply\"></vs-button>\r\n        <muestraCrearVue tipoMuestra=\"Crear\"/>\r\n    </div>    \r\n\r\n      <!--EDITAR-->\r\n    <div v-if=\"muestraEditar == true\">\r\n        <vs-button radius color=\"success\" @click=\"listado = true;muestraCrear = false;muestraEditar = false; getVisitas() \" type=\"gradient\" icon=\"reply\"></vs-button>\r\n        <muestraCrearVue \r\n        tipoMuestra=\"Editar\"\r\n        :observacion= \"envioDatos.observacion\"\r\n        :id = \"envioDatos.id\"\r\n        :nombreInstitucion = \"envioDatos.nombreInstitucion\"\r\n        :fecha_entrega = \"envioDatos.fecha_entrega\"\r\n        :solicitante = \"envioDatos.solicitante\"\r\n        :foto_evidencia = \"envioDatos.foto_evidencia\"\r\n\r\n        />\r\n    </div>  \r\n\r\n    <!--MODAL PARA AGREGAR DEVOLUCION-->\r\n\r\n    <vs-popup\r\n      \r\n      background-color=\"rgba(255,255,255,.6)\"\r\n      title=\"Agregar devolución\" :active.sync=\"popupDevolucion\">\r\n        <vs-tabs>\r\n            <vs-tab label=\"Información devolucion\">\r\n                <div class=\"con-tab-ejemplo\">\r\n                    <vs-row>\r\n                        <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n                             <flat-pickr :config=\"configdateTimePicker\" v-model=\"devolucion.fecha_devolucion\" placeholder=\"Fecha de devolución\" \r\n                             class=\"m-1\" style=\"display: inline-block;width: 100%;\"\r\n                              />\r\n                        </vs-col>\r\n                    </vs-row>\r\n                    <vs-row class=\"mt-5\">\r\n                        <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n                            <div v-if=\"devolucion.foto_devolucion == '' || devolucion.foto_devolucion == null\">\r\n                                <p>Sin foto todavia</p>\r\n                            </div>\r\n                            <div v-else style=\"box-shadow:5px 4px 20px #ccc;\">\r\n                                <img style=\"width: 100%;border-radius:10px; 20px 30px\"  :src=\"$data_url+'archivos/'+'seguimiento/'+'muestra/'+devolucion.foto_devolucion\">\r\n                            </div>\r\n                        </vs-col>\r\n                        <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\" class=\"mt-5\">\r\n                            <label class=\"form-block-input\" style=\"position: relative;right:15px;\">\r\n                                <input type=\"file\" class=\"upload-file form-file-span\"  hidden @change=\"fieldEdit\" />\r\n                                <span class=\"form-file-span\"><i class=\"fa fa-cloud-upload\"   aria-hidden=\"true\"></i> Selecciona un archivo</span>\r\n                            </label>  \r\n                            <br>\r\n                        </vs-col>\r\n                         <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\" class=\"mt-5\">\r\n                            <p  class=\"ml-5 mt-5\" style=\"color:#ccc;font-weight:500\">Seleccionado {{archivoName}}</p>    \r\n                        </vs-col>\r\n                        <vs-row class=\"mt-2\">\r\n                            <p class=\"ml-2\">Observación</p>\r\n                            <vs-col class=\"mt-1\" vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n                                <vs-textarea counter=\"500\" style=\"width:100%;\" label=\"Comentario\" :counter-danger.sync=\"counterDanger\" v-model=\"devolucion.comentario_devolucion\" />\r\n                            </vs-col>\r\n                        </vs-row>\r\n                        <vs-row>\r\n                            <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n                                <vs-button @click=\"ActualizarEvidencia()\" class=\"mt-5 ml-5\" color=\"success\" type=\"gradient\">Actualizar evidencia</vs-button>\r\n                            </vs-col>\r\n                        </vs-row>    \r\n                    </vs-row>\r\n                </div>\r\n            </vs-tab>\r\n            <vs-tab label=\"Valores devolucion\">\r\n                <div class=\"con-tab-ejemplo\">\r\n                    <muestraDetalle :id=\"devolucion.id\"/>\r\n                </div>\r\n            </vs-tab>\r\n        </vs-tabs>\r\n    </vs-popup>\r\n  \r\n   \r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'\r\nimport vSelect from 'vue-select'\r\nimport flatPickr from 'vue-flatpickr-component';\r\nimport 'flatpickr/dist/flatpickr.css';\r\nimport muestraCrearVue from './components/muestraCrear.vue';\r\nimport muestraDetalle from './components/muestraDetalle.vue'\r\nexport default {\r\n    data() {\r\n       return{\r\n            counterDanger: false,\r\n           devolucion:{\r\n               fecha_devolucion:null,\r\n               foto_devolucion:'',\r\n               id:0,\r\n               comentario_devolucion:'',\r\n               foto_devolucion:'',\r\n           },\r\n           configdateTimePicker: {\r\n                enableTime: true,\r\n                dateFormat: 'Y-m-d'\r\n            },\r\n           listado:true,\r\n           muestraCrear:false,\r\n           muestraEditar:false,\r\n           counterDanger: false,\r\n           visitas:[],\r\n           institucion:'',\r\n           institucion_id:'',\r\n           periodo:'',\r\n           periodo_id:'',\r\n           usuario:[],\r\n         \r\n            envioDatos:{\r\n                id:'',\r\n                fecha_entrega:null,\r\n                observacion:'',\r\n                solicitante:'',\r\n                nombreInstitucion:'',\r\n                foto_evidencia:'',\r\n            },\r\n            id:0,\r\n            update:false,\r\n            title:'',\r\n            titleFechaGenera:'',\r\n            isAdmin:'',\r\n            asesorDesdeAdmin:'',\r\n            institucion_filtrar:'',\r\n            escuelas:[], \r\n            popupDevolucion:false,\r\n            errorImage:'',\r\n            tamanioError:'',\r\n            archivoName:'',\r\n\r\n       } \r\n    },\r\n  \r\n      components:{\r\n        flatPickr,\r\n        muestraCrearVue,\r\n        vSelect,\r\n        muestraDetalle,\r\n    },\r\n    created(){\r\n        let me = this;\r\n        me.usuario = JSON.parse(localStorage.getItem(\"usuario\"))\r\n        me.isAdmin = localStorage.getItem(\"adminSeguimiento\")\r\n        me.getEscuelas()\r\n        me.title = \"Genera\"+\" \" +\"Muestra\"\r\n        me.titleFechaGenera = \"Fecha entrega\"+ \" \" + \"Muestra\"\r\n  \r\n    }, \r\n    methods:{\r\n    \r\n        //cantidad de escuelas del asesor\r\n        async getVisitas() {\r\n            let me = this;\r\n            if(me.isAdmin == \"yes\"){\r\n            \r\n                me.asesorDesdeAdmin = localStorage.getItem(\"institucion_seguimiento_asesor_id\") \r\n            }else{\r\n                me.asesorDesdeAdmin = me.usuario.idusuario\r\n            }\r\n            \r\n            this.$http.get(this.$server_url+'asesor/seguimiento?institucion_id='+me.institucion_id+'&periodo_id='+me.periodo_id+'&asesor_id='+me.asesorDesdeAdmin+'&muestra=yes')\r\n                .then(function (response) {\r\n               \r\n                    me.visitas = response.data\r\n                })\r\n                .catch(function (error) {\r\n                    \r\n                })\r\n        },\r\n\r\n        //cantidad de escuelas del asesor\r\n        async getEscuelas() {\r\n            let me = this;\r\n            this.$http.get(this.$server_url+'escuelasAsesor?cedula=' + me.usuario.cedula+'&individual=yes'+'&porRegiones=yes'+'&asesor_id='+me.usuario.idusuario)\r\n\r\n            // this.$http.get(this.$server_url+'escuelasAsesor?asesor_id=' + me.usuario.idusuario+'&individual=yes'+'&porRegiones=yes')\r\n                .then(function (response) {\r\n                    let datos = response.data.instituciones\r\n                    me.escuelas = datos    \r\n\r\n                })\r\n                .catch(function (error) {       \r\n                })\r\n        },\r\n\r\n    \r\n\r\n        filtrarInstitucion(){\r\n \r\n            let me = this\r\n            me.visitas = []\r\n            localStorage.setItem('institucion_seguimiento_id',me.institucion_filtrar.id)\r\n            localStorage.setItem('institucion_seguimiento_nombre',me.institucion_filtrar.label)\r\n            localStorage.setItem('institucion_seguimiento_periodo_id',me.institucion_filtrar.id_periodo)\r\n            localStorage.setItem('institucion_seguimiento_periodo',me.institucion_filtrar.periodo)\r\n            me.institucion = localStorage.getItem(\"institucion_seguimiento_nombre\")\r\n            me.institucion_id = localStorage.getItem(\"institucion_seguimiento_id\")\r\n            me.periodo = localStorage.getItem(\"institucion_seguimiento_periodo\")\r\n            me.periodo_id = localStorage.getItem(\"institucion_seguimiento_periodo_id\")\r\n            me.getVisitas()\r\n        },\r\n\r\n        openModalEdit(tr){\r\n            let me = this;\r\n            me.envioDatos.id = tr.muestra_id \r\n            me.envioDatos.observacion = tr.observacion\r\n            me.envioDatos.solicitante = tr.persona_solicita\r\n            me.envioDatos.nombreInstitucion =  localStorage.getItem(\"institucion_seguimiento_nombre\")\r\n            me.envioDatos.fecha_entrega = tr.fecha_entrega\r\n            me.envioDatos.foto_evidencia = tr.foto_evidencia\r\n            me.muestraEditar = true\r\n            me.listado = false\r\n          \r\n        },\r\n\r\n        openModalDevolucion(tr){\r\n            let me = this;\r\n            me.popupDevolucion = true\r\n            me.devolucion.fecha_devolucion = tr.fecha_devolucion\r\n            me.devolucion.foto_devolucion = tr.foto_devolucion\r\n            me.devolucion.fecha_entrega = tr.fecha_entrega\r\n            me.devolucion.foto_devolucion = tr.foto_devolucion\r\n            me.devolucion.id = tr.muestra_id\r\n            if(tr.comentario_devolucion == \"null\"){\r\n                me.devolucion.comentario_devolucion = \"\"\r\n            }else{\r\n                me.devolucion.comentario_devolucion = tr.comentario_devolucion\r\n            }\r\n           \r\n\r\n        },\r\n      \r\n        limpiar(){\r\n            let  me = this;\r\n            me.seguimiento.observacion = \"\"\r\n            me.Fgenerar = null\r\n\r\n        },\r\n         fieldEdit(e){\r\n            let me = this;\r\n            me.errorImage = 'no'\r\n            me.tamanioError=\"no\"\r\n            this.attachments = [];\r\n            let selectedFiles=e.target.files;\r\n            let validar = e.target.files[0].type;\r\n\r\n            let tamanio = e.target.files[0].size;\r\n            \r\n            if(tamanio > 1000000){\r\n                me.tamanioError=\"yes\"\r\n                me.$vs.notify({\r\n                    text:'El tamaño de la imagen excede 1MB',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})  \r\n                    return false;  \r\n            }\r\n                \r\n            if(validar == 'image/png' || validar == 'image/jpg' || validar == 'image/jpeg'){\r\n                for(let i=0;i<selectedFiles.length;i++){\r\n\r\n                    this.attachments.push(selectedFiles[i]);\r\n                    localStorage.setItem('nameArchivo',this.attachments[0].name)\r\n                    me.archivoName = localStorage.getItem(\"nameArchivo\")\r\n                    }\r\n                    me.errorImage = 'no'\r\n            }else{\r\n                me.errorImage = 'yes'\r\n                me.$vs.notify({\r\n                text:'Formato de imagen no aceptada solo se acepta png/jpg/jpeg',\r\n                color:'success',\r\n                iconPack: 'feather',\r\n                icon:'icon-check'})\r\n                return false; \r\n            }\r\n\r\n        },\r\n        \r\n         ActualizarEvidencia(){\r\n            let me = this;\r\n       \r\n\r\n            if(me.devolucion.fecha_devolucion == null || me.devolucion.fecha_devolucion == \"\" || me.devolucion.fecha_devolucion == undefined){\r\n                 me.$vs.notify({\r\n                  text:'Debe agregar una fecha de devolución',\r\n                  color:'success',\r\n                  iconPack: 'feather',\r\n                  icon:'icon-check'})\r\n                return false;\r\n            }\r\n\r\n            if(me.devolucion.fecha_devolucion <  me.devolucion.fecha_entrega){\r\n                 me.$vs.notify({\r\n                  text:'La fecha de devolución no puede ser menor a la fecha de entrega',\r\n                  color:'success',\r\n                  iconPack: 'feather',\r\n                  icon:'icon-check'})\r\n                return false;\r\n            }\r\n\r\n          \r\n            // if(me.attachments==  || me.devolucion.foto_devolucion == null ){\r\n            //     if(me.attachments == undefined){\r\n            //         me.$vs.notify({\r\n            //         text:'Seleccione una imagen antes de enviar',\r\n            //         color:'warning',\r\n            //         iconPack: 'feather',\r\n            //         icon:'icon-check'})  \r\n            //         return false; \r\n            //     }\r\n            // }\r\n         \r\n            if(me.tamanioError == 'yes'){\r\n                me.$vs.notify({\r\n                    text:'El tamaño de la imagen excede 1MB',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})  \r\n                    return false;  \r\n            }\r\n           \r\n            if(me.errorImage == 'yes'){\r\n                me.$vs.notify({\r\n                    text:'El formato de la imagen solo se acepta jpg/png/jpeg',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})  \r\n                    return false;      \r\n            }   \r\n\r\n           \r\n            \r\n            \r\n\r\n            let formData = new FormData();\r\n\r\n            //Si se envia imagenes\r\n            if(me.attachments == undefined){\r\n\r\n            }else{\r\n                for(let i=0; i<this.attachments.length;i++){\r\n                    if(me.attachments.length == 0){\r\n                    }else{\r\n                    formData.append('enviarArchivo','yes');\r\n                    formData.append('archivo[]',this.attachments[i]);\r\n                    }\r\n                }\r\n            }\r\n\r\n\r\n            \r\n            formData.append('id',                   me.devolucion.id);\r\n            formData.append('fecha_devolucion',     me.devolucion.fecha_devolucion);\r\n            formData.append('comentario_devolucion',     me.devolucion.comentario_devolucion);\r\n            formData.append('devolucion', \"yes\");\r\n\r\n            const config = { headers: { 'Content-Type': 'multipart/form-data' } };\r\n            document.querySelectorAll('.upload-file').value=[];\r\n            me.$vs.loading()\r\n            axios.post(this.$data_url+'api/EditarDetalle',formData, config)\r\n        \r\n                .then(function (res) {\r\n                    me.$vs.loading.close();\r\n                    me.$vs.notify({\r\n                        text: res.data.message,\r\n                        color: 'primary',\r\n                        iconPack: 'feather',\r\n                        icon: 'icon-alert-triangle'\r\n                    })\r\n                    me.popupDevolucion =false;\r\n                    me.getVisitas();\r\n                    me.attachments = [];\r\n                    me.archivoName='';\r\n                })\r\n                .catch(function (error) {\r\n                    me.$vs.loading.close();\r\n                })\r\n        },\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* Formato de etiqueta */\r\n.titulo {\r\n    background: #4CB8C4;\r\n    /* fallback for old browsers */\r\n    background: -webkit-linear-gradient(to right, #3CD3AD, #4CB8C4);\r\n    /* Chrome 10-25, Safari 5.1-6 */\r\n    background: linear-gradient(to right, #3CD3AD, #4CB8C4);\r\n    /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */\r\n    color: white;\r\n    letter-spacing: 1px;\r\n\r\n}\r\n\r\n.image1 {\r\n    filter: drop-shadow(0 0 5px coral);\r\n    border-radius: 20px;\r\n    cursor: pointer;\r\n    opacity: 0.7;\r\n}\r\n\r\n.image1:hover {\r\n    opacity: 1\r\n}\r\n\r\n.form-block-input {\r\n\r\n    display: flex;\r\n    max-width: 400px;\r\n    overflow: hidden;\r\n    font-size: 0.9em;\r\n    color: #777;\r\n    margin-left: 50px;\r\n    border: 1px #25a solid;\r\n\r\n    padding: 0;\r\n    border-radius: 3px;\r\n    border: none;\r\n}\r\n\r\n/* Ocultar campo tipo file */\r\ninput[type=\"file\"].form-file {\r\n    display: none;\r\n}\r\n\r\n/* Botón para seleccionar archivos */\r\nbutton.form-file-button {\r\n    vertical-align: middle;\r\n    color: #fff;\r\n    background: #24A6F6;\r\n    margin: 0;\r\n    border: 0;\r\n    width: 50px;\r\n    padding: 2px 8px;\r\n    transform: scaleX(-1);\r\n    /* Invertir botón horizontalmente */\r\n}\r\n\r\n/* Lista de archivos */\r\nspan.form-file-span {\r\n    flex: 1;\r\n    display: inline-block;\r\n    text-align: left;\r\n    padding: 4px 10px;\r\n    background: #24A6F6;\r\n    color: #fff;\r\n    padding: 10px;\r\n    border-radius: 5px 15px;\r\n    cursor: pointer;\r\n    font-size: 20px;\r\n\r\n}\r\n\r\n/* Arhchivos en lista */\r\nspan.form-files {\r\n    display: inline-block;\r\n    color: #555;\r\n    background: #ccf;\r\n\r\n    margin: 2px 8px 2px 0;\r\n    padding: 2px 5px;\r\n    white-space: nowrap;\r\n    border-radius: 3px;\r\n}\r\n\r\n/* Quitar margen horizontal al último elemento en la lista */\r\nspan.form-block-span:last-child {\r\n    margin: 2px 0;\r\n}\r\n</style>\r\n"]}]}