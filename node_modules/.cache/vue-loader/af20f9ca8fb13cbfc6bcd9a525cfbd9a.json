{"remainingRequest":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\fichas\\new.vue?vue&type=style&index=0&id=71cec8c5&scoped=true&lang=css","dependencies":[{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\fichas\\new.vue","mtime":1712682815927},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\n.farchivo{\r\n    margin-top: 50px!important;\r\n    cursor: pointer; \r\n    /* color: gray; */\r\n     width: 200px; \r\n    font-size: 11px;\r\n    line-height: 80%;\r\n    transition: 0.5s ease all;\r\n    padding: 10px 10px;\r\n    background-color: DodgerBlue;\r\n    border: none;\r\n    color: white;\r\n    border-radius: 5px;\r\n    margin-left: 10px;\r\n}\r\n.farchivo:hover{\r\n    background-color: #7C7B89;\r\n    color:white;\r\n    border-radius: 5px;\r\n}\r\n",{"version":3,"sources":["new.vue"],"names":[],"mappings":";AAqVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"new.vue","sourceRoot":"src/views/fichas","sourcesContent":["<template>\r\n    <div class=\"mt-2\">\r\n        <div class=\"vx-row mt-2\">\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full\" align=\"left\">\r\n                <div style=\"font-size: 12px; \">Asignatura: </div>\r\n                <v-select class=\"mb-4 w-full\" v-model=\"asignaturaSelect\" :options=\"asignaturas\" label=\"nombreasignatura\" :reduce=\"asignaturas => asignaturas.idasignatura\" />\r\n                <!-- {{ asignaturaSelect }} -->\r\n            </div>\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full\" align=\"left\">\r\n                <div style=\"font-size: 12px; \">Unidad: </div>\r\n                <v-select class=\"mb-4 w-full\" v-model=\"unidadesSelect\" :options=\"unidades\" label=\"nombre_unidad\" :reduce=\"unidades => unidades.id\" />\r\n                <!-- {{ unidadesSelect }} -->\r\n            </div>\r\n            <div class=\"vx-col w-full\" align=\"left\">\r\n                <vs-input type=\"text\" class=\"inputx w-full mb-6\" v-model=\"datos.titulo\" maxlength=\"200\" label=\"Nombre de la ficha\" />\r\n            </div>\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full\" align=\"left\">\r\n                <small>Tipo de ficha</small> <br />\r\n                <form>\r\n                    <vs-radio class=\"m-3\" v-model=\"datos.tipo\" vs-value=\"0\">Sin Guia</vs-radio>\r\n                    <vs-radio class=\"m-3\" v-model=\"datos.tipo\" vs-value=\"1\">Con Guia</vs-radio>\r\n                </form>\r\n            </div>\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full\" align=\"left\">\r\n                <small>Estado</small> <br />\r\n                <form>\r\n                    <vs-radio class=\"m-3\" v-model=\"datos.estado\" vs-value=\"1\">Activo</vs-radio>\r\n                    <vs-radio class=\"m-3\" v-model=\"datos.estado\" vs-value=\"0\">Inactivo</vs-radio>\r\n                </form>\r\n            </div>\r\n            <vs-divider>Archivos</vs-divider>\r\n            <div style=\"margin-top: -5px;\">\r\n                <p class=\"font-bold letra\">Seleccione los archivos (MÃ¡ximo 20 MB):</p>\r\n                <br>\r\n                <p>\r\n                    <input type=\"file\" name=\"file1\" id=\"file1\" multiple class=\"inputfile\" style=\"display: none;\" v-on:change=\"mostrarImg\">\r\n                    <label for=\"file1\" class=\"farchivo\">\r\n                        <ion-icon name=\"download-outline\" style=\"position: relative;top:3px;font-size: 15px;\"></ion-icon> <span class=\"ml-1\" style=\"font-size: 12px;\">Buscar Archivo</span>\r\n                    </label>\r\n                </p>\r\n            </div>\r\n            <br>\r\n        </div>\r\n        <br>\r\n        <div class=\"row mt-1\">\r\n            <div class=\"flex\">\r\n                <div class=\"flex\" v-for=\"(tr,key) in attachmentArray\" :key=\"key\"> \r\n                    <div class=\"flex ml-2\" style=\"flex-direction: column;\">\r\n                        <!--BASE-->\r\n                        <div v-if=\"tr.local == 1\">\r\n                            <img id=\"img1\" v-if=\"tr.tipo == 'img'\" width=\"100\" class=\"img-responsive mb-2 ml-1\" :src=\"$data_url+'archivos/fichas/'+tr.url\" style=\"border-radius: 5px;max-height: 60px;\">\r\n                            <img v-if=\"tr.tipo == 'other'\" style=\"max-height: 60px;width: 50px;\"  src=\"@/assets/images/file-icons/doc.png\"/>\r\n                            <small class=\"mt-1\">{{ tr.name }}</small>\r\n                        </div>\r\n                        <!--LOCAL-->\r\n                        <div v-else>\r\n                            <img id=\"img1\" v-if=\"tr.tipo == 'img'\" width=\"100\" class=\"img-responsive mb-2 ml-1\" v-bind:src=\"tr.img\" style=\"border-radius: 5px;max-height: 60px;\">\r\n                            <img v-else style=\"max-height: 60px;width: 50px;\"  src=\"@/assets/images/file-icons/doc.png\"/>\r\n                            <small class=\"mt-1\">{{ tr.name }}</small>\r\n                        </div>\r\n                    </div>\r\n                    <vs-button radius type=\"line\"  @click=\"removeItemFromArr(attachmentArray,tr)\" class=\"ml-2 mt-4\" color=\"danger\" icon=\"delete\"></vs-button>\r\n                </div>\r\n            </div> \r\n        </div>\r\n        <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full mt-5\" align=\"left\">\r\n            <vs-button :icon=\"btn_icon\" :color=\"btn_color\" @click=\"f_guardar()\">{{ btn_txt }} Ficha</vs-button>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'\r\nimport vSelect from 'vue-select';\r\nexport default {\r\n    components: {\r\n        'v-select': vSelect,\r\n    },\r\n    data() {\r\n        return {\r\n            btn_icon: '',\r\n            btn_color: '',\r\n            btn_txt: '',\r\n            mensaje: '',\r\n            asignaturas: [],\r\n            asignaturaSelect: '',\r\n            unidades: [{\r\n                \"id\": 1,\r\n                \"nombre_unidad\": 'Unidad 1'\r\n            }, {\r\n                \"id\": 2,\r\n                \"nombre_unidad\": 'Unidad 2'\r\n            }, {\r\n                \"id\": 3,\r\n                \"nombre_unidad\": 'Unidad 3'\r\n            }, {\r\n                \"id\": 4,\r\n                \"nombre_unidad\": 'Unidad 4'\r\n            }, {\r\n                \"id\": 5,\r\n                \"nombre_unidad\": 'Unidad 5'\r\n            }, {\r\n                \"id\": 6,\r\n                \"nombre_unidad\": 'Unidad 6'\r\n            }, {\r\n                \"id\": 7,\r\n                \"nombre_unidad\": 'Unidad 7'\r\n            }, {\r\n                \"id\": 8,\r\n                \"nombre_unidad\": 'Unidad 8'\r\n            }],\r\n            unidadesSelect: {},\r\n            modalAdd: false,\r\n            listaDatos: [],\r\n            datos: {},\r\n            titulo: '',\r\n            //variables de files\r\n            attachmentArray:[],\r\n            //fin variables de files\r\n        }\r\n    },\r\n    mounted() {\r\n        let me = this;\r\n        me.getAsignaturas();\r\n        me.f_agregar(me.ficha)\r\n    },\r\n    props:{\r\n        ficha:{\r\n            type:Object,\r\n            default:{}\r\n        },\r\n    },\r\n    methods: {\r\n        getFiles(){\r\n            let me = this;\r\n            this.$http.get(this.$server_url + 'fichas/'+me.ficha.id)\r\n                .then(res => {\r\n                    let datos = res.data.files\r\n                    if(me.datos.length == 0){\r\n                        me.attachmentArray = []\r\n                        return \r\n                    }\r\n                    datos.forEach(element => {\r\n                        var cal = new Object();\r\n                        cal.id          = element.id\r\n                        cal.ficha_id    = element.ficha_id\r\n                        cal.name        = element.archivo\r\n                        cal.url         = element.url\r\n                        let tipo = \"\"\r\n                        if(element.ext == \"PNG\" || element.ext == \"png\" || element.ext == \"JPEG\" || element.ext == \"jpeg\" || element.ext == \"JPG\" || element.ext == \"jpg\"){\r\n                            tipo = \"img\"\r\n                        } \r\n                        else{\r\n                            tipo = \"other\"\r\n                        }\r\n                        cal.tipo        = tipo\r\n                        cal.local       = 1\r\n                        me.attachmentArray.push(cal)\r\n                    });\r\n                })\r\n                .catch(error => {\r\n                    console.log(error)\r\n                })\r\n        },\r\n        getAsignaturas() {\r\n            let me = this;\r\n            this.$http.get(this.$server_url + 'asignaturasActi')\r\n                .then(res => {\r\n                    me.asignaturas = res.data;\r\n                })\r\n                .catch(error => {\r\n                    console.log(error)\r\n                })\r\n        },\r\n        f_agregar() {\r\n            let me = this;\r\n            let item = me.ficha\r\n            me.datos = {\r\n                'id': 0,\r\n                'titulo': '',\r\n                'tipo': 0,\r\n                'estado': 1,\r\n            }\r\n            me.btn_icon = 'save';\r\n            me.btn_color = 'success';\r\n            me.btn_txt = 'Agregar';\r\n            me.titulo = 'Agregar ficha';\r\n            me.mensaje = 'Ficha registrada correctamente';\r\n            if (item.id != undefined) {\r\n                me.getFiles()\r\n                me.btn_icon = 'edit';\r\n                me.btn_color = 'warning';\r\n                me.btn_txt = 'Editar';\r\n                me.titulo = 'Editar ficha';\r\n                me.datos = {\r\n                    'id': item.id,\r\n                    'titulo': item.titulo,\r\n                    'tipo': item.tipo,\r\n                    'estado': item.estado,\r\n                }\r\n                me.asignaturaSelect = item.id_asignatura;\r\n                me.unidadesSelect = me.unidades[item.id_unidad-1].id;\r\n                me.mensaje = 'Ficha editada correctamente';\r\n            }\r\n        },\r\n        f_guardar() {\r\n            let me = this;\r\n            if(me.attachmentArray.length == 0){\r\n              me.$vs.notify({\r\n                text: \"Suba un archivo al menos\",\r\n                color: 'warning',\r\n                iconPack: 'feather',\r\n                icon: 'icon-alert-triangle'\r\n              })\r\n              return\r\n            }\r\n            let msj;\r\n            if (me.datos.titulo == '') {\r\n                msj = 'Ingrese el titulo de la ficha';\r\n                me.f_notificaciones(msj, 'danger', 'icon-alert-triangle')\r\n                return\r\n            }\r\n            if (me.asignaturaSelect == null) {\r\n                msj = 'Seleccione la asignatura';\r\n                me.f_notificaciones(msj, 'danger', 'icon-alert-triangle')\r\n                return\r\n            }\r\n            if (me.unidadesSelect == null) {\r\n                msj = 'Seleccione la unidad';\r\n                me.f_notificaciones(msj, 'danger', 'icon-alert-triangle')\r\n                return\r\n            }\r\n            let formData = new FormData();\r\n            //files\r\n            //enviar solo los files locales\r\n            //local 0 = local; 1 => de la base \r\n            let arrayOnlyLocal = me.attachmentArray.filter(p => p.local == 0)\r\n            if(arrayOnlyLocal.length == 0){\r\n                formData.append('noSendFiles',   'yes');\r\n            }else{\r\n                let imgsEnviar = []\r\n                //setear only files\r\n                arrayOnlyLocal.forEach(element => {\r\n                    imgsEnviar.push(element.file)\r\n                });\r\n                for(let i=0; i<arrayOnlyLocal.length;i++){\r\n                    formData.append('archivos[]',   imgsEnviar[i]);\r\n                }  \r\n            }\r\n            formData.append('id',               me.datos.id)\r\n            formData.append('titulo',           me.datos.titulo)\r\n            formData.append('tipo',             me.datos.tipo)\r\n            formData.append('estado',           me.datos.estado)\r\n            formData.append('id_asignatura',    me.asignaturaSelect)\r\n            formData.append('id_unidad',        me.unidadesSelect)\r\n            formData.append('periodo_id',       localStorage.periodo_id)\r\n            const config = { headers: { 'Content-Type': 'multipart/form-data' } };\r\n            me.$vs.loading();\r\n            axios.post(this.$data_url + 'api/saveFichas', formData, config)\r\n            // this.$http.post(this.$server_url + 'fichas', me.datos)\r\n                .then((result) => {\r\n                    me.$vs.loading.close();\r\n                    // console.log('ficha save', result.data);\r\n                    me.f_notificaciones(me.mensaje, 'success', 'icon-alert-triangle');\r\n                    me.$emit('recharge',true)\r\n                })\r\n                .catch((err) => {\r\n                    me.$vs.loading.close();\r\n                    console.log(err)\r\n                    let msj = 'Error al registrar la ficha';\r\n                    me.f_notificaciones(msj, 'danger', 'icon-alert-triangle')\r\n                })\r\n        },\r\n        f_notificaciones(msj, color, icono) {\r\n            let me = this;\r\n            me.$vs.notify({\r\n                text: msj,\r\n                color: color,\r\n                iconPack: 'feather',\r\n                icon: icono\r\n            })\r\n            return;\r\n        },\r\n        //METODOS FILES\r\n        mostrarImg(e){\r\n            let me = this;\r\n           // var archivo = document.getElementById(\"file1\").files[0];\r\n            let selectedFiles = e.target.files;\r\n            for(let i=0;i<selectedFiles.length;i++){\r\n                // this.attachmentArray.push(selectedFiles[i]);\r\n                let archivo = selectedFiles[i]\r\n                me.setFile(archivo)\r\n            }\r\n        },\r\n        setFile(archivo){\r\n            let me = this;\r\n            let tipo =\"\"\r\n            if(archivo.type == \"image/png\" || archivo.type == \"image/gif\" || archivo.type == \"image/jpeg\" || archivo.type == \"image/jpg\"){\r\n               tipo = \"img\"\r\n            } \r\n            else{\r\n               tipo = \"other\"\r\n            }\r\n            var reader = new FileReader();\r\n            if (me) {\r\n                    reader.readAsDataURL(archivo );\r\n                    reader.onloadend = function () {\r\n                        var cal      = new Object();\r\n                        cal.file     = archivo\r\n                        cal.img      = reader.result\r\n                        cal.tipo     = tipo\r\n                        cal.name     = archivo.name\r\n                        //local 0 ; 1 de la base\r\n                        cal.local    = 0\r\n                        me.attachmentArray.push(cal)\r\n                    } \r\n                }\r\n            return me.attachmentArray\r\n        },\r\n        removeItemFromArr (arr, item) {\r\n            let me = this;\r\n            const i = arr.indexOf(item)\r\n            arr.splice(i, 1)\r\n            if(item.local == 1){\r\n                me.deleteOnlyFile(item.id)\r\n            }\r\n        },\r\n        deleteOnlyFile(id){\r\n            let me = this;\r\n            axios.get(this.$data_url + 'api/deleteFileFicha/'+id)\r\n            .then(res => {\r\n            })\r\n            .catch(error => {\r\n                console.log(error)\r\n            })\r\n        }\r\n        //FIN METODOS FILES\r\n    },\r\n}\r\n</script>\r\n<style scoped>\r\n.farchivo{\r\n    margin-top: 50px!important;\r\n    cursor: pointer; \r\n    /* color: gray; */\r\n     width: 200px; \r\n    font-size: 11px;\r\n    line-height: 80%;\r\n    transition: 0.5s ease all;\r\n    padding: 10px 10px;\r\n    background-color: DodgerBlue;\r\n    border: none;\r\n    color: white;\r\n    border-radius: 5px;\r\n    margin-left: 10px;\r\n}\r\n.farchivo:hover{\r\n    background-color: #7C7B89;\r\n    color:white;\r\n    border-radius: 5px;\r\n}\r\n</style>\r\n"]}]}