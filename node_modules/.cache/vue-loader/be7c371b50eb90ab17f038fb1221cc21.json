{"remainingRequest":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\materialapoyo\\material_subir\\components\\crearMaterial.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\materialapoyo\\material_subir\\components\\crearMaterial.vue","mtime":1712682816155},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\nimport vSelect from 'vue-select'\r\nimport upload from './upload.vue'\r\nexport default {\r\n    data() {\r\n        return {\r\n            changeArchivo:false,\r\n            material: {\r\n                Estado_idEstado:'1',\r\n                asignatura_idasignatura:'',\r\n                descripcion:'',\r\n                nombre:'',\r\n                nombre_material:'',\r\n                user_created:'',\r\n                libro:'',\r\n                id:'',\r\n            },\r\n            limiteMegas: 5,\r\n            bytes: 1048576,\r\n            msjError: 'El peso del archivo excede el limite permitido, verifique antes de continuar',\r\n            usuario:'',\r\n            porcentaje1: '',\r\n            pesoArchivo1: '',\r\n            muyPesado1: '',\r\n            msj1: '',\r\n            file1: '',\r\n            asignaturas: [],\r\n            arregloLibros:[],\r\n            arregloTraeUnidades2:[],\r\n            arregloTraerTemas:[],\r\n            unidades:{\r\n                unidad1:'',\r\n                unidad2:'',\r\n                unidad3:'',\r\n                unidad4:'',\r\n                unidad5:'',\r\n                unidad6:'',\r\n                unidad1Temas:[],\r\n                unidad2Temas:[],\r\n                unidad3Temas:[],\r\n                unidad4Temas:[],\r\n                unidad5Temas:[],\r\n                unidad6Temas:[],\r\n            },\r\n            arregloUnidad1Temas:[],\r\n            arregloUnidad2Temas:[],\r\n            arregloUnidad3Temas:[],\r\n            arregloUnidad4Temas:[],\r\n            arregloUnidad5Temas:[],\r\n            arregloUnidad6Temas:[],\r\n        }\r\n    },\r\n    props:{\r\n        MaterialSend:{\r\n            type:Object,\r\n            default:{}\r\n        },\r\n        tipo:{\r\n            type:Number,\r\n            default:0,\r\n        }\r\n    },\r\n    components: {\r\n        'v-select': vSelect,\r\n        upload\r\n    },\r\n    mounted() {\r\n        let me = this\r\n        this.listalibros()\r\n        this.usuario = JSON.parse(localStorage.getItem('usuario'));\r\n        if(me.tipo == 1){\r\n            me.OpenEdit();\r\n        }\r\n    },\r\n    methods: {\r\n        //lista de libros para usar en el select\r\n        listalibros(){\r\n            let me = this\r\n            this.$http.get(this.$server_url+`libroserie`).then(res => {\r\n                me.arregloLibros = res.data.libroslista;\r\n                })\r\n                .catch(function (error) {\r\n                console.log(error)\r\n                })\r\n        },\r\n        info(item) {\r\n            let me = this;\r\n            if(me.tipo == 1){\r\n                this.material.id = me.MaterialSend.id\r\n            }else{\r\n                this.material.id = item.id\r\n            }\r\n            this.material.nombre = item.nombre\r\n            this.material.nombre_material = item.nombre\r\n        },\r\n        OpenEdit(){\r\n            let me                      = this;\r\n            me.material.libro           = { idlibro:me.MaterialSend.libro_id, nombrelibro:me.MaterialSend.nombrelibro }\r\n            me.material.nombre_material = me.MaterialSend.nombre_material\r\n            me.material.descripcion     = me.MaterialSend.descripcion\r\n            me.material.Estado_idEstado = me.MaterialSend.estado\r\n            me.material.nombre          = me.MaterialSend.archivo\r\n            me.filtrarUnidades()\r\n            me.OpenEditTemas()\r\n        },\r\n        OpenEditTemas(){\r\n            let me = this;\r\n            let datos                = me.MaterialSend.temas\r\n            //unidad1\r\n            let unidad1Temas         = datos.filter(p => p.unidad == 1)\r\n            for(let i =0; i<unidad1Temas.length; i++){\r\n                me.unidades.unidad1Temas = JSON.parse(unidad1Temas[i].temas)\r\n            }\r\n            //unidad2  \r\n            let unidad2Temas         = datos.filter(p => p.unidad == 2)\r\n            for(let i =0; i<unidad2Temas.length; i++){\r\n                me.unidades.unidad2Temas = JSON.parse(unidad2Temas[i].temas)\r\n            } \r\n            //unidad3  \r\n            let unidad3Temas         = datos.filter(p => p.unidad == 3)\r\n            for(let i =0; i<unidad3Temas.length; i++){\r\n                me.unidades.unidad3Temas = JSON.parse(unidad3Temas[i].temas)\r\n            } \r\n            //unidad4  \r\n            let unidad4Temas         = datos.filter(p => p.unidad == 4)\r\n            for(let i =0; i<unidad4Temas.length; i++){\r\n                me.unidades.unidad4Temas = JSON.parse(unidad4Temas[i].temas)\r\n            } \r\n            //unidad5 \r\n            let unidad5Temas         = datos.filter(p => p.unidad == 5)\r\n            for(let i =0; i<unidad5Temas.length; i++){\r\n                me.unidades.unidad5Temas = JSON.parse(unidad5Temas[i].temas)\r\n            } \r\n            //unidad6 \r\n            let unidad6Temas         = datos.filter(p => p.unidad == 6)\r\n            for(let i =0; i<unidad6Temas.length; i++){\r\n                me.unidades.unidad6Temas = JSON.parse(unidad6Temas[i].temas)\r\n            } \r\n        },\r\n        descargaArchivo(item){\r\n            let me = this;\r\n            if(me.usuario.id_group == 4 || me.usuario.id_group == 6){\r\n                //HISTORICO\r\n                let asignatura_id = item.idasignatura\r\n                let idusuario     = me.usuario.idusuario\r\n                let url           = \"material_subir\"\r\n                let actividad     = item.nombre_material\r\n                let periodo_id    = localStorage.periodo_id\r\n                this.$http.get(this.$server_url+'conteoActividad?asignatura_id='+asignatura_id+'&idusuario='+idusuario+'&url='+url+'&actividad='+actividad+'&periodo_id='+periodo_id+'&pagina=0&tipo=2')\r\n                .then(function (res) {\r\n                })\r\n                .catch(function (error) {\r\n                    console.log(error + ' error');\r\n                })\r\n            }\r\n           \r\n            //FIN HISTORICO\r\n            let url2 = this.$data_url+'archivos/material_subir/'+item.url\r\n            window.open(url2)\r\n        },\r\n        guardar() {\r\n            let me = this;\r\n            if(me.material.libro == null || me.material.libro == undefined || me.material.libro == \"\"){\r\n                  me.$vs.notify({\r\n                  text:'Tiene que seleccionar un libro',\r\n                  color:'warning',\r\n                  iconPack: 'feather',\r\n                  icon:'icon-check'})\r\n                return false\r\n            }\r\n            if(me.material.nombre == \"\"){\r\n                  me.$vs.notify({\r\n                  text:'Tiene que subir un archivo',\r\n                  color:'warning',\r\n                  iconPack: 'feather',\r\n                  icon:'icon-check'})\r\n                return false\r\n            }\r\n            me.$vs.loading();\r\n            let formData = new FormData();\r\n            //Editar\r\n            if(me.tipo == 1){\r\n                formData.append('id',                                    me.MaterialSend.id);\r\n            }\r\n            //GUARDAR\r\n            else{\r\n                formData.append('id',                                    me.material.id);\r\n            }\r\n            formData.append('libro_id',                                  me.material.libro.idlibro);\r\n            formData.append('nombre_material',                           me.material.nombre_material);\r\n            if(me.material.descripcion == null || me.material.descripcion == \"null\"){\r\n                formData.append('descripcion',                           \"\");\r\n            }else{\r\n                formData.append('descripcion',                           me.material.descripcion);\r\n            }\r\n            formData.append('estado',                                    me.material.Estado_idEstado);\r\n            formData.append('user_created',                              me.usuario.idusuario);\r\n            //save units\r\n            if(me.unidades.unidad1Temas !=undefined)formData.append('unidad1Temas',JSON.stringify(me.unidades.unidad1Temas))\r\n            if(me.unidades.unidad2Temas !=undefined)formData.append('unidad2Temas',JSON.stringify(me.unidades.unidad2Temas))\r\n            if(me.unidades.unidad3Temas !=undefined)formData.append('unidad3Temas',JSON.stringify(me.unidades.unidad3Temas))\r\n            if(me.unidades.unidad4Temas !=undefined)formData.append('unidad4Temas',JSON.stringify(me.unidades.unidad4Temas))\r\n            if(me.unidades.unidad5Temas !=undefined)formData.append('unidad5Temas',JSON.stringify(me.unidades.unidad5Temas))\r\n            if(me.unidades.unidad6Temas !=undefined)formData.append('unidad6Temas',JSON.stringify(me.unidades.unidad6Temas))\r\n            this.$http.post(this.$server_url + 'guardarMaterialSubir',   formData)\r\n                .then(res => {\r\n                    me.$vs.loading.close();\r\n                    me.$vs.notify({\r\n                    text:res.data.message,\r\n                    color:'success',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                    var item = {}\r\n                    me.$emit('listado',false)\r\n                    // item.planificacion = {}\r\n                    // item.menu = {\r\n                    //     plista: true,\r\n                    //     pnuevo: false,\r\n                    //     peditar: false\r\n                    // }\r\n                    // me.$emit('item', item)\r\n                })\r\n                .catch(e => {\r\n                    console.log(e)\r\n                    me.$vs.loading.close();\r\n                })\r\n        },\r\n        //filtro para filtrar unidad por libro\r\n        filtrarUnidades(){\r\n            let me = this;\r\n            const formData = new FormData();\r\n                if( me.material.libro.idlibro === undefined ){\r\n                me.$vs.notify({\r\n                    text:'Seleccione una libro antes de filtrar por unidades',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                return;\r\n            }\r\n            me.arregloTraeUnidades2 = [];\r\n            me.$vs.loading()\r\n            this.$http.get(this.$server_url+'traerunidades?idlibro='+ me.material.libro.idlibro)\r\n            .then(res => { \r\n            me.arregloTraeUnidades2 = res.data;\r\n            me.setUnits(me.arregloTraeUnidades2);\r\n            me.$vs.loading.close()\r\n            })\r\n            .catch(function (error) {\r\n                me.$vs.loading.close()\r\n                console.log(error);\r\n            })  \r\n        },\r\n        setUnits(tr){\r\n            let me = this;\r\n            let getUnidad1 = tr.filter(p => p.unit == 1)\r\n            let getUnidad2 = tr.filter(p => p.unit == 2)\r\n            let getUnidad3 = tr.filter(p => p.unit == 3)\r\n            let getUnidad4 = tr.filter(p => p.unit == 4)\r\n            let getUnidad5 = tr.filter(p => p.unit == 5)\r\n            let getUnidad6 = tr.filter(p => p.unit == 6)\r\n            //enviar a las unidades\r\n            me.unidades.unidad1 = getUnidad1\r\n            me.unidades.unidad2 = getUnidad2\r\n            me.unidades.unidad3 = getUnidad3\r\n            me.unidades.unidad4 = getUnidad4\r\n            me.unidades.unidad5 = getUnidad5\r\n            me.unidades.unidad6 = getUnidad6\r\n        },\r\n        verTemas(unidad,unidad_id){\r\n            let me = this; \r\n            if(unidad_id == undefined || unidad_id == null || unidad_id == \"\"){\r\n                me.$vs.notify({\r\n                    text:'Seleccione una libro antes de filtrar los temas',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                return; \r\n            }\r\n            me.$vs.loading()\r\n            const formData = new FormData();\r\n            formData.append('id_unidad_libro', unidad_id[0].id_unidad_libro);\r\n            this.$http.post(this.$server_url+'traertemas', formData).then(res => {\r\n                me.$vs.loading.close()\r\n                if(unidad == 1) me.arregloUnidad1Temas = res.data\r\n                if(unidad == 2) me.arregloUnidad2Temas = res.data\r\n                if(unidad == 3) me.arregloUnidad3Temas = res.data\r\n                if(unidad == 4) me.arregloUnidad4Temas = res.data\r\n                if(unidad == 5) me.arregloUnidad5Temas = res.data\r\n                if(unidad == 6) me.arregloUnidad6Temas = res.data\r\n            })\r\n            .catch(function (error) {\r\n                console.log(error);\r\n            })  \r\n        },\r\n    },\r\n}\r\n",{"version":3,"sources":["crearMaterial.vue"],"names":[],"mappings":";AAuJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"crearMaterial.vue","sourceRoot":"src/views/materialapoyo/material_subir/components","sourcesContent":["<template>\r\n<div>\r\n    <vs-card>\r\n        <div class=\"vx-row m-2\">\r\n            <div class=\"vx-col w-full mb-base\" align=\"left\">\r\n                <div v-if=\"MaterialSend.length == 0 || changeArchivo\">\r\n                    <div style=\"font-size: 12px;\">Cargar Archivo </div>\r\n                    <upload :tipo=\"tipo\" :id=\"MaterialSend.id\" class=\"w-full flex justify-center\" v-on:file=\"info\"></upload>\r\n                </div>\r\n               \r\n                <div v-else class=\"borde-unidad\">\r\n                    <div style=\"font-size: 12px;\" class=\"mb-2\">Archivo actual: </div>\r\n                    <div class=\"m-1\">\r\n                        <p><b>Archivo:</b></p>\r\n                        <p>{{MaterialSend.archivo}}</p>\r\n                        <p>\r\n                            <vx-tooltip text=\"Descargar\" position=\"bottom\" style=\"display: inline-block\" color=\"success\">\r\n                                <vs-button style=\"display: inline\" class=\"m-1\" @click=\"descargaArchivo(MaterialSend)\" size=\"small\" icon-pack=\"feather\" icon=\"icon-arrow-down\" color=\"success\" type=\"border\"></vs-button>\r\n                            </vx-tooltip>\r\n                            <vx-tooltip text=\"Reemplazar archivo\" position=\"bottom\" style=\"display: inline-block\" color=\"danger\">\r\n                                <vs-button style=\"display: inline\" class=\"m-1\" size=\"small\" icon-pack=\"feather\" icon=\"icon-shuffle\" color=\"danger\" type=\"border\" @click=\"changeArchivo = true;\"></vs-button>\r\n                            </vx-tooltip>\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n               \r\n            </div>\r\n            <div class=\"vx-col w-full\" align=\"left\">\r\n                <div style=\"font-size: 12px; \">Libro: </div>\r\n                 <v-select @input=\"filtrarUnidades()\"  :options=\"arregloLibros\" :reduce=\"arregloLibros => arregloLibros\" label=\"nombrelibro\" class=\"w-full\" v-model=\"material.libro\" />\r\n            </div>\r\n            <div class=\"vx-col w-full mt-4\" align=\"left\">\r\n                <div style=\"font-size: 12px;\">Nombre del material: </div>\r\n                <vs-input type=\"text\" class=\"inputx w-full mb-6\" v-model=\"material.nombre_material\" maxlength=\"300\" placeholder=\"nombre\" />\r\n            </div>\r\n            <div class=\"vx-col w-full\" align=\"left\">\r\n                <div style=\"font-size: 12px;\">Descripcion </div>\r\n                <vs-input type=\"text\" class=\"inputx w-full mb-6\" v-model=\"material.descripcion\" maxlength=\"350\" placeholder=\"descripcion\" />\r\n            </div>\r\n            <div class=\"vx-col w-full mb-base\" align=\"left\">\r\n                <div style=\"font-size: 12px;\">Estado </div>\r\n                <vs-radio v-model=\"material.Estado_idEstado\" vs-name=\"radioEstado\" class=\"m-2\" vs-value=\"1\">Activo</vs-radio>\r\n                <vs-radio v-model=\"material.Estado_idEstado\"  vs-name=\"radioEstado\" class=\"m-2\" color=\"danger\" vs-value=\"0\">Inactivo</vs-radio>\r\n            </div>\r\n            <vs-divider>Seleccione los Temas</vs-divider>\r\n            <!--Unidad 1-->\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full\" align=\"left\">\r\n            <div style=\"font-size: 12px; \">Unidad 1: </div>\r\n                <v-select @input=\"filtrarTemas()\" disabled :options=\"arregloTraeUnidades2\" :reduce=\"arregloTraeUnidades2 => arregloTraeUnidades2.id_unidad_libro\" label=\"unidad\" class=\"w-full\" v-model=\"unidades.unidad1\" />\r\n            </div>\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full \" align=\"left\">\r\n                <div style=\"font-size: 12px; \">Temas: </div>\r\n                <div class=\"flex\">\r\n                    <v-select multiple  :closeOnSelect=\"false\" :options=\"arregloUnidad1Temas\" id=\"temas\" :reduce=\"arregloUnidad1Temas => arregloUnidad1Temas\" label=\"nombre_tema\" class=\"w-full\" v-model=\"unidades.unidad1Temas\" />\r\n                    <vx-tooltip   text=\"Añadir temas\" position=\"top\" color=\"primary\">\r\n                        <vs-button style=\"margin-left:2px;\" @click=\"verTemas(1,unidades.unidad1);\" size=\"small\" color=\"success\" type=\"flat\" icon=\"add\">HAGA CLICK</vs-button>\r\n                    </vx-tooltip>\r\n                </div>\r\n            </div>\r\n            <vs-divider></vs-divider>\r\n            <!--Fin Unidad 1-->\r\n            <!--Unidad 2-->\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full mt-1\" align=\"left\">\r\n                <div style=\"font-size: 12px; \">Unidad 2: </div>\r\n                 <v-select @input=\"filtrarTemas()\" disabled :options=\"arregloTraeUnidades2\" :reduce=\"arregloTraeUnidades2 => arregloTraeUnidades2.id_unidad_libro\" label=\"unidad\" class=\"w-full\" v-model=\"unidades.unidad2\" />\r\n                \r\n            </div>\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full\" mt-1 align=\"left\">\r\n                <div style=\"font-size: 12px; \">Temas: </div>\r\n                <div class=\"flex\">\r\n                    <v-select multiple  :closeOnSelect=\"false\" :options=\"arregloUnidad2Temas\" id=\"temas\" :reduce=\"arregloUnidad2Temas => arregloUnidad2Temas\" label=\"nombre_tema\" class=\"w-full\" v-model=\"unidades.unidad2Temas\" />\r\n                    <vx-tooltip   text=\"Añadir temas\" position=\"top\" color=\"primary\">\r\n                        <vs-button style=\"margin-left:2px;\" @click=\"verTemas(2,unidades.unidad2);\"  color=\"success\" size=\"small\" type=\"flat\" icon=\"add\">HAGA CLICK</vs-button>\r\n                    </vx-tooltip>\r\n                </div>\r\n            </div>\r\n            <vs-divider></vs-divider>\r\n            <!--Fin Unidad 2-->\r\n            <!--Unidad 3-->\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full mt-1\" align=\"left\">\r\n                <div style=\"font-size: 12px; \">Unidad 3: </div>\r\n                 <v-select @input=\"filtrarTemas()\" disabled :options=\"arregloTraeUnidades2\" :reduce=\"arregloTraeUnidades2 => arregloTraeUnidades2.id_unidad_libro\" label=\"unidad\" class=\"w-full\" v-model=\"unidades.unidad3\" />\r\n            </div>\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full\" mt-1 align=\"left\">\r\n                <div style=\"font-size: 12px; \">Temas: </div>\r\n                <div class=\"flex\">\r\n                    <v-select multiple  :closeOnSelect=\"false\" :options=\"arregloUnidad3Temas\" id=\"temas\" :reduce=\"arregloUnidad3Temas => arregloUnidad3Temas\" label=\"nombre_tema\" class=\"w-full\" v-model=\"unidades.unidad3Temas\" />\r\n                    <vx-tooltip   text=\"Añadir temas\" position=\"top\" color=\"primary\">\r\n                        <vs-button style=\"margin-left:2px;\" @click=\"verTemas(3,unidades.unidad3);\"  color=\"success\" type=\"flat\" size=\"small\" icon=\"add\">HAGA CLICK</vs-button>\r\n                    </vx-tooltip>\r\n                </div>\r\n            </div>\r\n            <vs-divider></vs-divider>\r\n            <!--Fin Unidad 3-->\r\n            <!--Unidad 4-->\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full mt-1\" align=\"left\">\r\n                <div style=\"font-size: 12px; \">Unidad 4: </div>\r\n                 <v-select @input=\"filtrarTemas()\" disabled :options=\"arregloTraeUnidades2\" :reduce=\"arregloTraeUnidades2 => arregloTraeUnidades2.id_unidad_libro\" label=\"unidad\" class=\"w-full\" v-model=\"unidades.unidad4\" />\r\n            </div>\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full\" mt-1 align=\"left\">\r\n                <div style=\"font-size: 12px; \">Temas: </div>\r\n                <div class=\"flex\">\r\n                    <v-select multiple  :closeOnSelect=\"false\" :options=\"arregloUnidad4Temas\" id=\"temas\" :reduce=\"arregloUnidad4Temas => arregloUnidad4Temas\" label=\"nombre_tema\" class=\"w-full\" v-model=\"unidades.unidad4Temas\" />\r\n                    <vx-tooltip   text=\"Añadir temas\" position=\"top\" color=\"primary\">\r\n                        <vs-button style=\"margin-left:2px;\" @click=\"verTemas(4,unidades.unidad4);\"  color=\"success\" type=\"flat\" size=\"small\" icon=\"add\">HAGA CLICK</vs-button>\r\n                    </vx-tooltip>\r\n                </div>\r\n            </div>\r\n            <vs-divider></vs-divider>\r\n            <!--Fin Unidad 4-->\r\n            <!--Unidad 5-->\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full mt-1\" align=\"left\">\r\n                <div style=\"font-size: 12px; \">Unidad 5: </div>\r\n                 <v-select @input=\"filtrarTemas()\" disabled :options=\"arregloTraeUnidades2\" :reduce=\"arregloTraeUnidades2 => arregloTraeUnidades2.id_unidad_libro\" label=\"unidad\" class=\"w-full\" v-model=\"unidades.unidad5\" />\r\n            </div>\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full\" mt-1 align=\"left\">\r\n                <div style=\"font-size: 12px; \">Temas: </div>\r\n                <div class=\"flex\">\r\n                    <v-select multiple  :closeOnSelect=\"false\" :options=\"arregloUnidad5Temas\" id=\"temas\" :reduce=\"arregloUnidad5Temas => arregloUnidad5Temas\" label=\"nombre_tema\" class=\"w-full\" v-model=\"unidades.unidad5Temas\" />\r\n                    <vx-tooltip   text=\"Añadir temas\" position=\"top\" color=\"primary\">\r\n                        <vs-button style=\"margin-left:2px;\" @click=\"verTemas(5,unidades.unidad5);\"  color=\"success\" type=\"flat\" size=\"small\" icon=\"add\">HAGA CLICK</vs-button>\r\n                    </vx-tooltip>\r\n                </div>\r\n            </div>\r\n            <vs-divider></vs-divider>\r\n            <!--Fin Unidad 5-->\r\n            <!--Unidad 6-->\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full mt-1\" align=\"left\">\r\n                <div style=\"font-size: 12px; \">Unidad 6: </div>\r\n                 <v-select @input=\"filtrarTemas()\" disabled :options=\"arregloTraeUnidades2\" :reduce=\"arregloTraeUnidades2 => arregloTraeUnidades2.id_unidad_libro\" label=\"unidad\" class=\"w-full\" v-model=\"unidades.unidad6\" />\r\n            </div>\r\n            <div class=\"vx-col sm:w-1/2 lg:w-1/2 w-full\" mt-1 align=\"left\">\r\n                <div style=\"font-size: 12px; \">Temas: </div>\r\n                <div class=\"flex\">\r\n                    <v-select multiple  :closeOnSelect=\"false\" :options=\"arregloUnidad6Temas\" id=\"temas\" :reduce=\"arregloUnidad6Temas => arregloUnidad6Temas\" label=\"nombre_tema\" class=\"w-full\" v-model=\"unidades.unidad6Temas\" />\r\n                    <vx-tooltip   text=\"Añadir temas\" position=\"top\" color=\"primary\">\r\n                        <vs-button style=\"margin-left:2px;\" @click=\"verTemas(6,unidades.unidad6);\"  color=\"success\" type=\"flat\" size=\"small\" icon=\"add\">HAGA CLICK</vs-button>\r\n                    </vx-tooltip>\r\n                </div>\r\n            </div>\r\n            <vs-divider></vs-divider>\r\n            <!--Fin Unidad 6-->\r\n            <div class=\"vx-col w-full flex justify-end\">\r\n                <vs-button style=\"display:inline\" class=\"m-2 mb-2 uppercase\" type=\"filled\" @click=\"guardar()\"> Guardar </vs-button>\r\n            </div>\r\n        </div>\r\n    </vs-card>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport vSelect from 'vue-select'\r\nimport upload from './upload.vue'\r\nexport default {\r\n    data() {\r\n        return {\r\n            changeArchivo:false,\r\n            material: {\r\n                Estado_idEstado:'1',\r\n                asignatura_idasignatura:'',\r\n                descripcion:'',\r\n                nombre:'',\r\n                nombre_material:'',\r\n                user_created:'',\r\n                libro:'',\r\n                id:'',\r\n            },\r\n            limiteMegas: 5,\r\n            bytes: 1048576,\r\n            msjError: 'El peso del archivo excede el limite permitido, verifique antes de continuar',\r\n            usuario:'',\r\n            porcentaje1: '',\r\n            pesoArchivo1: '',\r\n            muyPesado1: '',\r\n            msj1: '',\r\n            file1: '',\r\n            asignaturas: [],\r\n            arregloLibros:[],\r\n            arregloTraeUnidades2:[],\r\n            arregloTraerTemas:[],\r\n            unidades:{\r\n                unidad1:'',\r\n                unidad2:'',\r\n                unidad3:'',\r\n                unidad4:'',\r\n                unidad5:'',\r\n                unidad6:'',\r\n                unidad1Temas:[],\r\n                unidad2Temas:[],\r\n                unidad3Temas:[],\r\n                unidad4Temas:[],\r\n                unidad5Temas:[],\r\n                unidad6Temas:[],\r\n            },\r\n            arregloUnidad1Temas:[],\r\n            arregloUnidad2Temas:[],\r\n            arregloUnidad3Temas:[],\r\n            arregloUnidad4Temas:[],\r\n            arregloUnidad5Temas:[],\r\n            arregloUnidad6Temas:[],\r\n        }\r\n    },\r\n    props:{\r\n        MaterialSend:{\r\n            type:Object,\r\n            default:{}\r\n        },\r\n        tipo:{\r\n            type:Number,\r\n            default:0,\r\n        }\r\n    },\r\n    components: {\r\n        'v-select': vSelect,\r\n        upload\r\n    },\r\n    mounted() {\r\n        let me = this\r\n        this.listalibros()\r\n        this.usuario = JSON.parse(localStorage.getItem('usuario'));\r\n        if(me.tipo == 1){\r\n            me.OpenEdit();\r\n        }\r\n    },\r\n    methods: {\r\n        //lista de libros para usar en el select\r\n        listalibros(){\r\n            let me = this\r\n            this.$http.get(this.$server_url+`libroserie`).then(res => {\r\n                me.arregloLibros = res.data.libroslista;\r\n                })\r\n                .catch(function (error) {\r\n                console.log(error)\r\n                })\r\n        },\r\n        info(item) {\r\n            let me = this;\r\n            if(me.tipo == 1){\r\n                this.material.id = me.MaterialSend.id\r\n            }else{\r\n                this.material.id = item.id\r\n            }\r\n            this.material.nombre = item.nombre\r\n            this.material.nombre_material = item.nombre\r\n        },\r\n        OpenEdit(){\r\n            let me                      = this;\r\n            me.material.libro           = { idlibro:me.MaterialSend.libro_id, nombrelibro:me.MaterialSend.nombrelibro }\r\n            me.material.nombre_material = me.MaterialSend.nombre_material\r\n            me.material.descripcion     = me.MaterialSend.descripcion\r\n            me.material.Estado_idEstado = me.MaterialSend.estado\r\n            me.material.nombre          = me.MaterialSend.archivo\r\n            me.filtrarUnidades()\r\n            me.OpenEditTemas()\r\n        },\r\n        OpenEditTemas(){\r\n            let me = this;\r\n            let datos                = me.MaterialSend.temas\r\n            //unidad1\r\n            let unidad1Temas         = datos.filter(p => p.unidad == 1)\r\n            for(let i =0; i<unidad1Temas.length; i++){\r\n                me.unidades.unidad1Temas = JSON.parse(unidad1Temas[i].temas)\r\n            }\r\n            //unidad2  \r\n            let unidad2Temas         = datos.filter(p => p.unidad == 2)\r\n            for(let i =0; i<unidad2Temas.length; i++){\r\n                me.unidades.unidad2Temas = JSON.parse(unidad2Temas[i].temas)\r\n            } \r\n            //unidad3  \r\n            let unidad3Temas         = datos.filter(p => p.unidad == 3)\r\n            for(let i =0; i<unidad3Temas.length; i++){\r\n                me.unidades.unidad3Temas = JSON.parse(unidad3Temas[i].temas)\r\n            } \r\n            //unidad4  \r\n            let unidad4Temas         = datos.filter(p => p.unidad == 4)\r\n            for(let i =0; i<unidad4Temas.length; i++){\r\n                me.unidades.unidad4Temas = JSON.parse(unidad4Temas[i].temas)\r\n            } \r\n            //unidad5 \r\n            let unidad5Temas         = datos.filter(p => p.unidad == 5)\r\n            for(let i =0; i<unidad5Temas.length; i++){\r\n                me.unidades.unidad5Temas = JSON.parse(unidad5Temas[i].temas)\r\n            } \r\n            //unidad6 \r\n            let unidad6Temas         = datos.filter(p => p.unidad == 6)\r\n            for(let i =0; i<unidad6Temas.length; i++){\r\n                me.unidades.unidad6Temas = JSON.parse(unidad6Temas[i].temas)\r\n            } \r\n        },\r\n        descargaArchivo(item){\r\n            let me = this;\r\n            if(me.usuario.id_group == 4 || me.usuario.id_group == 6){\r\n                //HISTORICO\r\n                let asignatura_id = item.idasignatura\r\n                let idusuario     = me.usuario.idusuario\r\n                let url           = \"material_subir\"\r\n                let actividad     = item.nombre_material\r\n                let periodo_id    = localStorage.periodo_id\r\n                this.$http.get(this.$server_url+'conteoActividad?asignatura_id='+asignatura_id+'&idusuario='+idusuario+'&url='+url+'&actividad='+actividad+'&periodo_id='+periodo_id+'&pagina=0&tipo=2')\r\n                .then(function (res) {\r\n                })\r\n                .catch(function (error) {\r\n                    console.log(error + ' error');\r\n                })\r\n            }\r\n           \r\n            //FIN HISTORICO\r\n            let url2 = this.$data_url+'archivos/material_subir/'+item.url\r\n            window.open(url2)\r\n        },\r\n        guardar() {\r\n            let me = this;\r\n            if(me.material.libro == null || me.material.libro == undefined || me.material.libro == \"\"){\r\n                  me.$vs.notify({\r\n                  text:'Tiene que seleccionar un libro',\r\n                  color:'warning',\r\n                  iconPack: 'feather',\r\n                  icon:'icon-check'})\r\n                return false\r\n            }\r\n            if(me.material.nombre == \"\"){\r\n                  me.$vs.notify({\r\n                  text:'Tiene que subir un archivo',\r\n                  color:'warning',\r\n                  iconPack: 'feather',\r\n                  icon:'icon-check'})\r\n                return false\r\n            }\r\n            me.$vs.loading();\r\n            let formData = new FormData();\r\n            //Editar\r\n            if(me.tipo == 1){\r\n                formData.append('id',                                    me.MaterialSend.id);\r\n            }\r\n            //GUARDAR\r\n            else{\r\n                formData.append('id',                                    me.material.id);\r\n            }\r\n            formData.append('libro_id',                                  me.material.libro.idlibro);\r\n            formData.append('nombre_material',                           me.material.nombre_material);\r\n            if(me.material.descripcion == null || me.material.descripcion == \"null\"){\r\n                formData.append('descripcion',                           \"\");\r\n            }else{\r\n                formData.append('descripcion',                           me.material.descripcion);\r\n            }\r\n            formData.append('estado',                                    me.material.Estado_idEstado);\r\n            formData.append('user_created',                              me.usuario.idusuario);\r\n            //save units\r\n            if(me.unidades.unidad1Temas !=undefined)formData.append('unidad1Temas',JSON.stringify(me.unidades.unidad1Temas))\r\n            if(me.unidades.unidad2Temas !=undefined)formData.append('unidad2Temas',JSON.stringify(me.unidades.unidad2Temas))\r\n            if(me.unidades.unidad3Temas !=undefined)formData.append('unidad3Temas',JSON.stringify(me.unidades.unidad3Temas))\r\n            if(me.unidades.unidad4Temas !=undefined)formData.append('unidad4Temas',JSON.stringify(me.unidades.unidad4Temas))\r\n            if(me.unidades.unidad5Temas !=undefined)formData.append('unidad5Temas',JSON.stringify(me.unidades.unidad5Temas))\r\n            if(me.unidades.unidad6Temas !=undefined)formData.append('unidad6Temas',JSON.stringify(me.unidades.unidad6Temas))\r\n            this.$http.post(this.$server_url + 'guardarMaterialSubir',   formData)\r\n                .then(res => {\r\n                    me.$vs.loading.close();\r\n                    me.$vs.notify({\r\n                    text:res.data.message,\r\n                    color:'success',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                    var item = {}\r\n                    me.$emit('listado',false)\r\n                    // item.planificacion = {}\r\n                    // item.menu = {\r\n                    //     plista: true,\r\n                    //     pnuevo: false,\r\n                    //     peditar: false\r\n                    // }\r\n                    // me.$emit('item', item)\r\n                })\r\n                .catch(e => {\r\n                    console.log(e)\r\n                    me.$vs.loading.close();\r\n                })\r\n        },\r\n        //filtro para filtrar unidad por libro\r\n        filtrarUnidades(){\r\n            let me = this;\r\n            const formData = new FormData();\r\n                if( me.material.libro.idlibro === undefined ){\r\n                me.$vs.notify({\r\n                    text:'Seleccione una libro antes de filtrar por unidades',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                return;\r\n            }\r\n            me.arregloTraeUnidades2 = [];\r\n            me.$vs.loading()\r\n            this.$http.get(this.$server_url+'traerunidades?idlibro='+ me.material.libro.idlibro)\r\n            .then(res => { \r\n            me.arregloTraeUnidades2 = res.data;\r\n            me.setUnits(me.arregloTraeUnidades2);\r\n            me.$vs.loading.close()\r\n            })\r\n            .catch(function (error) {\r\n                me.$vs.loading.close()\r\n                console.log(error);\r\n            })  \r\n        },\r\n        setUnits(tr){\r\n            let me = this;\r\n            let getUnidad1 = tr.filter(p => p.unit == 1)\r\n            let getUnidad2 = tr.filter(p => p.unit == 2)\r\n            let getUnidad3 = tr.filter(p => p.unit == 3)\r\n            let getUnidad4 = tr.filter(p => p.unit == 4)\r\n            let getUnidad5 = tr.filter(p => p.unit == 5)\r\n            let getUnidad6 = tr.filter(p => p.unit == 6)\r\n            //enviar a las unidades\r\n            me.unidades.unidad1 = getUnidad1\r\n            me.unidades.unidad2 = getUnidad2\r\n            me.unidades.unidad3 = getUnidad3\r\n            me.unidades.unidad4 = getUnidad4\r\n            me.unidades.unidad5 = getUnidad5\r\n            me.unidades.unidad6 = getUnidad6\r\n        },\r\n        verTemas(unidad,unidad_id){\r\n            let me = this; \r\n            if(unidad_id == undefined || unidad_id == null || unidad_id == \"\"){\r\n                me.$vs.notify({\r\n                    text:'Seleccione una libro antes de filtrar los temas',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                return; \r\n            }\r\n            me.$vs.loading()\r\n            const formData = new FormData();\r\n            formData.append('id_unidad_libro', unidad_id[0].id_unidad_libro);\r\n            this.$http.post(this.$server_url+'traertemas', formData).then(res => {\r\n                me.$vs.loading.close()\r\n                if(unidad == 1) me.arregloUnidad1Temas = res.data\r\n                if(unidad == 2) me.arregloUnidad2Temas = res.data\r\n                if(unidad == 3) me.arregloUnidad3Temas = res.data\r\n                if(unidad == 4) me.arregloUnidad4Temas = res.data\r\n                if(unidad == 5) me.arregloUnidad5Temas = res.data\r\n                if(unidad == 6) me.arregloUnidad6Temas = res.data\r\n            })\r\n            .catch(function (error) {\r\n                console.log(error);\r\n            })  \r\n        },\r\n    },\r\n}\r\n</script>\r\n<style>\r\n.borde-unidad {\r\n    border: 1px dashed #ccc;\r\n    /* display: inline-block; */\r\n    padding: 6px;\r\n    cursor: pointer;\r\n}\r\n</style>\r\n\r\n"]}]}