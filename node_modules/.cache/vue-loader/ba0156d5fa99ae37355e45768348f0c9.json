{"remainingRequest":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\temporadas\\components\\Pedidos\\Configuracion\\Convenios\\ScreenConvenio.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\temporadas\\components\\Pedidos\\Configuracion\\Convenios\\ScreenConvenio.vue","mtime":1712682816562},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\nimport {\r\n    mapState,\r\n    mapActions\r\n} from 'vuex'\r\nimport PedidosRepository from '../../../../../../repositories/PedidosRepository'\r\nconst ListadoConveniosVue           = () => import('./ListadoConvenios.vue')\r\nconst DatosConveniosVue             = () => import('./DatosConvenios')\r\nconst CrearContratoConvenioVue      = () => import('./CrearContratoConvenio')\r\nconst CrearConvenioVue              = () => import('./CrearConvenio.vue')\r\nexport default {\r\n  components:{\r\n    ListadoConveniosVue,\r\n    DatosConveniosVue,\r\n    CrearContratoConvenioVue,\r\n    CrearConvenioVue,\r\n  },\r\n  data() {\r\n    return{\r\n      usuario:[],\r\n      id_pedido:0,\r\n      arrayInformation:[],\r\n      arrayAgreements:[],\r\n      arrayContracts:[],\r\n      sendPedido:'',\r\n      setAnticipoGlobal:0,\r\n      aniosDivider:0,\r\n      valuesAgreements:0,\r\n      showSuggested:false,\r\n      idConvenio:0,\r\n      popupAddAgreement:false,\r\n      //variables for contract\r\n      popupAddContract:false,\r\n      idConvenioHijo:0,\r\n      agreementSonObject:'',\r\n      //end variables for contract\r\n      open:false,\r\n      datosInstitucion:'',\r\n    }\r\n  },\r\n  computed:{\r\n      ...mapState(['pedidoId','userRoot','groupFacturador','ObjectPedido']),\r\n  },\r\n  created(){\r\n    let me = this;\r\n    me.usuario = JSON.parse(localStorage.getItem(\"usuario\"))\r\n  },\r\n  mounted(){\r\n    let me = this\r\n    me.id_pedido          = me.ObjectPedido.id_pedido\r\n    me.sendPedido         = me.ObjectPedido\r\n    me.datosInstitucion   = me.ObjectPedido\r\n    me.getDatosConvenio()\r\n    me.getContratos()\r\n  },\r\n  methods:{\r\n    getPedido(){\r\n      let me = this\r\n      me.sendPedido = []\r\n      PedidosRepository.getPedidoXID(me.id_pedido).then(r => { me.sendPedido = r.data[0]; })\r\n    },\r\n    changeRecharge(e,tr){\r\n      let me = this\r\n      me.arrayAgreements = []\r\n      //cancel\r\n      if(e == 0){ me.popupAddContract = true; }\r\n      if(e == 1){\r\n        me.getPedido()\r\n        me.getDatosConvenio()\r\n        let datos = {\r\n          \"tipo\"                            :8,\r\n        }\r\n        me.$emit('recharge',datos)\r\n      }\r\n      //crud\r\n      if(e == 2){\r\n        me.popupAddContract   = true\r\n        me.idConvenioHijo     = tr.doc_codigo\r\n        me.agreementSonObject = tr\r\n      }\r\n      //resete values\r\n      if(e == 3) {\r\n        me.getPedido()\r\n        me.getDatosConvenio()\r\n        me.setValuesAgreements(0)\r\n          let datos = {\r\n          \"tipo\"                            :8,\r\n        }\r\n        me.$emit('recharge',datos)\r\n      }\r\n    },\r\n    getContratos(){\r\n      let me = this;\r\n      me.arrayContracts                  = []\r\n      const { id_institucion,id_periodo  }  = me.ObjectPedido\r\n      this.$http.get(this.$server_url+`convenio?allContratoXInstitucion=yes&institucion_id=${id_institucion}`)\r\n        .then(function (res) {\r\n          me.arrayContracts = res.data\r\n      })\r\n      .catch(function (error) {\r\n          console.log(error + ' error');\r\n      })\r\n    },\r\n    getDatosConvenio() {\r\n      let me = this;\r\n      me.arrayAgreements                   = []\r\n      me.arrayInformation                  = []\r\n      me.aniosDivider                      = 0\r\n      me.valuesAgreements                  = 0\r\n      me.showSuggested                     = false\r\n      me.popupAddContract                  = false\r\n      me.popupAddAgreement                 = false\r\n      me.tooContracts                      = false\r\n      const { id_institucion,id_periodo  }  = me.datosInstitucion\r\n      me.$vs.loading()\r\n      this.$http.get(this.$server_url+`convenio?AllConvenios=yes&institucion_id=${id_institucion}`)\r\n        .then(function (res) {\r\n          me.$vs.loading.close()\r\n          let datos = res.data\r\n          console.log(\"eee\",datos)\r\n          if(datos.length > 0){\r\n            me.arrayInformation   = datos.filter(p => p.periodo_id == id_periodo || p.id == me.sendPedido.pedidos_convenios_id)\r\n            if(me.arrayInformation.length > 0){\r\n              me.open = false;\r\n              console.log(\"coincide\")\r\n              // me.arrayInformation   = datos\r\n              me.setAnticipoGlobal  = me.arrayInformation[0].anticipo_global\r\n              me.aniosDivider       = me.arrayInformation[0].convenio_anios\r\n              me.idConvenio         = me.arrayInformation[0].id\r\n              if(me.aniosDivider > 0){\r\n                me.setIdConvenioToHijos()\r\n                me.getConvenios(res.data[0].id)\r\n              }\r\n            }else{\r\n              me.open = true;\r\n              console.log(\"no coincide\")\r\n            }\r\n          }else{\r\n            me.open = true;\r\n          }\r\n      })\r\n      .catch(function (error) {\r\n        me.$vs.loading.close()\r\n        me.$vs.notify({\r\n        text:'Error al cargar los datos',\r\n        color:'danger',\r\n        iconPack: 'feather',\r\n        icon:'icon-check'})\r\n        console.log(error + ' error');\r\n      })\r\n    },\r\n    setIdConvenioToHijos(){\r\n      let me = this;\r\n      const { id_institucion,id_periodo  }  = me.datosInstitucion\r\n      this.$http.get(this.$server_url+`convenio?setIdConvenioToHijos=yes&institucion_id=${id_institucion}&periodo_id=${id_periodo}&idConvenio=${me.idConvenio}`)\r\n        .then(function (res) {\r\n      })\r\n      .catch(function (error) {\r\n          console.log(error + ' error');\r\n      })\r\n    },\r\n    getConvenios(){\r\n      let me = this;\r\n      me.arrayAgreements                  = []\r\n      me.$vs.loading()\r\n      this.$http.get(this.$server_url+`convenio?getConveniosXId=yes&id=${me.idConvenio}`)\r\n        .then(function (res) {\r\n          me.$vs.loading.close()\r\n          let datos = res.data\r\n          if(datos.length > 0){\r\n            me.arrayAgreements    = datos\r\n            //VALOR TOTAL CONTRATOS\r\n            me.arrayAgreements.map(p => {\r\n              me.valuesAgreements = parseFloat(me.valuesAgreements) + parseFloat(p.doc_valor)\r\n            })\r\n          }\r\n      })\r\n      .catch(function (error) {\r\n        me.$vs.loading.close()\r\n        console.log(error + ' error');\r\n      })\r\n    },\r\n    intentAddContrato(){\r\n      let me = this;\r\n      if(me.arrayAgreements.length >= me.aniosDivider){\r\n        me.$vs.notify({\r\n        text:`Ya no puedes crear más contratos por que el convenio es solo ${ me.aniosDivider } años`,\r\n        color:'warning',\r\n        iconPack: 'feather',\r\n        icon:'icon-check'})\r\n        return\r\n      }\r\n      me.idConvenioHijo   = 0;\r\n      me.popupAddContract = true;\r\n    },\r\n    setValuesAgreements(type){\r\n      //type => 0 => actualizar valores a 0 => 1 mostrar valores sugeridos\r\n      let   me = this\r\n      let  count  = 1\r\n      me.arrayAgreements.map((p,index) => {\r\n        //update a 0\r\n        if(type == 0){\r\n          p.valueSuggested = 0\r\n        }\r\n        //values suggested\r\n        else{\r\n          if(count == me.aniosDivider){\r\n            p.valueSuggested = parseFloat(me.arrayInformation[0].anticipo_global / me.arrayInformation[0].convenio_anios)\r\n          }else{\r\n            p.valueSuggested = me.redondearHaciaArriba(parseFloat(me.arrayInformation[0].anticipo_global / me.arrayInformation[0].convenio_anios))\r\n          }\r\n        }\r\n        count++\r\n      })\r\n      //update values suggested\r\n      if(type == 0){ me.updateValuesSuggested() }\r\n    },\r\n    updateValuesSuggested(){\r\n      let me = this;\r\n      let formData = new FormData();\r\n      formData.append('updateValuesSuggested',  'yes')\r\n      formData.append('data_contratos',         JSON.stringify(me.arrayAgreements))\r\n      formData.append('user_created',           me.usuario.idusuario);\r\n      formData.append('idConvenio',             me.idConvenio)\r\n      this.$http.post(this.$server_url+'convenio', formData)\r\n      .then(res => {\r\n        if(res.data.status == 0){\r\n          me.$vs.notify({\r\n          text:res.data.message,\r\n          color:'danger',\r\n          iconPack: 'feather',\r\n          icon:'icon-check'})\r\n          return\r\n        }\r\n        me.showSuggested = false\r\n        me.getDatosConvenio()\r\n        me.$vs.notify({\r\n          text:'Se guardo con éxito',\r\n          color:'success',\r\n          iconPack: 'feather',\r\n          icon:'icon-check'})\r\n      })\r\n      .catch((e)=>{\r\n        // me.$vs.loading.close()\r\n      })\r\n    },\r\n    redondearHaciaArriba(numero) {\r\n      if(numero == 0 || numero == undefined || numero == null){ return 0 }\r\n      return Math.ceil(numero);\r\n    }\r\n  }\r\n}\r\n",{"version":3,"sources":["ScreenConvenio.vue"],"names":[],"mappings":";AA2CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ScreenConvenio.vue","sourceRoot":"src/views/temporadas/components/Pedidos/Configuracion/Convenios","sourcesContent":["<template>\r\n  <div>\r\n    <vx-card title=\"Datos Convenio\">\r\n      <vs-alert color=\"danger\" v-if=\"(arrayAgreements.length > aniosDivider) && arrayInformation.length > 0\"><p class=\"text-center font-bold\">Error: Hay contratos {{ arrayAgreements.length }} y {{ aniosDivider}} años de convenio</p></vs-alert>\r\n      <vs-button v-if=\"arrayInformation.length == 0 && popupAddAgreement == false && open == true\" @click=\"popupAddAgreement = true;\" color=\"primary\" type=\"border\">Crear Convenio</vs-button>\r\n      <vs-button v-if=\"arrayInformation.length == 0 && popupAddAgreement\"          @click=\"popupAddAgreement = false;\" color=\"primary\" type=\"border\">◄ Regresar</vs-button>\r\n      <!--CREAR CONVENIO-->\r\n      <CrearConvenioVue  v-if=\"popupAddAgreement\" :ObjectPedido=\"sendPedido\" :usuario=\"usuario\" :datosInstitucion=\"datosInstitucion\"  :groupFacturador=\"groupFacturador\" @changeRecharge=\"changeRecharge\"/>\r\n      <!--LISTADO INFORMACION CONVENIO-->\r\n      <DatosConveniosVue v-else :idConvenio=\"idConvenio\" :sendPedido=\"sendPedido\" :arrayInformation=\"arrayInformation\" :userRoot=\"userRoot\" :groupFacturador=\"groupFacturador\"  @changeRecharge=\"changeRecharge\" :usuario=\"usuario\"/>\r\n    </vx-card>\r\n    <!--LISTADO DE CONTRATOS DEL CONVENIO-->\r\n    <vx-card :title=\"'Contratos del Convenio #'+idConvenio \" class=\"mt-3\" v-if=\"arrayInformation.length > 0\">\r\n      <div class=\"vx-row ml-1\">\r\n        <p> <vs-chip>CONVENIO GLOBAL:           <b class=\"ml-1\">              {{ setAnticipoGlobal | filterDecimal }}</b></vs-chip></p>\r\n        <p> <vs-chip>TOTAL CONTRATOS:           <b class=\"ml-1\">              {{ valuesAgreements  | filterDecimal }}</b></vs-chip></p>\r\n        <p> <vs-chip>VALOR CONVENIO DISPONIBLE: <b class=\"ml-1 text-success\"> {{ (setAnticipoGlobal - valuesAgreements) | filterDecimal }}</b></vs-chip></p>\r\n      </div>\r\n      <!--LISTADO DE CONTRATOS-->\r\n      <div v-if=\"popupAddContract == false\">\r\n        <div class=\"flex mt-5 justify-center\" >\r\n          <div class=\"flex\" v-if=\"!showSuggested && groupFacturador\">\r\n            <vs-button class=\"p-2\" v-if=\"arrayAgreements.length > 0\" @click=\"intentAddContrato()\" color=\"primary\" type=\"border\" icon-pack=\"feather\" icon=\"icon-plus\">Agregar contrato</vs-button>\r\n            <vs-button v-if=\"arrayAgreements.length > 0\" @click=\"showSuggested = true;setValuesAgreements(1)\" color=\"#3CA7E5\" class=\"ml-3 p-2\" type=\"filled\" icon-pack=\"feather\" icon=\"icon-eye\">Mostrar valores sugeridos</vs-button>\r\n          </div>\r\n        </div>\r\n        <ListadoConveniosVue  :idConvenio=\"idConvenio\" :arrayAgreements=\"arrayAgreements\" :groupFacturador=\"groupFacturador\" @changeRecharge=\"changeRecharge\" :showSuggested=\"showSuggested\" :setAnticipoGlobal=\"setAnticipoGlobal\" :usuario=\"usuario\"  :datosInstitucion=\"datosInstitucion\" class=\"mt-5\"/>\r\n        <div v-if=\"showSuggested\">\r\n          <div class=\"flex justify-center mt-5\">\r\n            <vs-button class=\"mr-3 mb-2\" icon=\"check\" @click=\"updateValuesSuggested()\">Aplicar valores sugeridos</vs-button>\r\n            <vs-button color=\"warning\" type=\"border\" icon-pack=\"feather\" icon=\"icon-x\" class=\"mb-2\" @click=\"showSuggested = false;\">Cancelar</vs-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <!--MODALES-->\r\n      <!--MODAL PARA CREAR-->\r\n      <div v-if=\"popupAddContract\" class=\"mt-5\">\r\n        <CrearContratoConvenioVue @changeRecharge=\"getDatosConvenio\" :idConvenio=\"idConvenio\" :idConvenioHijo=\"idConvenioHijo\" :agreementSonObject=\"agreementSonObject\" :arrayContracts=\"arrayContracts\" :arrayInformation=\"arrayInformation\" :usuario=\"usuario\"/>\r\n      </div>\r\n    </vx-card>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {\r\n    mapState,\r\n    mapActions\r\n} from 'vuex'\r\nimport PedidosRepository from '../../../../../../repositories/PedidosRepository'\r\nconst ListadoConveniosVue           = () => import('./ListadoConvenios.vue')\r\nconst DatosConveniosVue             = () => import('./DatosConvenios')\r\nconst CrearContratoConvenioVue      = () => import('./CrearContratoConvenio')\r\nconst CrearConvenioVue              = () => import('./CrearConvenio.vue')\r\nexport default {\r\n  components:{\r\n    ListadoConveniosVue,\r\n    DatosConveniosVue,\r\n    CrearContratoConvenioVue,\r\n    CrearConvenioVue,\r\n  },\r\n  data() {\r\n    return{\r\n      usuario:[],\r\n      id_pedido:0,\r\n      arrayInformation:[],\r\n      arrayAgreements:[],\r\n      arrayContracts:[],\r\n      sendPedido:'',\r\n      setAnticipoGlobal:0,\r\n      aniosDivider:0,\r\n      valuesAgreements:0,\r\n      showSuggested:false,\r\n      idConvenio:0,\r\n      popupAddAgreement:false,\r\n      //variables for contract\r\n      popupAddContract:false,\r\n      idConvenioHijo:0,\r\n      agreementSonObject:'',\r\n      //end variables for contract\r\n      open:false,\r\n      datosInstitucion:'',\r\n    }\r\n  },\r\n  computed:{\r\n      ...mapState(['pedidoId','userRoot','groupFacturador','ObjectPedido']),\r\n  },\r\n  created(){\r\n    let me = this;\r\n    me.usuario = JSON.parse(localStorage.getItem(\"usuario\"))\r\n  },\r\n  mounted(){\r\n    let me = this\r\n    me.id_pedido          = me.ObjectPedido.id_pedido\r\n    me.sendPedido         = me.ObjectPedido\r\n    me.datosInstitucion   = me.ObjectPedido\r\n    me.getDatosConvenio()\r\n    me.getContratos()\r\n  },\r\n  methods:{\r\n    getPedido(){\r\n      let me = this\r\n      me.sendPedido = []\r\n      PedidosRepository.getPedidoXID(me.id_pedido).then(r => { me.sendPedido = r.data[0]; })\r\n    },\r\n    changeRecharge(e,tr){\r\n      let me = this\r\n      me.arrayAgreements = []\r\n      //cancel\r\n      if(e == 0){ me.popupAddContract = true; }\r\n      if(e == 1){\r\n        me.getPedido()\r\n        me.getDatosConvenio()\r\n        let datos = {\r\n          \"tipo\"                            :8,\r\n        }\r\n        me.$emit('recharge',datos)\r\n      }\r\n      //crud\r\n      if(e == 2){\r\n        me.popupAddContract   = true\r\n        me.idConvenioHijo     = tr.doc_codigo\r\n        me.agreementSonObject = tr\r\n      }\r\n      //resete values\r\n      if(e == 3) {\r\n        me.getPedido()\r\n        me.getDatosConvenio()\r\n        me.setValuesAgreements(0)\r\n          let datos = {\r\n          \"tipo\"                            :8,\r\n        }\r\n        me.$emit('recharge',datos)\r\n      }\r\n    },\r\n    getContratos(){\r\n      let me = this;\r\n      me.arrayContracts                  = []\r\n      const { id_institucion,id_periodo  }  = me.ObjectPedido\r\n      this.$http.get(this.$server_url+`convenio?allContratoXInstitucion=yes&institucion_id=${id_institucion}`)\r\n        .then(function (res) {\r\n          me.arrayContracts = res.data\r\n      })\r\n      .catch(function (error) {\r\n          console.log(error + ' error');\r\n      })\r\n    },\r\n    getDatosConvenio() {\r\n      let me = this;\r\n      me.arrayAgreements                   = []\r\n      me.arrayInformation                  = []\r\n      me.aniosDivider                      = 0\r\n      me.valuesAgreements                  = 0\r\n      me.showSuggested                     = false\r\n      me.popupAddContract                  = false\r\n      me.popupAddAgreement                 = false\r\n      me.tooContracts                      = false\r\n      const { id_institucion,id_periodo  }  = me.datosInstitucion\r\n      me.$vs.loading()\r\n      this.$http.get(this.$server_url+`convenio?AllConvenios=yes&institucion_id=${id_institucion}`)\r\n        .then(function (res) {\r\n          me.$vs.loading.close()\r\n          let datos = res.data\r\n          console.log(\"eee\",datos)\r\n          if(datos.length > 0){\r\n            me.arrayInformation   = datos.filter(p => p.periodo_id == id_periodo || p.id == me.sendPedido.pedidos_convenios_id)\r\n            if(me.arrayInformation.length > 0){\r\n              me.open = false;\r\n              console.log(\"coincide\")\r\n              // me.arrayInformation   = datos\r\n              me.setAnticipoGlobal  = me.arrayInformation[0].anticipo_global\r\n              me.aniosDivider       = me.arrayInformation[0].convenio_anios\r\n              me.idConvenio         = me.arrayInformation[0].id\r\n              if(me.aniosDivider > 0){\r\n                me.setIdConvenioToHijos()\r\n                me.getConvenios(res.data[0].id)\r\n              }\r\n            }else{\r\n              me.open = true;\r\n              console.log(\"no coincide\")\r\n            }\r\n          }else{\r\n            me.open = true;\r\n          }\r\n      })\r\n      .catch(function (error) {\r\n        me.$vs.loading.close()\r\n        me.$vs.notify({\r\n        text:'Error al cargar los datos',\r\n        color:'danger',\r\n        iconPack: 'feather',\r\n        icon:'icon-check'})\r\n        console.log(error + ' error');\r\n      })\r\n    },\r\n    setIdConvenioToHijos(){\r\n      let me = this;\r\n      const { id_institucion,id_periodo  }  = me.datosInstitucion\r\n      this.$http.get(this.$server_url+`convenio?setIdConvenioToHijos=yes&institucion_id=${id_institucion}&periodo_id=${id_periodo}&idConvenio=${me.idConvenio}`)\r\n        .then(function (res) {\r\n      })\r\n      .catch(function (error) {\r\n          console.log(error + ' error');\r\n      })\r\n    },\r\n    getConvenios(){\r\n      let me = this;\r\n      me.arrayAgreements                  = []\r\n      me.$vs.loading()\r\n      this.$http.get(this.$server_url+`convenio?getConveniosXId=yes&id=${me.idConvenio}`)\r\n        .then(function (res) {\r\n          me.$vs.loading.close()\r\n          let datos = res.data\r\n          if(datos.length > 0){\r\n            me.arrayAgreements    = datos\r\n            //VALOR TOTAL CONTRATOS\r\n            me.arrayAgreements.map(p => {\r\n              me.valuesAgreements = parseFloat(me.valuesAgreements) + parseFloat(p.doc_valor)\r\n            })\r\n          }\r\n      })\r\n      .catch(function (error) {\r\n        me.$vs.loading.close()\r\n        console.log(error + ' error');\r\n      })\r\n    },\r\n    intentAddContrato(){\r\n      let me = this;\r\n      if(me.arrayAgreements.length >= me.aniosDivider){\r\n        me.$vs.notify({\r\n        text:`Ya no puedes crear más contratos por que el convenio es solo ${ me.aniosDivider } años`,\r\n        color:'warning',\r\n        iconPack: 'feather',\r\n        icon:'icon-check'})\r\n        return\r\n      }\r\n      me.idConvenioHijo   = 0;\r\n      me.popupAddContract = true;\r\n    },\r\n    setValuesAgreements(type){\r\n      //type => 0 => actualizar valores a 0 => 1 mostrar valores sugeridos\r\n      let   me = this\r\n      let  count  = 1\r\n      me.arrayAgreements.map((p,index) => {\r\n        //update a 0\r\n        if(type == 0){\r\n          p.valueSuggested = 0\r\n        }\r\n        //values suggested\r\n        else{\r\n          if(count == me.aniosDivider){\r\n            p.valueSuggested = parseFloat(me.arrayInformation[0].anticipo_global / me.arrayInformation[0].convenio_anios)\r\n          }else{\r\n            p.valueSuggested = me.redondearHaciaArriba(parseFloat(me.arrayInformation[0].anticipo_global / me.arrayInformation[0].convenio_anios))\r\n          }\r\n        }\r\n        count++\r\n      })\r\n      //update values suggested\r\n      if(type == 0){ me.updateValuesSuggested() }\r\n    },\r\n    updateValuesSuggested(){\r\n      let me = this;\r\n      let formData = new FormData();\r\n      formData.append('updateValuesSuggested',  'yes')\r\n      formData.append('data_contratos',         JSON.stringify(me.arrayAgreements))\r\n      formData.append('user_created',           me.usuario.idusuario);\r\n      formData.append('idConvenio',             me.idConvenio)\r\n      this.$http.post(this.$server_url+'convenio', formData)\r\n      .then(res => {\r\n        if(res.data.status == 0){\r\n          me.$vs.notify({\r\n          text:res.data.message,\r\n          color:'danger',\r\n          iconPack: 'feather',\r\n          icon:'icon-check'})\r\n          return\r\n        }\r\n        me.showSuggested = false\r\n        me.getDatosConvenio()\r\n        me.$vs.notify({\r\n          text:'Se guardo con éxito',\r\n          color:'success',\r\n          iconPack: 'feather',\r\n          icon:'icon-check'})\r\n      })\r\n      .catch((e)=>{\r\n        // me.$vs.loading.close()\r\n      })\r\n    },\r\n    redondearHaciaArriba(numero) {\r\n      if(numero == 0 || numero == undefined || numero == null){ return 0 }\r\n      return Math.ceil(numero);\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}