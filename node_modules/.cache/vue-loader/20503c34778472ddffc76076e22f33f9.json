{"remainingRequest":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\pedidos\\registrar_beneficiarios.vue?vue&type=style&index=0&id=77539c3c&scoped=true&lang=css","dependencies":[{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\pedidos\\registrar_beneficiarios.vue","mtime":1712682816371},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\n.features {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n.features li {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n}\r\n.features li + * {\r\n  margin-top: 0.75rem;\r\n}\r\n.features .icon {\r\n  background-color: #1FCAC5;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: #fff;\r\n  border-radius: 50%;\r\n  width: 20px;\r\n  height: 20px;\r\n}\r\n.features .icon svg {\r\n  width: 14px;\r\n  height: 14px;\r\n}\r\n.features + * {\r\n  margin-top: 1.25rem;\r\n}\r\n\r\n",{"version":3,"sources":["registrar_beneficiarios.vue"],"names":[],"mappings":";AA6uBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"registrar_beneficiarios.vue","sourceRoot":"src/views/pedidos","sourcesContent":["<template>\r\n<div>\r\n    <!-- modal responables -->\r\n    <vs-prompt title=\"Responsable\" @close=\"getResponsables(); popupBeneficiario=true\" buttons-hidden :active.sync=\"modalResponsable\">\r\n        <registrarResponsable/>\r\n    </vs-prompt>\r\n    <!-- FIN modal responables -->\r\n    <vs-popup title=\"Registrar Beneficiarios\" fullscreen :active.sync=\"popupBeneficiario\">\r\n      <div class=\"vx-row w-full mb-6\">\r\n        <!-- responsable - datos facturacion -->\r\n        <div class=\"vx-col w-full mb-3\" v-if=\"editar == false\">\r\n            <div class=\"w-full flex flex-wrap gap-1 items-center\">\r\n              <vs-input icon=\"search\" class=\"w-full mt-5\" @keyup.enter=\"getResponsables()\" label-placeholder=\"Filtre por cedula\" v-model=\"filtroCedula\"/>\r\n              <!-- <small class=\"mt-2\" v-if=\"ifCrearBeneficiario\"><span class=\"text-warning\">El usuario no existe.</span> <span style=\"text-decoration: underline;cursor: pointer;\" @click=\"ir_crea_responsable\" class=\"text-primary\"> Crear beneficiario</span></small> -->\r\n              <vs-chip color=\"danger\" class=\"mt-2\" v-if=\"ifCrearBeneficiario\"><span>El usuario no existe, complete el siguiente formulario.</span></vs-chip>\r\n            </div>\r\n        </div>\r\n        <div class=\"w-full\" v-if=\"responsables.length > 0\">\r\n            <vs-divider>Seleccione el beneficiario</vs-divider>\r\n            <vs-table max-items=\"5\" search pagination :data=\"responsables\">\r\n                <template slot=\"thead\">\r\n                    <vs-th>Nombres</vs-th>\r\n                    <vs-th>Cedula</vs-th>\r\n                    <vs-th>Perfil</vs-th>\r\n                    <vs-th>Acciones</vs-th>\r\n                </template>\r\n                <template slot-scope=\"{data}\">\r\n                    <vs-tr :key=\"indextr\" v-for=\"(tr, indextr) in data\">\r\n                        <vs-td>\r\n                            {{data[indextr].nombres_responsable}}<br>\r\n                        </vs-td>\r\n                        <vs-td>\r\n                            {{data[indextr].cedula}}<br>\r\n                        </vs-td>\r\n                        <vs-td>\r\n                          {{data[indextr].rol}}<br>\r\n                        </vs-td>\r\n                        <vs-td>\r\n                            <div style=\"display: flex;\">\r\n                                <div>\r\n                                    <vx-tooltip style=\"display: inline-block;\" text=\"Asignar beneficiario\" position=\"top\" color=\"primary\">\r\n                                        <vs-button class=\"modal-default-button\" size=\"small\" color=\"success\" type=\"filled\" @click=\"selectBeneficiario(tr)\" icon-pack=\"feather\" icon=\"icon-check\"> </vs-button>\r\n                                    </vx-tooltip> &nbsp;\r\n                                </div>\r\n                            </div>\r\n                        </vs-td>\r\n                    </vs-tr>\r\n                </template>\r\n            </vs-table>\r\n        </div>\r\n        <template v-if=\"ifCrearBeneficiario && responsables.length == 0\">\r\n            <!--REGISTRAR NUEVO USUARIO-->\r\n            <vs-divider>Registrar nuevo beneficiario</vs-divider>\r\n            <div class=\"vx-col w-1/2 mb-3\">\r\n                <span class=\"text-danger\" style=\"font-size: 12px;\">(obligatorio)</span>\r\n                <vs-input label=\"Registre la cédula\" v-model=\"beneficiario.num_identificacion\" class=\"w-full\" />\r\n            </div>\r\n            <div class=\"vx-col w-1/2 mb-3\">\r\n                <span class=\"text-danger\" style=\"font-size: 12px;\">(obligatorio)</span>\r\n                <vs-input label=\"Nombres\" v-model=\"beneficiario.nombres\" class=\"w-full\" />\r\n            </div>\r\n            <div class=\"vx-col w-1/2 mb-3\">\r\n                <span class=\"text-danger\" style=\"font-size: 12px;\">(obligatorio)</span>\r\n                <vs-input label=\"Apellidos\" v-model=\"beneficiario.apellidos\" class=\"w-full\" />\r\n            </div>\r\n            <div class=\"vx-col w-1/2 mb-3\">\r\n                <span class=\"text-danger\" style=\"font-size: 12px;\">(obligatorio)</span>\r\n                <vs-input label=\"Correo\"  v-model=\"beneficiario.correo\" class=\"w-full\" />\r\n            </div>\r\n            <div class=\"vx-col w-1/2 mb-3\">\r\n                <span class=\"text-danger\" style=\"font-size: 12px;\">(obligatorio)</span>\r\n                <vs-input label=\"Teléfono\" v-model=\"beneficiario.telefono\" class=\"w-full\" />\r\n            </div>\r\n            <vs-divider></vs-divider>\r\n        </template>\r\n        <!--FIN DE REGISTRAR USUARIO-->\r\n        <!--DATOS-->\r\n        <div class=\"vx-col w-1/2 mb-3\" v-if=\"ifCrearBeneficiario == false && responsables.length == 0\" >\r\n            <vs-input label=\"Nombres\" v-model=\"beneficiario.nombres\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col w-1/2 mb-3\" v-if=\"ifCrearBeneficiario == false && responsables.length == 0\" >\r\n            <vs-input label=\"Apelidos\" v-model=\"beneficiario.apellidos\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col w-1/2 mb-3\" v-if=\"responsables.length == 0\">\r\n            <div class=\"label_inputs\" >Tipo identificación</div>\r\n            <v-select :options=\"tipos_identificacion\" v-model=\"beneficiario.tipo_identificacion\" :dir=\"$vs.rtl ? 'rtl' : 'ltr'\" />\r\n        </div>\r\n        <div class=\"vx-col w-1/2 mb-3\" v-if=\"ifCrearBeneficiario == false && responsables.length == 0\" >\r\n            <vs-input label=\"Correo\" v-model=\"beneficiario.correo\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col w-1/2 mb-3\"  v-if=\"ifCrearBeneficiario == false && responsables.length == 0\">\r\n            <vs-input label=\"Número de identificación\" readonly=\"true\" v-model=\"beneficiario.num_identificacion\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col w-1/2 mb-3\" v-if=\"responsables.length == 0\">\r\n            <vs-input label=\"Dirección\" v-model=\"beneficiario.direccion\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col w-1/2 mb-3\" v-if=\"responsables.length == 0\">\r\n          <vs-input type=\"number\" label=\"Comisión %\" v-model=\"beneficiario.comision\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col w-1/2 mb-3\" v-if=\"responsables.length == 0\">\r\n            <vs-input label=\"Banco(Opcional)\" v-model=\"beneficiario.banco\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col w-1/2 mb-3\" v-if=\"responsables.length == 0\">\r\n            <div class=\"label_inputs\">Tipo de cuenta(Opcional)</div>\r\n            <v-select :options=\"['Ahorros','Corriente']\" v-model=\"beneficiario.tipo_cuenta\" class=\"w-full\" :dir=\"$vs.rtl ? 'rtl' : 'ltr'\" />\r\n        </div>\r\n        <div class=\"vx-col w-1/2 mb-3\" v-if=\"responsables.length == 0\">\r\n            <vs-input type=\"text\" label=\"Número de cuenta(Opcional)\" v-model=\"beneficiario.num_cuenta\" class=\"w-full\" />\r\n        </div>\r\n        <div class=\"vx-col w-full mb-3\" v-if=\"responsables.length == 0\">\r\n            <vs-textarea label=\"Observacion\" v-model=\"beneficiario.observacion\" class=\"w-full\" />\r\n        </div>\r\n        </div>\r\n        <div class=\"w-full\" align=\"center\" v-if=\"responsables.length == 0\">\r\n            <vs-button color=\"success\" type=\"gradient\" @click=\"saveBeneficario()\">Guardar</vs-button>\r\n        </div>\r\n    </vs-popup>\r\n    <!--FIN MODAL-->\r\n    <br>\r\n    <div v-if=\"tipo == 3\">\r\n      <vs-alert title=\"Advertencia\" color=\"danger\" active=\"true\">\r\n        <p>Los valores de comisiones para los beneficiarios no es la correcta</p>\r\n      </vs-alert>\r\n    </div>\r\n    <div class=\"w-full mb-4\">\r\n      <vs-table search :data=\"arregloPorcentajes\">\r\n        <template slot=\"header\">\r\n          <h5>Listado de beneficiarios  / <span style=\"font-size=12px;font-weight: bold;\">cantidad: {{arregloPorcentajes.length}}</span></h5>\r\n          <vs-button class=\"px-3 py-2 ml-3\" color=\"dark\" type=\"gradient\" @click=\"responsables = [];setInstitucion();ifCrearBeneficiario = false;editar = false; id_beneficiario=0; beneficiario= { responsable: '', tipo_identificacion: '', num_identificacion: '', direccion: '', correo: '', comision: '', banco: '', tipo_cuenta: '', num_cuenta: '', telefono: '', observacion: '', nombres:'',apellidos:'',telefono:''};  popupBeneficiario=true\" v-if=\"(usuario_creador.id_group == 11 || usuario_creador.id_group == 22  || usuario_creador.id_group == 23) && detalles == 0 && desdeVerificacion == '0'\">Agregar beneficiario</vs-button>\r\n        </template>\r\n        <template slot=\"thead\">\r\n          <vs-th>#</vs-th>\r\n          <vs-th sort-key=\"nombres_beneficiario\">Beneficiario</vs-th>\r\n          <vs-th sort-key=\"comision\">Comisión</vs-th>\r\n          <vs-th v-if=\"desdeVerificacion == '0' || desdeVerificacion == '2'\" sort-key=\"comision\">Porcentajes VENTA BRUTA</vs-th>\r\n          <vs-th sort-key=\"comision\" v-if=\"ventaReal > 0\">Porcentajes VENTA REAL </vs-th>\r\n          <vs-th sort-key=\"banco\">Banco</vs-th>\r\n          <vs-th style=\"width: 250px;\" v-if=\"(usuario_creador.id_group == 11 || userRoot) && desdeVerificacion == '0' \">Acciones</vs-th>\r\n        </template>\r\n        <template slot-scope=\"{data}\">\r\n          <vs-tr :key=\"indextr\" v-for=\"(tr, indextr) in data\">\r\n            <vs-td>{{ indextr+1 }}</vs-td>\r\n            <vs-td>\r\n              <b class=\"font-bold\">Beneficiario:</b>\r\n              <p>{{ tr.beneficiario }} </p>\r\n              <b class=\"font-bold\">Cédula:</b>\r\n              <p>{{ tr.cedula }} </p>\r\n              <b>Correo:</b>\r\n              <p>{{ tr.correo }} </p>\r\n              <p class=\"mt-1\">\r\n                <vs-chip v-if=\"tr.id_usuario == pedido.id_responsable\">Principal</vs-chip>\r\n              </p>\r\n            </vs-td>\r\n            <vs-td>{{ tr.comision }} </vs-td>\r\n            <!--PORCENTAJE VENTA BRUTA-->\r\n            <vs-td v-if=\"desdeVerificacion == '0' || desdeVerificacion == '2'\">\r\n              <div class=\"vx-col w-full sm:w-full md:w-full lg:w-full xl:w-full mb-6\">\r\n                <ul class=\"features\">\r\n                  <li v-if=\"userRoot || usuario_creador.idusuario == 68990\">\r\n                    <span class=\"icon\">\r\n                      <svg height=\"24\" width=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <path d=\"M0 0h24v24H0z\" fill=\"none\"></path>\r\n                        <path fill=\"currentColor\" d=\"M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414z\"></path>\r\n                      </svg>\r\n                    </span>\r\n                    <span><strong>Porcentaje:</strong> <span class=\"font-semibold\"> {{ tr.porcentaje.toFixed(2) }}%</span> </span>\r\n                  </li>\r\n                  <li>\r\n                    <span class=\"icon\">\r\n                      <svg height=\"24\" width=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <path d=\"M0 0h24v24H0z\" fill=\"none\"></path>\r\n                        <path fill=\"currentColor\" d=\"M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414z\"></path>\r\n                      </svg>\r\n                    </span>\r\n                    <span><strong>comisión Venta Bruta:</strong> <span class=\"font-semibold\"> ${{ filtrarDecimal(tr.valorPorcentaje) }}</span> </span>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </vs-td>\r\n            <!--PORCENTAJES REALES-->\r\n            <vs-td v-if=\"ventaReal > 0\">\r\n              <div class=\"vx-col w-full sm:w-full md:w-full lg:w-full xl:w-full mb-6\">\r\n                <ul class=\"features\">\r\n                  <li v-if=\"userRoot || usuario_creador.idusuario == 68990\">\r\n                    <span class=\"icon\">\r\n                      <svg height=\"24\" width=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <path d=\"M0 0h24v24H0z\" fill=\"none\"></path>\r\n                        <path fill=\"currentColor\" d=\"M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414z\"></path>\r\n                      </svg>\r\n                    </span>\r\n                    <span><strong>Porcentaje:</strong> <span class=\"font-semibold\"> {{ tr.porcentajeReal.toFixed(2) }}%</span></span>\r\n                  </li>\r\n                  <li>\r\n                    <span class=\"icon\">\r\n                      <svg height=\"24\" width=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <path d=\"M0 0h24v24H0z\" fill=\"none\"></path>\r\n                        <path fill=\"currentColor\" d=\"M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414z\"></path>\r\n                      </svg>\r\n                    </span>\r\n                    <span><strong>comisión Venta Real:</strong> <span class=\"font-semibold\"> ${{ filtrarDecimal(tr.valorPorcentajeReal) }}</span></span>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </vs-td>\r\n            <vs-td>\r\n              <b>Banco:</b>\r\n              <p>{{ tr.banco }} </p>\r\n              <b>Número de cuenta:</b>\r\n              <p>{{ tr.num_cuenta }} </p>\r\n              <b>Tipo de cuenta:</b>\r\n              <p>{{ tr.tipo_cuenta }} </p>\r\n            </vs-td>\r\n            <vs-td align=\"center\" v-if=\"(usuario_creador.id_group == 11 || userRoot) && desdeVerificacion == '0'\">\r\n              <vs-button color=\"success\" type=\"gradient\" size=\"small\" class=\"m-1\" @click=\"setInstitucion();editar=true; openEditBeneficiario(tr)\" v-if=\"detalles == 0\">Editar</vs-button>\r\n              <vs-button color=\"danger\"  type=\"gradient\" size=\"small\" class=\"m-1\" @click=\"eliminar_beneficiario(tr)\" v-if=\"detalles == 0\">Eliminar</vs-button>\r\n              <vs-button color=\"primary\" v-if=\"( tr.id_usuario != pedido.id_responsable)\"  type=\"gradient\" size=\"small\" class=\"m-1\" @click=\"asignarComoPrincipal(tr)\" >Asignar como principal</vs-button>\r\n            </vs-td>\r\n          </vs-tr>\r\n        </template>\r\n      </vs-table>\r\n    </div>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport vSelect from 'vue-select'\r\nimport 'vue-select/dist/vue-select.css';\r\nimport Vue from 'vue'\r\nimport axios from 'axios'\r\nimport registrarResponsable from './registrar_responsable.vue'\r\nVue.use(axios)\r\nexport default {\r\n    components: {\r\n        'v-select': vSelect,\r\n        registrarResponsable\r\n    },\r\n    props:{\r\n      detalles:{\r\n        type:Number,\r\n        default:0,\r\n      },\r\n      pedido_idBusqueda:{\r\n        type:Number,\r\n        default:0,\r\n      },\r\n      pedido:{\r\n        type:Object,\r\n        default:{},\r\n      },\r\n      desdeVerificacion:{\r\n        type:Number,\r\n        default:0,\r\n      },\r\n      VerificacionSelect:{\r\n        type:Object,\r\n        default:function(){\r\n          return {}\r\n        }\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        usuario:[],\r\n        responsables: [],\r\n        beneficiarios: [],\r\n        beneficiario: { responsable: '', tipo_identificacion: '', num_identificacion: '', direccion: '', correo: '', comision: '', banco: '', tipo_cuenta: '', num_cuenta: '', telefono: '', observacion: '',nombres:'',apellidos:'',telefono:''},\r\n        tipos_identificacion: [ 'CI', 'RUC', 'PAS', ],\r\n        id_pedido: '',\r\n        id_asesor_pedido: '',\r\n        id_beneficiario: '',\r\n        id_institucion: '',\r\n        popupBeneficiario: false,\r\n        modalResponsable: false,\r\n        usuario_creador: [],\r\n        filtroCedula:'',\r\n        arregloResponsables:[],\r\n        ifCrearBeneficiario:false,\r\n        editar:false,\r\n        userRoot:false,\r\n        //variables para calculo de porcentajes\r\n        arregloPorcentajes:[],\r\n        ventaBruta:0,\r\n        valorComision:0,\r\n        ventaReal:0,\r\n        valorComisionReal:0,\r\n        comision:0,\r\n        tipo:0,\r\n      }\r\n    },\r\n    watch:{\r\n        filtroCedula(results){\r\n            let me = this;\r\n            if(me.filtroCedula.length > 5){\r\n                setTimeout(function() {me.getResponsables()}, 500);\r\n            }else{\r\n                me.beneficiario.num_identificacion  = '';\r\n                me.beneficiario.correo              = '';\r\n            }\r\n        },\r\n    },\r\n    created() {\r\n    },\r\n    mounted() {\r\n        let me = this;\r\n        me.usuario_creador = JSON.parse(localStorage.getItem('usuario'));\r\n       // me.id_institucion = localStorage.institucion_selected_pedido\r\n        me.id_asesor_pedido = localStorage.id_asesor_pedido\r\n        me.id_pedido        = me.pedido.id_pedido\r\n        // me.getResponsables()\r\n        me.getBeneficiarios()\r\n        me.getUserRoot(me.usuario_creador);\r\n    },\r\n    methods: {\r\n        getUserRoot(dato) {\r\n          let me = this;\r\n          this.$http.get(this.$server_url + 'permisos/' + dato.idusuario)\r\n            .then((result) => {\r\n              if (result.data.length > 0) {\r\n                me.userRoot = true;\r\n              }\r\n            })\r\n            .catch((err) => {\r\n              console.log(err)\r\n            })\r\n        },\r\n        asignarComoPrincipal(tr){\r\n            let me = this;\r\n            let formData = new FormData();\r\n            formData.append('id_pedido',     tr.id_pedido);\r\n            formData.append('id_responsable',tr.id_usuario);\r\n            me.$vs.loading()\r\n            this.$http.post(this.$server_url+'asignarBeneficiarioPrincipal', formData)\r\n            .then(res => {\r\n            me.pedido.id_responsable = res.data\r\n            me.$vs.loading.close()\r\n            me.$vs.notify({\r\n              text:'Se asigno correctamente',\r\n              color:'success',\r\n              iconPack: 'feather',\r\n              icon:'icon-check'})\r\n            })\r\n            me.$emit('rechargePedido',true)\r\n            .catch((e)=>{\r\n                me.$vs.loading.close()\r\n            })\r\n        },\r\n        openEditBeneficiario(tr){\r\n            let me = this;\r\n            me.id_beneficiario                  = tr.id_beneficiario_pedido\r\n            me.beneficiario.idusuario           = tr.id_usuario\r\n            me.beneficiario.num_identificacion  = tr.cedula\r\n            me.beneficiario.tipo_identificacion = tr.tipo_identificacion\r\n            me.beneficiario.direccion           = tr.direccion\r\n            me.beneficiario.correo              = tr.correo\r\n            me.beneficiario.comision            = tr.comision\r\n            me.beneficiario.banco               = tr.banco\r\n            me.beneficiario.tipo_cuenta         = tr.tipo_cuenta\r\n            me.beneficiario.num_cuenta          = tr.num_cuenta\r\n            me.beneficiario.observacion         = tr.observacion\r\n            me.beneficiario.nombres             = tr.nombres\r\n            me.beneficiario.apellidos           = tr.apellidos\r\n            me.popupBeneficiario = true;\r\n        },\r\n        selectBeneficiario(tr){\r\n          let me = this;\r\n          me.beneficiario.num_identificacion  = tr.cedula;\r\n          me.beneficiario.correo              = tr.email;\r\n          me.beneficiario.idusuario           = tr.idusuario\r\n          me.beneficiario.nombres             = tr.nombres\r\n          me.beneficiario.apellidos           = tr.apellidos\r\n          me.beneficiario.telefono            = tr.telefono\r\n          me.responsables = []\r\n        },\r\n        getResponsables(){\r\n            let me = this\r\n            if(me.filtroCedula.length < 5){\r\n              me.$vs.notify({\r\n              text:'Minimo 5 caracteres para la búsqueda',\r\n              color:'warning',\r\n              iconPack: 'feather',\r\n              icon:'icon-check'})\r\n              return;\r\n            }\r\n            this.$http.get(this.$server_url+'get_responsables_pedidos?cedula='+me.filtroCedula)\r\n            .then(res => {\r\n                me.responsables = res.data\r\n                if(me.responsables.length == 0){\r\n                  me.ifCrearBeneficiario = true;\r\n                  me.beneficiario.num_identificacion = me.filtroCedula\r\n                }else{\r\n                  me.ifCrearBeneficiario = false\r\n                }\r\n            })\r\n        },\r\n        getBeneficiarios(){\r\n          let me = this\r\n          me.beneficiarios = []\r\n          me.arregloPorcentajes = []\r\n          var pedidoId = 0;\r\n          if(me.detalles == 1){\r\n              pedidoId = me.pedido_idBusqueda\r\n          }else{\r\n              pedidoId = me.pedido.id_pedido\r\n          }\r\n          var url = \"\"\r\n          //tipoUrl => 0 => VENTA REAL GENERAL; 1 => VENTA REAL POR VERIFICACION\r\n          if(me.desdeVerificacion == '0' || me.desdeVerificacion == '2') {\r\n            url = this.$server_url+'getBeneficiarios/'+pedidoId+'/0/0'\r\n          }else{\r\n            url = this.$server_url+'getBeneficiarios/'+pedidoId+'/1/'+me.VerificacionSelect.id\r\n          }\r\n          this.$http.get(url)\r\n          // this.$http.get(this.$server_url+'get_beneficiarios_pedidos/'+pedidoId)\r\n          .then(res => {\r\n            if(res.data.status == 0){\r\n              me.$vs.notify({\r\n                text: res.data.message,\r\n                color: 'danger',\r\n                iconPack: 'feather',\r\n                icon: 'icon-alert-triangle',\r\n                time:5000,\r\n              })\r\n              return\r\n            }\r\n            me.beneficiarios        = res.data\r\n            if(me.beneficiarios.length > 0){\r\n              let totalAlcances     = me.beneficiarios[0].total_alcances\r\n              me.comision           = me.beneficiarios[0].descuento\r\n              me.ventaBruta         = me.beneficiarios[0].total_venta + totalAlcances\r\n              me.ventaReal          = me.beneficiarios[0].ventaReal\r\n              me.valorComisionReal  = me.beneficiarios[0].valorComisionReal\r\n              me.valorComision      = (me.ventaBruta * me.comision) / 100\r\n              me.renderPorcentajes()\r\n            }\r\n            // me.popupBeneficiario = false\r\n            me.ifCrearBeneficiario  = false\r\n          })\r\n        },\r\n        renderPorcentajes(){\r\n          let me = this;\r\n          me.tipo = me.getTipo()\r\n          console.log(\"tipo\",me.tipo)\r\n          //si es igual a comision 40% por ejemplo\r\n          if(me.tipo == 1){\r\n            me.beneficiarios.forEach(element => {\r\n              var cal = new Object();\r\n              cal.beneficiario            = element.beneficiario\r\n              cal.nombres                 = element.nombres\r\n              cal.apellidos               = element.apellidos\r\n              cal.cedula                  = element.cedula\r\n              cal.id_beneficiario_pedido  = element.id_beneficiario_pedido\r\n              cal.id_pedido               = element.id_pedido\r\n              cal.id_usuario              = element.id_usuario\r\n              cal.cod_usuario             = element.cod_usuario\r\n              cal.tipo_identificacion     = element.tipo_identificacion\r\n              cal.direccion               = element.direccion\r\n              cal.correo                  = element.correo\r\n              cal.comision                = element.comision\r\n              cal.valor                   = element.valor\r\n              cal.banco                   = element.banco\r\n              cal.tipo_cuenta             = element.tipo_cuenta\r\n              cal.num_cuenta              = element.num_cuenta\r\n              cal.observacion             = element.observacion\r\n              cal.porcentaje              = ((element.comision * 100)/ me.comision)\r\n              let prePorcentaje           =  ((element.comision * 100)/ me.comision)\r\n              cal.porcentajeReal          = ((element.comision * 100)/ element.comisionReal)\r\n              let prePorcentajeReal       = ((element.comision * 100)/ element.comisionReal)\r\n              cal.valorPorcentaje         = (me.valorComision * prePorcentaje) / 100\r\n              cal.valorPorcentajeReal     = (element.valorComisionReal * prePorcentajeReal) / 100\r\n              me.arregloPorcentajes.push(cal)\r\n            })\r\n          }\r\n          //si es igual al 100%\r\n          if(me.tipo == 2){\r\n            me.beneficiarios.forEach(element => {\r\n              var cal = new Object();\r\n              cal.beneficiario            = element.beneficiario\r\n              cal.cedula                  = element.cedula\r\n              cal.nombres                 = element.nombres\r\n              cal.apellidos               = element.apellidos\r\n              cal.id_beneficiario_pedido  = element.id_beneficiario_pedido\r\n              cal.id_pedido               = element.id_pedido\r\n              cal.id_usuario              = element.id_usuario\r\n              cal.cod_usuario             = element.cod_usuario\r\n              cal.tipo_identificacion     = element.tipo_identificacion\r\n              cal.direccion               = element.direccion\r\n              cal.correo                  = element.correo\r\n              cal.comision                = element.comision\r\n              cal.valor                   = element.valor\r\n              cal.banco                   = element.banco\r\n              cal.tipo_cuenta             = element.tipo_cuenta\r\n              cal.num_cuenta              = element.num_cuenta\r\n              cal.observacion             = element.observacion\r\n              cal.porcentaje              = element.comision\r\n              cal.porcentajeReal          = element.comision\r\n              cal.valorPorcentaje         = (me.valorComision * element.comision) / 100\r\n              cal.valorPorcentajeReal     = (me.valorComisionReal * element.comision) / 100\r\n              me.arregloPorcentajes.push(cal)\r\n            })\r\n          }\r\n          if(me.tipo == 3){\r\n            me.beneficiarios.forEach(element => {\r\n              var cal = new Object();\r\n              cal.beneficiario            = element.beneficiario\r\n              cal.cedula                  = element.cedula\r\n              cal.nombres                 = element.nombres\r\n              cal.apellidos               = element.apellidos\r\n              cal.id_beneficiario_pedido  = element.id_beneficiario_pedido\r\n              cal.id_pedido               = element.id_pedido\r\n              cal.id_usuario              = element.id_usuario\r\n              cal.cod_usuario             = element.cod_usuario\r\n              cal.tipo_identificacion     = element.tipo_identificacion\r\n              cal.direccion               = element.direccion\r\n              cal.correo                  = element.correo\r\n              cal.comision                = element.comision\r\n              cal.valor                   = element.valor\r\n              cal.banco                   = element.banco\r\n              cal.tipo_cuenta             = element.tipo_cuenta\r\n              cal.num_cuenta              = element.num_cuenta\r\n              cal.observacion             = element.observacion\r\n              cal.porcentaje              = 0\r\n              cal.porcentajeReal          = 0\r\n              cal.valorPorcentaje         = 0\r\n              cal.valorPorcentajeReal     = 0\r\n              me.arregloPorcentajes.push(cal)\r\n            })\r\n          }\r\n          if(me.desdeVerificacion == '0' || me.desdeVerificacion == '2'){\r\n            me.updatePedido()\r\n          }\r\n        },\r\n        getTipo(){\r\n          let me = this;\r\n          //TOTAL COMISION\r\n          let total = me.beneficiarios.reduce((a, b) => a + (b[\"comision\"] || 0), 0);\r\n          //si es igual a comision 40% por ejemplo\r\n          if(total == me.comision){\r\n            return 1\r\n          }\r\n          //si es igual al 100\r\n          if(total == 100){\r\n            return 2\r\n          }\r\n          else{\r\n            return 3\r\n          }\r\n        },\r\n        updatePedido(){\r\n          let me = this;\r\n          if(me.arregloPorcentajes.length == 0)        { return }\r\n          let formData = new FormData();\r\n          formData.append('todo',                     'yes')\r\n          formData.append('beneficiarios',             JSON.stringify(me.arregloPorcentajes));\r\n          this.$http.post(this.$server_url+'updateBeneficiarios', formData)\r\n          .then(res => {\r\n          })\r\n        },\r\n        filtrarDecimal(numero){\r\n          let me = this\r\n          if(numero == 0 || numero == null){\r\n              return numero\r\n          }else{\r\n              const transformar = (numero).toFixed(2).replace(/\\d(?=(\\d{3})+\\.)/g, '$&,');\r\n              return transformar\r\n          }\r\n        },\r\n        async saveBeneficario(){\r\n            let me = this;\r\n            if( me.responsable == '' || me.beneficiario.tipo_identificacion == '' || me.beneficiario.num_identificacion == '' || me.beneficiario.ciudad == '' || me.beneficiario.direccion == '' || me.beneficiario.comision == ''){\r\n                me.$vs.notify({ color: 'warning', title: 'Alerta', text: 'Complete todos los campos antes de guardar.' })\r\n                return\r\n            }\r\n            //registrar un nuevo beneficiario (registrar nuevo usuario)\r\n            if(me.ifCrearBeneficiario){\r\n                me.guardarNuevoBeneficiario()\r\n            }else{\r\n                me.guardar_beneficiario()\r\n            }\r\n        },\r\n        async guardarNuevoBeneficiario() {\r\n            let me = this\r\n            if(me.id_institucion == \"undefined\" || me.id_institucion == \"\" || me.id_institucion == null || me.id_institucion == undefined){\r\n                me.$vs.notify({ color: 'warning', title: 'Alerta', text: 'Seleccione una institución.' })\r\n            }\r\n            if( me.beneficiario.nombres == '' || me.beneficiario.apellidos == '' || me.beneficiario.correo == '' ||  me.beneficiario.telefono == '' || me.beneficiario.direccion == ''){\r\n                me.$vs.notify({ color: 'warning', title: 'Alerta', text: 'Complete todos los campos antes de guardar.' })\r\n                return\r\n            }\r\n            me.$vs.loading();\r\n            let formData = new FormData();\r\n            formData.append('cedula',                   this.beneficiario.num_identificacion);\r\n            formData.append('nombres',                  this.beneficiario.nombres);\r\n            formData.append('apellidos',                this.beneficiario.apellidos);\r\n            formData.append('email',                    this.beneficiario.correo);\r\n            formData.append('telefono',                 this.beneficiario.telefono);\r\n            formData.append('institucion_idInstitucion',this.id_institucion);\r\n            formData.append('idcreadorusuario',         this.usuario_creador.idusuario);\r\n            formData.append('direccion',                me.beneficiario.direccion);\r\n            this.$http.post(this.$server_url+'guardar_responsable_pedido', formData)\r\n            .then(function (response) {\r\n                me.$vs.loading.close();\r\n                if(response.data.status == 0){\r\n                    me.$vs.notify({ color: 'danger', title:'Error' , text: response.data.message, time:4000})\r\n                    return\r\n                }\r\n                me.$vs.notify({ color: 'success', title: 'Éxito', text: 'Responsable registrado correctamente.' })\r\n                me.beneficiario.idusuario = response.data.idusuario\r\n                me.guardar_beneficiario()\r\n            })\r\n            .catch(function (error) {\r\n              me.$vs.loading.close()\r\n                if (error.response.status == 422) {\r\n                    try {\r\n                        me.$vs.notify({ color: 'warning', title: 'Alerta', text: error.response.data.errors.cedula[0] })\r\n                    } catch (error) {\r\n                    }\r\n                    try {\r\n                        me.$vs.notify({ color: 'warning', title: 'Alerta', text: error.response.data.errors.nombres[0] })\r\n                    } catch (error) {\r\n                    }\r\n                    try {\r\n                        me.$vs.notify({ color: 'warning', title: 'Alerta', text: error.response.data.errors.apellidos[0] })\r\n                    } catch (error) {\r\n                    }\r\n                    try {\r\n                        me.$vs.notify({ color: 'warning', title: 'Alerta', text: error.response.data.errors.email[0] })\r\n                    } catch (error) {\r\n                    }\r\n                    try {\r\n                        me.$vs.notify({ color: 'warning', title: 'Alerta', text: error.response.data.errors.password[0] })\r\n                    } catch (error) {\r\n                    }\r\n                }\r\n            })\r\n        },\r\n        async guardar_beneficiario() {\r\n            let me = this\r\n            me.$vs.loading();\r\n            let formData = new FormData();\r\n            formData.append('id_beneficiario',     me.id_beneficiario);\r\n            formData.append('id_pedido',           me.id_pedido);\r\n            formData.append('institucion',         localStorage.institucion_selected_pedido);\r\n            formData.append('nombres',             me.beneficiario.nombres)\r\n            formData.append('apellidos',           me.beneficiario.apellidos)\r\n            formData.append('telefono',            me.beneficiario.telefono)\r\n            if(me.usuario_creador.id_group == 11){\r\n                formData.append('id_asesor',          me.usuario_creador.idusuario);\r\n                formData.append('id_responsable',     me.usuario_creador.idusuario);\r\n            }else{\r\n                formData.append('id_responsable',      me.id_asesor_pedido);\r\n                formData.append('id_asesor',           me.id_asesor_pedido);\r\n            }\r\n            formData.append('idusuario',           me.beneficiario.idusuario)\r\n            formData.append('tipo_identificacion', me.beneficiario.tipo_identificacion);\r\n            formData.append('num_identificacion',  me.beneficiario.num_identificacion);\r\n            formData.append('direccion',           me.beneficiario.direccion);\r\n            formData.append('comision',            me.beneficiario.comision);\r\n            formData.append('valor',               0); // valor calculado de la comision\r\n            formData.append('banco',               me.beneficiario.banco);\r\n            formData.append('tipo_cuenta',         me.beneficiario.tipo_cuenta);\r\n            formData.append('num_cuenta',          me.beneficiario.num_cuenta);\r\n            formData.append('correo',              me.beneficiario.correo);\r\n            formData.append('observacion',         me.beneficiario.observacion);\r\n            formData.append('id_group',            me.usuario_creador.id_group)\r\n            this.$http.post(this.$server_url+'save_beneficiarios_pedido', formData)\r\n            .then(res => {\r\n                me.$vs.loading.close();\r\n                if(res.data.status == 0){\r\n                    me.$vs.notify({\r\n                    text:res.data.message,\r\n                    color:'danger',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check',\r\n                    time:8000\r\n                    })\r\n                    return\r\n                }\r\n                if(res.data.error){\r\n                    me.$vs.notify({\r\n                    text:res.data.error,\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check',\r\n                    time:8000\r\n                    })\r\n                    return\r\n                }\r\n                me.popupBeneficiario = false\r\n                me.getBeneficiarios()\r\n                me.$emit('rechargePedido',true)\r\n            })\r\n            .catch(err => {\r\n                console.log(err)\r\n                me.$vs.loading.close();\r\n            })\r\n        },\r\n        UpdateFechaCreacionPedido(id_pedido) {\r\n            let me = this;\r\n            this.$http.get(this.$server_url+'UpdateFechaCreacionPedido/'+id_pedido)\r\n            .then(function (res) {\r\n            })\r\n            .catch(function (error) {\r\n                console.log(error + ' error');\r\n            })\r\n        },\r\n        eliminar_beneficiario(item){\r\n            let me = this\r\n            me.id_beneficiario = item.id_beneficiario_pedido\r\n            me.$vs.dialog({\r\n                type: 'confirm',\r\n                color: 'danger',\r\n                title: `Confirmar`,\r\n                text: '¿Está seguro en eliminar este beneficiario?',\r\n                acceptText: 'Aceptar',\r\n                cancelText: 'Cancelar',\r\n                accept: me.confirm_eliminar_beneficiario\r\n            })\r\n        },\r\n        confirm_eliminar_beneficiario(){\r\n            let me = this\r\n            me.$vs.loading();\r\n            let formData = new FormData();\r\n            formData.append('id_pedido',       me.id_pedido)\r\n            formData.append('id_beneficiario', me.id_beneficiario)\r\n            this.$http.post(this.$server_url+'eliminar_beneficiario_pedido',formData)\r\n            .then(res => {\r\n                me.$vs.loading.close();\r\n                if(res.data.status == 0){\r\n                    this.$vs.notify({\r\n                    text:'Debe completar todos los campos antes de guardar',\r\n                    color:'warning',\r\n                    iconPack: 'feather',\r\n                    icon:'icon-check'})\r\n                    return\r\n                }\r\n                me.getBeneficiarios()\r\n                me.$emit('rechargePedido',true)\r\n            })\r\n            .catch((err) =>{\r\n                me.$vs.loading.close();\r\n            })\r\n        },\r\n        setInstitucion(){\r\n            this.id_institucion = localStorage.institucion_selected_pedido\r\n        },\r\n    },\r\n}\r\n</script>\r\n<style scoped>\r\n.features {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n.features li {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n}\r\n.features li + * {\r\n  margin-top: 0.75rem;\r\n}\r\n.features .icon {\r\n  background-color: #1FCAC5;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: #fff;\r\n  border-radius: 50%;\r\n  width: 20px;\r\n  height: 20px;\r\n}\r\n.features .icon svg {\r\n  width: 14px;\r\n  height: 14px;\r\n}\r\n.features + * {\r\n  margin-top: 1.25rem;\r\n}\r\n\r\n</style>\r\n"]}]}