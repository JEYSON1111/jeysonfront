{"remainingRequest":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\asesor\\admin\\gestionVisitas.vue?vue&type=style&index=0&id=37e55d76&lang=css","dependencies":[{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\asesor\\admin\\gestionVisitas.vue","mtime":1712682815514},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\n@media(max-width: 576px) {\r\n  .filtroInstituciones{\r\n    margin-top:8px;\r\n  }\r\n}\r\n",{"version":3,"sources":["gestionVisitas.vue"],"names":[],"mappings":";AA+tCA;AACA;AACA;AACA;AACA","file":"gestionVisitas.vue","sourceRoot":"src/views/asesor/admin","sourcesContent":["<template>\r\n    <div v-if=\"usuario.id_group == 1\">\r\n      <vs-card v-if=\"verCantidadVisitas == false\">\r\n        <vs-row>\r\n            <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n              <vs-alert active=\"true\" color=\"success\">\r\n                <p style=\"text-align:center;\">\r\n                  <i class=\"fa fa-address-book\" aria-hidden=\"true\"></i>  Gestión de visitas de los asesores\r\n                </p>\r\n              </vs-alert>\r\n            </vs-col>\r\n        </vs-row>\r\n        <div class=\"vx-row mt-5\">\r\n          <!--FILTRO TIPO DE INSTITUCIONES-->\r\n          <div class=\"vx-col w-full sm:w-1/2 md:w-1/2 lg:w-1/3 xl:w-1/3 mb-6\">\r\n            <ul class=\"flex\" style=\"border:1px solid #ccc;padding:10px;border-radius:10px;\">\r\n              <li class=\"mr-3\">\r\n                <b>Instituciones:</b>\r\n              </li>\r\n              <li>\r\n                <vs-radio v-model=\"filtro.tipoInstitucion\" @input=\"instituciones = []\" class=\"mr-3\"  vs-name=\"radios1tipoInstitucion\" vs-value=\"1\">Prolipa</vs-radio>\r\n              </li>\r\n              <li>\r\n                <vs-radio v-model=\"filtro.tipoInstitucion\" @input=\"instituciones = [];asesor='';filtro.asesor='';informacion=[];tmpInformacion=[];\" vs-name=\"radios1tipoInstitucion\" vs-value=\"2\">Creadas por el asesor</vs-radio>\r\n              </li>\r\n            </ul>\r\n          </div>\r\n          <div class=\"vx-col w-full sm:w-1/2 md:w-1/2 lg:w-1/3 xl:w-1/3 mb-6\">\r\n            <div class=\"flex\">\r\n              <vx-tooltip style=\"display: inline-block;\" text=\"Agregar planificación\" position=\"top\" color=\"primary\">\r\n                <vs-button radius color=\"dark\" type=\"line\" @click=\"modalAgregar();update=false\" icon=\"add\"></vs-button>\r\n              </vx-tooltip>\r\n              <vs-button type=\"gradient\" class=\"ml-5\" size=\"small\" @click=\"abrirCantidadVisitas();\" icon=\"account_circle\">VISITAS POR INSTITUCIÓN</vs-button>\r\n            </div>\r\n          </div>\r\n        </div><!--End vx-row-->\r\n        <vs-row class=\"mt-2\">\r\n          <!--FILTRO DE ASESORES-->\r\n          <vs-col vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-sm=\"12\" vs-xs=\"12\"  class=\"m-3\">\r\n            <p class=\"mt-4\">Filtro de asesores</p>\r\n            <v-select :options=\"asesores\" @input=\"getInstitucion();asesor=filtro.asesor.idusuario\" :reduce=\"asesores => asesores\" label=\"vendedor\" class=\"w-full\" style=\"margin-top:18px;\" v-model=\"filtro.asesor\" />\r\n          </vs-col>\r\n          <!--FILTRO DE INSTITUCIONES-->\r\n          <vs-col vs-type=\"flex\" vs-justify=\"center\" class=\"m-3 filtroInstituciones\" vs-w=\"3\" vs-sm=\"12\" vs-xs=\"12\"  vs-align=\"center\">\r\n            Filtro de instituciones\r\n            <v-select :options=\"instituciones\" @input=\"getAllVisitas();filtroInstitucion=true\" :reduce=\"instituciones => instituciones\" label=\"nombreInstitucion\" class=\"w-full\" v-model=\"filtro.institucion\" />\r\n          </vs-col>\r\n          <!--FILTRO FECHAS-->\r\n          <vs-col vs-type=\"flex\" vs-justify=\"center\" class=\"m-3\" vs-w=\"4\" vs-sm=\"12\" vs-xs=\"12\"  vs-align=\"center\" v-if=\"tmpInformacion.length > 0\">\r\n            <div class=\"vx-row ml-3\">\r\n              <div class=\"vx-col w-full sm:w-full md:w-full lg:w-full xl:w-1/2 mb-6\">\r\n                <p>Fecha Visita inicio</p>\r\n                <flat-pickr :config=\"configdateTimePicker2\" @input=\"filterVisited();\" v-model=\"filtroVisitaInicio\"  placeholder=\"Fecha Visita Desde\"  class=\"w-full\" />\r\n              </div>\r\n              <div class=\"vx-col w-full sm:w-full md:w-full lg:w-full xl:w-1/2 mb-6\">\r\n                <div class=\"flex\">\r\n                  <div>\r\n                    <p>Fecha Visita Fin</p>\r\n                    <flat-pickr :config=\"configdateTimePicker2\" @input=\"filterVisited();\" v-model=\"filtroVisitaFin\"  placeholder=\"Fecha Visita Hasta\"  style=\"display: inline-block;width: 100%;\" />\r\n                  </div>\r\n                  <vx-tooltip style=\"display: inline-block;\" text=\"Listar Todo\" position=\"top\" color=\"primary\">\r\n                    <vs-button radius color=\"primary\" @click=\"filtroVisitaInicio=null;filtroVisitaFin=null;filterVisited();\" class=\"ml-2 mt-5\" type=\"border\" icon-pack=\"feather\" icon=\"icon-x\"></vs-button>\r\n                  </vx-tooltip>\r\n                  <vx-tooltip style=\"display: inline-block;\" text=\"Fecha de este mes\" position=\"top\" color=\"primary\">\r\n                    <vs-button radius color=\"primary\" @click=\"fechaMes();filterVisited();\" class=\"ml-5 mt-5\" type=\"border\" icon-pack=\"feather\" icon=\"icon-calendar\"></vs-button>\r\n                  </vx-tooltip>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </vs-col>\r\n        </vs-row>\r\n        <!--TABLA-->\r\n        <div v-if=\"filtro.todo == true\" class=\"mt-5\">\r\n          <vs-table multiple v-model=\"codigoSelected\" pagination max-items=\"25\" search :data=\"informacion\">\r\n            <template slot=\"header\">\r\n              <vs-chip color=\"primary\" style=\"font-size:12px;\">\r\n                Cantidad de visitas: <span style=\"font-weight:bold;\"> {{informacion.length}}</span>\r\n              </vs-chip>\r\n              <vs-button color=\"warning\" size=\"small\" class=\"mr-5\" style=\"font-size: 14px;\" @click=\"activePrompt=true;\">Exportar</vs-button>\r\n            </template>\r\n            <template slot=\"thead\">\r\n              <vs-th sort-key=\"nombreInstitucion\">Institucion</vs-th>\r\n              <vs-th sort-key=\"title\">Título</vs-th>\r\n              <vs-th sort-key=\"creador\">Usuarios</vs-th>\r\n              <vs-th sort-key=\"startDate\">Fechas</vs-th>\r\n              <vs-th sort-key=\"url\">Observaciones</vs-th>\r\n              <vs-th sort-key=\"status\">Estado</vs-th>\r\n              <vs-th  style=\"width:100px;\">Acciones</vs-th>\r\n            </template>\r\n            <template slot-scope=\"{data}\">\r\n              <vs-tr :data=\"tr\" :key=\"indextr\" v-for=\"(tr, indextr) in data\">\r\n                  <vs-td :data=\"data[indextr].nombreInstitucion\">\r\n                    #id: {{data[indextr].id}}<br>\r\n                      <div v-if=\"tr.estado_institucion_temporal == '1'\">\r\n                          <i class=\"fa-solid fa-bookmark\"></i>\r\n                          {{data[indextr].nombre_institucion_temporal}}<br>\r\n                          {{ tr.periodo }}\r\n                      </div>\r\n                      <div v-else>\r\n                          {{data[indextr].nombreInstitucion}}<br>\r\n                          {{ tr.periodo }}\r\n                      </div>\r\n                      <p style=\"font-weight:bold;\">Asesor:</p>\r\n                      {{ data[indextr].userAsesor }}\r\n                  </vs-td>\r\n                  <vs-td :data=\"data[indextr].title\">\r\n                      {{ data[indextr].title }}\r\n                  </vs-td>\r\n                  <vs-td :data=\"data[indextr].creador\">\r\n                      <p style=\"font-weight:bold;\">Usuario creador:</p>\r\n                      {{ data[indextr].creador }}\r\n                      <p style=\"font-weight:bold;\">Usuario Finalizador:</p>\r\n                      {{ data[indextr].finalizador }}\r\n                  </vs-td>\r\n                  <vs-td :data=\"data[indextr].startDate\">\r\n                      Fecha generar visita:\r\n                      <span>{{tr.startDate}}</span><br>\r\n                      Fecha que visita:\r\n                      <span>{{tr.fecha_que_visita}}</span><br>\r\n                      <vs-chip color=\"danger\" v-if=\" tr.dias_desface != '' && tr.dias_desface != null\">{{ tr.dias_desface }} días de diferencia</vs-chip>\r\n                  </vs-td>\r\n                  <vs-td :data=\"data[indextr].url\">\r\n                      {{ data[indextr].url }}\r\n                  </vs-td>\r\n                  <vs-td :data=\"data[indextr].status\">\r\n                      <vs-chip :color=\"tr.estado == '0'?'success':'warning'\">\r\n                          {{ tr.estado == '0' ? 'Generada' :'Finalizada' }}\r\n                      </vs-chip>\r\n                  </vs-td>\r\n                    <vs-td>\r\n                      <div style=\"display: flex;\">\r\n                          <div>\r\n                              <vx-tooltip style=\"display: inline-block;\" text=\"Editar planificación\" position=\"top\" color=\"primary\">\r\n                                  <vs-button class=\"modal-default-button\" size=\"small\" @click=\"getInstitucionInfo(tr);openEditPlanificacion(tr);update=true\" color=\"success\" radius type=\"line\" icon-pack=\"feather\" icon=\"icon-edit\"> </vs-button>\r\n                              </vx-tooltip> &nbsp;\r\n                              <vx-tooltip style=\"display: inline-block;\" text=\"Eliminar planificación\" position=\"top\" color=\"primary\">\r\n                                  <vs-button class=\"modal-default-button\" size=\"small\" @click=\"openConfirmarEliminar(tr);\" color=\"danger\" radius type=\"line\" icon-pack=\"feather\" icon=\"icon-trash\"> </vs-button>\r\n                              </vx-tooltip> &nbsp;\r\n                          </div>\r\n                      </div>\r\n                  </vs-td>\r\n              </vs-tr>\r\n            </template>\r\n          </vs-table>\r\n        </div>\r\n        <br><br><br><br><br><br>\r\n      </vs-card>\r\n      <vs-card v-else>\r\n        <vs-button radius color=\"success\" @click=\"verCantidadVisitas = false\" type=\"gradient\" icon=\"reply\"></vs-button>\r\n        <vs-row>\r\n          <vs-col vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" class=\"ml-3\">\r\n            Filtro de asesores\r\n            <v-select :options=\"asesores\" @input=\"filtro.institucion='';getInstitucion();asesor=filtro.asesor.idusuario\" :reduce=\"asesores => asesores\" label=\"vendedor\" class=\"w-full\" v-model=\"filtro.asesor\" />\r\n          </vs-col>\r\n          <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"3\">\r\n              <flat-pickr :config=\"configdateTimePicker2\" v-model=\"fromDate\"  placeholder=\"Fecha Inicio\" class=\"ml-2 mt-1\" style=\"display: inline-block;width: 100%;\" />\r\n          </vs-col>\r\n          <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"3\">\r\n              <flat-pickr :config=\"configdateTimePicker2\" v-model=\"toDate\" placeholder=\"Fecha Fin\" class=\"ml-2 mt-1\" style=\"display: inline-block;width: 100%\" />\r\n          </vs-col>\r\n          <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"1\">\r\n              <vx-tooltip style=\"display: inline-block;\" text=\"Filtrar visitas\" position=\"top\" color=\"primary\">\r\n                  <vs-button radius color=\"warning\" @click=\"getCantidadVisitas();\" type=\"line\" icon=\"search\"></vs-button>\r\n              </vx-tooltip>\r\n          </vs-col>\r\n        </vs-row>\r\n        <CantidadVisitasVue :ReportVisitas=\"ReportVisitas\" :ReportVisitasTemporales = \"ReportVisitasTemporales\"/>\r\n      </vs-card>\r\n      <!--MODALES-->\r\n      <!--MODAL PARA AGREGAR PLANIFICACION-->\r\n      <vs-popup background-color=\"rgba(255,255,255,.6)\" fullscreen :title=\"titulo\" :active.sync=\"activePromptAddEvent\">\r\n        <div  class=\"mt-3\">\r\n          <div class=\"calendar__label-container flex mb-6\" v-if=\"seleccionadoInsitucion == false\">\r\n            <vs-chip style=\"width: 100px;height: 25px;margin-top: 1px;\" class=\"text-white\" :class=\"'bg-' + labelLocal.color\">{{ labelLocal.text }}</vs-chip>\r\n                <span v-if=\"estado == 1\"  style=\"margin-top:2px;\">\r\n                    <vs-chip color=\"success\">Realizada</vs-chip>\r\n                </span>\r\n            <vs-dropdown vs-custom-content vs-trigger-click class=\"ml-auto my-2 cursor-pointer\">\r\n              <feather-icon icon=\"TagIcon\" svgClasses=\"h-5 w-5\" class=\"cursor-pointer\" @click.prevent></feather-icon>\r\n              <vs-dropdown-menu style=\"z-index: 200001\">\r\n                <vs-dropdown-item v-for=\"(label, index) in calendarLabels\" :key=\"index\" @click=\"labelLocal = label\">\r\n                  <div class=\"h-3 w-3 inline-block rounded-full mr-2\" :class=\"'bg-' + label.color\"></div>\r\n                  <span>{{ label.text }}</span>\r\n                </vs-dropdown-item>\r\n              </vs-dropdown-menu>\r\n            </vs-dropdown>\r\n          </div>\r\n          <div>\r\n            <!--INSTITUCIONES-->\r\n            <vs-row v-if=\"seleccionadoInsitucion ==  false\" class=\"mt-2\">\r\n              <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n                <p style=\"color:red;\" v-if=\"nombreInstitucion == '' || nombreInstitucion == null \">\r\n                    Sin Institución\r\n                </p>\r\n                <div v-else>\r\n                  <vs-chip color=\"success\">\r\n                    Institución: {{ nombreInstitucion}}\r\n                  </vs-chip>\r\n                  <vs-chip color=\"dark\" class=\"ml-2\">\r\n                    Asesor: {{ asesorSelect }}\r\n                  </vs-chip>\r\n                </div>\r\n              </vs-col>\r\n            </vs-row>\r\n            <vs-row v-if=\"seleccionadoInsitucion ==  true\" class=\"mt-2\">\r\n                <vs-col vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"6\">\r\n                    <vs-button size=\"small\" color=\"success\" radius=\"\" @click=\"regresar()\" icon=\"reply\" type=\"gradient\"></vs-button>\r\n                    <vs-button size=\"small\" class=\"ml-3\" @click=\"popupAddNuevaInstitucion = true;activePromptAddEvent = false;\" type=\"relief\">Añadir nueva institución</vs-button>\r\n                </vs-col>\r\n            </vs-row>\r\n            <vs-row>\r\n                <vs-col vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"6\">\r\n                    <vs-button color=\"warning\" class=\"mt-2\" v-if=\"seleccionadoInsitucion == false\"  @click=\"seleccionadoInsitucion = true;tipo = 1\" type=\"relief\">Asignar institución de prolipa</vs-button>\r\n                    <vs-button color=\"primary\" class=\"mt-2 ml-3\" icon=\"info\" v-if=\"seleccionadoInsitucion == false\"  @click=\"seleccionadoInsitucion = true;getInstitucionCreadasByAsesor();tipo = 2;\" type=\"relief\">Institución creada por el asesor</vs-button>\r\n                </vs-col>\r\n            </vs-row>\r\n            <div style=\"width:100%;display:flex;\" v-if=\"seleccionadoInsitucion ==  true && tipo == 1\" class=\"mt-5\">\r\n                <div style=\"width:80%;\">\r\n                    <vs-input icon=\"search\" style=\"width:100%;\" placeholder=\"Search\" @keyup.enter=\"getInstitucionAsesor()\" v-model=\"busquedaInstitucion\" />\r\n                </div>\r\n                <div style=\"width:20%;margin-left:15px;\">\r\n                    <vs-button radius color=\"warning\" @click=\"getInstitucionAsesor()\" type=\"filled\" icon=\"search\"></vs-button>\r\n                </div>\r\n            </div>\r\n            <div v-if=\"institucionesAsesor.length >0\">\r\n              <vs-table stripe max-items=\"5\" search pagination :data=\"institucionesAsesor\">\r\n                <template slot=\"header\">\r\n                  <div class=\"vx-row\">\r\n                    <div class=\"vx-col w-full m-3\">\r\n                        Cantidad: {{institucionesAsesor.length}}\r\n                    </div>\r\n                  </div>\r\n                </template>\r\n                <template slot=\"thead\">\r\n                  <vs-th sort-key=\"nombreInstitucion\">Institución</vs-th>\r\n                  <vs-th sort-key=\"nombre\">Localidad</vs-th>\r\n                  <vs-th>Acciones</vs-th>\r\n                </template>\r\n                <template slot-scope=\"{data}\">\r\n                  <vs-tr :key=\"indextr\" v-for=\"(tr, indextr) in data\">\r\n                    <vs-td :data=\"data[indextr].nombreInstitucion\">\r\n                        {{data[indextr].nombreInstitucion}}<br>\r\n                        <div v-if=\"tr.institucion_temporal_id\">\r\n                          <b>Asesor:</b>\r\n                          <p>{{ filtro.asesor.vendedor }}</p>\r\n                        </div>\r\n                        <div v-else>\r\n                          <b>Asesor:</b>\r\n                          <p>{{ tr.nombre_asesor + \" \" + tr.apellido_asesor }}</p>\r\n                        </div>\r\n                    </vs-td>\r\n                    <vs-td :data=\"data[indextr].nombreregion\">\r\n                        {{data[indextr].nombreregion}} <br>\r\n                        <small>{{data[indextr].ciudad}}</small>\r\n                    </vs-td>\r\n                    <vs-td>\r\n                        <div class=\"flex\">\r\n                            <vs-button size=\"small\" type=\"relief\" style=\"border-radius: 5px;\" icon-pack=\"feather\" icon=\"icon-bookmark\" class=\"mr-2\" color=\"primary\" @click=\"asginarInstitucion(tr);error=false\">\r\n                                Asignar\r\n                            </vs-button>\r\n                        </div>\r\n                    </vs-td>\r\n                  </vs-tr>\r\n                </template>\r\n              </vs-table>\r\n            </div>\r\n          </div>\r\n          <vs-row v-if=\"error ==  true\" class=\"mt-3\">\r\n              <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n                <vs-alert active=\"true\" color=\"danger\">\r\n                    {{messageError}}\r\n                </vs-alert>\r\n              </vs-col>\r\n          </vs-row>\r\n          <div v-if=\"seleccionadoInsitucion == false\">\r\n              <br>\r\n              <vs-input class=\"w-full mb-3 \" label-placeholder=\"Título del evento *\" v-model=\"title\"></vs-input>\r\n              <div class=\"vx-row mb-3\">\r\n                  <div class=\"vx-col sm:w-1/2 w-full\">\r\n                      <small class=\"date-label\">Fecha inicio *</small>\r\n                      <datepicker class=\"w-full\" name=\"start-date\" v-model=\"startDate\"  :disabled=\"disabledFrom\"></datepicker>\r\n                  </div>\r\n                  <div class=\"vx-col sm:w-1/2 w-full\" v-if=\"update == true\">\r\n                      <small class=\"date-label\">Fecha que visitó</small>\r\n                      <datepicker class=\"w-full\" name=\"end-date\" v-model=\"endDate\"></datepicker>\r\n                  </div>\r\n              </div>\r\n              <div class=\"vx-row mb-3\">\r\n                  <div class=\"vx-col sm:w-1/2 w-full\">\r\n                      <small class=\"date-label\">Hora inicio *</small>\r\n                      <flat-pickr class=\"w-full\" :config=\"configdateTimePicker\" v-model=\"hora_inicio\" />\r\n                  </div>\r\n                  <div class=\"vx-col sm:w-1/2 w-full\">\r\n                      <small class=\"date-label\">Hora fin *</small>\r\n                      <flat-pickr class=\"w-full\" :config=\"configdateTimePicker\" v-model=\"hora_fin\" />\r\n                  </div>\r\n              </div>\r\n          </div>\r\n          <div>\r\n            <vs-divider color=\"success\" v-if=\"seleccionadoInsitucion == false\">Opciones</vs-divider>\r\n            <vs-row v-if=\"seleccionadoInsitucion == false\">\r\n                <vs-col vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-checkbox color=\"success\" v-model=\"opciones.presentacion\">Presentación</vs-checkbox>\r\n                </vs-col>\r\n                <vs-col vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-checkbox color=\"success\" v-model=\"opciones.entrega_muestras\">Entregas de muestras</vs-checkbox>\r\n                </vs-col>\r\n                <vs-col vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-checkbox color=\"success\" v-model=\"opciones.reunion\">Reunión</vs-checkbox>\r\n                </vs-col>\r\n                <vs-col vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-checkbox color=\"success\" v-model=\"opciones.seguimiento\">Seguimiento</vs-checkbox>\r\n                </vs-col>\r\n\r\n                <vs-col class=\"mt-2\" vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-checkbox color=\"success\" v-model=\"opciones.cierre\">Cierre</vs-checkbox>\r\n                </vs-col>\r\n                <vs-col class=\"mt-2\" vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-checkbox color=\"success\" v-model=\"opciones.cobranza\">Cobranza</vs-checkbox>\r\n                </vs-col>\r\n                <vs-col class=\"mt-2\" vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-checkbox color=\"success\" v-model=\"opciones.post_venta\">Post Venta</vs-checkbox>\r\n                </vs-col>\r\n                <vs-col class=\"mt-2\" vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-checkbox color=\"success\" v-model=\"opciones.retiro_cartas\">Retiro de cartas</vs-checkbox>\r\n                </vs-col>\r\n\r\n                <vs-col class=\"mt-2\" vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-checkbox color=\"success\" v-model=\"opciones.retiro_muestras\">Retiro de muestras</vs-checkbox>\r\n                </vs-col>\r\n                <vs-col class=\"mt-2\" vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-switch color=\"danger\" v-model=\"opciones.sinSello\" style=\"width: 60%;\">\r\n                        <span slot=\"on\">Sin sello</span>\r\n                        <span slot=\"off\">Con Sello</span>\r\n                    </vs-switch>\r\n                </vs-col>\r\n                <vs-col class=\"mt-2\" vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-checkbox color=\"success\" v-model=\"opciones.capacitacion\">Capacitación</vs-checkbox>\r\n                </vs-col>\r\n                <vs-col class=\"mt-2\" vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-checkbox color=\"success\" v-model=\"opciones.otraEditorial\">Otra Editorial</vs-checkbox>\r\n                </vs-col>\r\n                <vs-col v-if=\"opciones.otraEditorial == true\" class=\"mt-2\" vs-type=\"flex\" vs-justify=\"left\" vs-align=\"left\" vs-w=\"3\" vs-lg=\"3\" vs-sm=\"4\" vs-xs=\"4\">\r\n                    <vs-input class=\"inputx w-full\" placeholder=\"Escriba el nombre de la editorial\" v-model=\"nombre_editorial\" />\r\n                </vs-col>\r\n            </vs-row>\r\n          </div>\r\n          <vs-textarea counter=\"250\" label=\"Mensaje\" :counter-danger.sync=\"counterDanger\" v-if=\"seleccionadoInsitucion == false\" name=\"event-url\" class=\"w-full mb-3 mt-4\" v-model=\"url\" />\r\n          <div class=\"flex justify-center mt-3\">\r\n            <vs-button @click=\"addEvent()\" type=\"relief\">Guardar</vs-button>\r\n            <vs-button color=\"warning\" class=\"ml-4\" @click=\"activePromptAddEvent = false\" type=\"relief\">{{label_cancel}}</vs-button>\r\n          </div>\r\n        </div>\r\n      </vs-popup>\r\n      <!--MODAL PARA AGREGAR NUEVA INSTITUCION-->\r\n      <vs-popup background-color=\"rgba(255,255,255,.6)\" title=\"Agregar Nueva Institución\" :active.sync=\"popupAddNuevaInstitucion\">\r\n          <vs-button size=\"small\" color=\"success\" radius=\"\" @click=\"popupAddNuevaInstitucion=false;activePromptAddEvent=true;\" icon=\"reply\" type=\"gradient\"></vs-button>\r\n          <vs-row>\r\n              <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n                  <div class=\"vx-col w-full mt-5\">\r\n\r\n                      Seleccione una ciudad:\r\n                      <v-select :options=\"arregloCiudad\" :reduce=\"arregloCiudad => arregloCiudad\" label=\"nombre\" class=\"w-full\" v-model=\"temporalInstitucion.ciudad\" />\r\n                  </div>\r\n              </vs-col>\r\n          </vs-row>\r\n          <vs-row class=\"mt-2\">\r\n              <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n                  <vs-input label=\"Escriba un nombre para la institución\" class=\"w-full\" v-model=\"temporalInstitucion.nombre_institucion\" placeholder=\"Institución\" />\r\n              </vs-col>\r\n          </vs-row>\r\n\r\n          <vs-row class=\"mt-2\">\r\n              <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n                  <ul class=\"leftx\" style=\"display:flex;flex-direction: row;\">\r\n\r\n                      <li class=\"ml-2\">\r\n                          <vs-radio v-model=\"temporalInstitucion.region\" vs-name=\"radios1\" vs-value=\"1\">Sierra</vs-radio>\r\n                      </li>\r\n                      <li class=\"ml-2\">\r\n                          <vs-radio v-model=\"temporalInstitucion.region\" vs-name=\"radios1\" vs-value=\"2\">Costa</vs-radio>\r\n                      </li>\r\n\r\n                  </ul>\r\n              </vs-col>\r\n          </vs-row>\r\n          <vs-row class=\"mt-5\">\r\n              <vs-col vs-type=\"flex\" vs-justify=\"center\" vs-align=\"center\" vs-w=\"12\">\r\n                  <vs-button @click=\"agregarInstitucionTemporal();error = false\" type=\"gradient\">Agregar Institución</vs-button>\r\n              </vs-col>\r\n          </vs-row>\r\n      </vs-popup>\r\n      <!--modal exportar-->\r\n      <vs-prompt title=\"Exportar a Excel\" class=\"export-options\" @cancle=\"clearFields\" @accept=\"exportToExcel\" accept-text=\"Exportar\" @close=\"clearFields\" :active.sync=\"activePrompt\">\r\n          <vs-alert class=\"mb-3\" color=\"danger\" icon-pack=\"feather\" icon=\"icon-info\">\r\n              <span>Recuerde <b>seleccionar</b> los registros que desea exportar.</span>\r\n          </vs-alert>\r\n          <vs-input v-model=\"fileName\" placeholder=\"Ingrese el nombre del archivo\" class=\"w-full\" />\r\n          <v-select v-model=\"selectedFormat\" :options=\"formats\" class=\"my-4\" />\r\n          <div class=\"flex\">\r\n              <!--<span class=\"mr-4\">Cell Auto Width:</span>\r\n              <vs-switch v-model=\"cellAutoWidth\">Cell Auto Width</vs-switch>-->\r\n          </div>\r\n      </vs-prompt>\r\n    </div>\r\n</template>\r\n<script>\r\nimport CantidadVisitasVue from './components/CantidadVisitas.vue'\r\nimport {\r\n    CalendarView,\r\n    CalendarViewHeader\r\n} from 'vue-simple-calendar'\r\nimport planificacionAsesor from './components/planificacionAsesor.vue'\r\nimport moduleCalendar from '@/store/calendar2/moduleCalendar.js'\r\nimport vSelect from 'vue-select'\r\nimport moment from 'moment'\r\nimport Datepicker from 'vuejs-datepicker'\r\nimport flatPickr from 'vue-flatpickr-component';\r\nimport 'flatpickr/dist/flatpickr.css';\r\nimport {\r\n    en,\r\n    he\r\n} from 'vuejs-datepicker/src/locale'\r\nexport default {\r\n    data() {\r\n     return{\r\n         verPlanificaciones:false,\r\n         asesores:[],\r\n         filtro:{\r\n             asesor:'',\r\n             institucion:'',\r\n             tipoInstitucion:'1',\r\n             todo:false\r\n         },\r\n        instituciones:[],\r\n        asesor:'',\r\n        informacion:[],\r\n        tmpInformacion:[],\r\n        filtroInstitucion:false,\r\n        filtroVisitaInicio:null,\r\n        filtroVisitaFin:null,\r\n        activePromptAddEvent:false,\r\n\r\n        //VARIABLES DE AGREGAR PLANIFICACION\r\n\r\n          popupFiltroInstitucion:false,\r\n            error: false,\r\n            messageError: \"\",\r\n            ciudadSelect: '',\r\n            popupAddNuevaInstitucion: false,\r\n            seleccionadoInsitucion: false,\r\n            nombreInstitucion: '',\r\n            asesorSelect:'',\r\n            busquedaInstitucion: \"\",\r\n            instituciones: [],\r\n            popupaddInstitucion: false,\r\n            opciones: {\r\n                presentacion: false,\r\n                entrega_muestras: false,\r\n                reunion: false,\r\n                seguimiento: false,\r\n                cierre: false,\r\n                cobranza: false,\r\n                post_venta: false,\r\n                retiro_cartas: false,\r\n                retiro_muestras: false,\r\n                capacitacion:false,\r\n                sinSello: false,\r\n                otraEditorial: false,\r\n            },\r\n            nombre_editorial: '',\r\n            usuario: [],\r\n            showDate: new Date(),\r\n            disabledFrom: false,\r\n            titulo: '',\r\n            id: 0,\r\n            title: '',\r\n            startDate: '',\r\n            endDate: '',\r\n            labelLocal: {\r\n                text: 'Baja',\r\n                color: 'success'\r\n            },\r\n            langHe: he,\r\n            langEn: en,\r\n\r\n            url: '',\r\n            calendarView: 'month',\r\n\r\n            activePromptAddEvent: false,\r\n            label_cancel: 'Cancelar',\r\n            calendarViewTypes: [{\r\n                    label: 'Mes',\r\n                    val: 'month'\r\n                },\r\n                {\r\n                    label: 'Semana',\r\n                    val: 'week'\r\n                },\r\n                {\r\n                    label: 'Año',\r\n                    val: 'year'\r\n                }\r\n            ],\r\n            time: null,\r\n            configdateTimePicker: {\r\n                enableTime: true,\r\n                enableSeconds: false,\r\n                noCalendar: true\r\n            },\r\n            hora_inicio: '',\r\n            hora_fin: '',\r\n            institucion_id: '',\r\n            counterDanger: false,\r\n            arregloCiudad: [],\r\n            temporalInstitucion: {\r\n                ciudad: '',\r\n                nombreInstitucion: '',\r\n                region: '2',\r\n            },\r\n            institucion_id_temporal: '',\r\n            estado_institucion_temporal: 0,\r\n            periodo_id_temporal: 0,\r\n            nombreInstitucionTemporal: '',\r\n            filtroInstituciones:[],\r\n            estado: '0',\r\n            institucionesAsesor:[],\r\n            titulo:'',\r\n            update:false,\r\n            tipo:1,\r\n            verCantidadVisitas:false,\r\n            //VARIABLES CANTIDAD DE VISITAS\r\n            fromDate: null,\r\n            toDate: null,\r\n            configdateTimePicker2: {\r\n                enableTime: true,\r\n                dateFormat: 'Y-m-d'\r\n            },\r\n            ReportVisitas:[],\r\n            ReportVisitasTemporales:[],\r\n            //FIN VARIABLES PARA CANTIDAD DE VISITAS,\r\n            //VARIABLES PARA EXPORTAR A EXCEL\r\n            codigoSelected: [],\r\n            formats: ['xls', 'xlsx', 'csv', 'txt'],\r\n            fileName:null,\r\n            selectedFormat: 'xls',\r\n            cellAutoWidth: true,\r\n            activePrompt: false,\r\n            //FIN VARIABLES PARA EXPORTAR A EXCEL\r\n\r\n     }\r\n    },\r\n     computed: {\r\n        simpleCalendarEvents() {\r\n            return this.$store.state.calendar.events\r\n        },\r\n        disabledDatesTo() {\r\n            return {\r\n                to: new Date(this.startDate)\r\n            }\r\n        },\r\n        disabledDatesFrom() {\r\n            return {\r\n                from: new Date(this.endDate)\r\n            }\r\n        },\r\n        calendarLabels() {\r\n            return this.$store.state.calendar.eventLabels\r\n        },\r\n        labelColor() {\r\n            return (label) => {\r\n                if (label === 'business') return 'success'\r\n                else if (label === 'work') return 'warning'\r\n                else if (label === 'personal') return 'danger'\r\n                else if (label === 'baja') return 'primary'\r\n            }\r\n        },\r\n        windowWidth() {\r\n            return this.$store.state.windowWidth\r\n        }\r\n    },\r\n    components: {\r\n        Datepicker,\r\n        flatPickr,\r\n        'v-select': vSelect,\r\n        planificacionAsesor,\r\n         CalendarView,\r\n        CalendarViewHeader,\r\n        CantidadVisitasVue,\r\n    },\r\n    created(){\r\n        let me = this;\r\n        me.getAsesores()\r\n        me.isAdmin = localStorage.getItem(\"adminSeguimiento\")\r\n        this.usuario = JSON.parse(localStorage.getItem('usuario'));\r\n        this.$store.registerModule('calendar', moduleCalendar)\r\n        this.$store.dispatch('calendar/fetchEventLabels')\r\n        this.listaCiudades()\r\n        this.institucion_id = \"\"\r\n        this.institucion_id_temporal = \"\"\r\n    },\r\n    mounted(){\r\n      let me                = this;\r\n      me.fechaMes()\r\n    },\r\n    methods:{\r\n      fechaMes(){\r\n        let me                = this\r\n        const date            = new Date()\r\n        const primerDia       = new Date(date.getFullYear(), date.getMonth(), 1)\r\n        const ultimoDia       = new Date(date.getFullYear(), date.getMonth() + 1, 0)\r\n        me.fromDate           = primerDia\r\n        me.toDate             = ultimoDia\r\n        me.filtroVisitaInicio = moment(primerDia).format('YYYY-MM-DD')\r\n        me.filtroVisitaFin    = moment(ultimoDia).format('YYYY-MM-DD')\r\n      },\r\n      dataPlanificacion(){\r\n        let me = this;\r\n        localStorage.setItem('planificacion_asesor_id', me.filtro.asesor.idusuario)\r\n        localStorage.setItem('planificacion_cedula',    me.filtro.asesor.cedula)\r\n        localStorage.setItem('planificacion_vendedor',  me.filtro.asesor.vendedor)\r\n        me.verPlanificaciones = true\r\n      },\r\n      //para obtener el listado de los asesores\r\n      getAsesores() {\r\n        let me = this;\r\n        me.$vs.loading();\r\n        this.$http.get(this.$server_url+'seguimiento')\r\n        .then(function (res) {\r\n          me.asesores = res.data\r\n          me.$vs.loading.close()\r\n        })\r\n        .catch(function (error) {\r\n          console.log(error + ' error');\r\n          me.$vs.loading.close()\r\n        })\r\n      },\r\n      filterVisited() {\r\n        if (this.filtroVisitaInicio && this.filtroVisitaFin) { this.informacion = this.tmpInformacion.filter(p => p.startDate.substring(0, 10) >= this.filtroVisitaInicio && p.startDate.substring(0, 10) <= this.filtroVisitaFin); } else { this.informacion = this.tmpInformacion; }\r\n      },\r\n      getInstitucion() {\r\n          let me = this;\r\n          me.instituciones      = [];\r\n          me.informacion        = []\r\n          me.tmpInformacion     = []\r\n          me.filtro.institucion = \"\"\r\n          me.filtroInstitucion  = false\r\n          if(me.filtro.asesor == null || me.filtro.asesor == undefined  || me.filtro.asesor == \"\"){\r\n              me.$vs.notify({\r\n                  text: 'Seleccione un asesor antes de filtrar las instituciones',\r\n                  color: 'success',\r\n                  iconPack: 'feather',\r\n                  icon: 'icon-user',\r\n              })\r\n              return false\r\n          }\r\n          me.$vs.loading()\r\n          //INSTITUCIONES DE PROLIPA\r\n          if(me.filtro.tipoInstitucion == 1){\r\n                this.$http.get(this.$server_url + 'listaInsitucionAsesor?porCedula=yes'+'&cedula=' + me.filtro.asesor.cedula)\r\n              .then(function (res) {\r\n                  // me.tmpInstituciones = res.data;\r\n                  me.instituciones = res.data;\r\n                  // me.filtroRegion();\r\n                  me.$vs.loading.close()\r\n                  if (res.data.message) {\r\n                      me.$vs.notify({\r\n                          text: res.data.message,\r\n                          color: 'success',\r\n                          iconPack: 'feather',\r\n                          icon: 'icon-user',\r\n                          time: 8000\r\n                      })\r\n                  }\r\n\r\n              })\r\n              .catch(function (error) {\r\n                  console.log(error + ' error');\r\n                  me.$vs.loading.close()\r\n              })\r\n          //INSTITUCIONES CREADAS POR EL ASESOR\r\n          }if(me.filtro.tipoInstitucion == 2){\r\n                this.$http.get(this.$server_url + 'listaInsitucionAsesor?temporales=yes'+'&asesor_id=' + me.filtro.asesor.idusuario)\r\n              .then(function (res) {\r\n                  // me.tmpInstituciones = res.data;\r\n                  me.instituciones = res.data;\r\n                  // me.filtroRegion();\r\n                  me.$vs.loading.close()\r\n                  if (res.data.message) {\r\n                      me.$vs.notify({\r\n                          text: res.data.message,\r\n                          color: 'success',\r\n                          iconPack: 'feather',\r\n                          icon: 'icon-user',\r\n                          time: 8000\r\n                      })\r\n                  }\r\n              })\r\n              .catch(function (error) {\r\n                  console.log(error + ' error');\r\n                  me.$vs.loading.close()\r\n              })\r\n          }\r\n          me.filtro.todo = true\r\n          me.getAllVisitas()\r\n      },\r\n      getAllVisitas(){\r\n          let me = this;\r\n          me.informacion    = []\r\n          me.tmpInformacion = []\r\n          if(me.filtro.asesor == null || me.filtro.asesor == undefined  || me.filtro.asesor == \"\"){\r\n            me.$vs.notify({\r\n              text: 'Seleccione un asesor antes de filtrar las instituciones',\r\n              color: 'success',\r\n              iconPack: 'feather',\r\n              icon: 'icon-user',\r\n            })\r\n            return false\r\n          }\r\n          localStorage.setItem('planificacion_asesor_id', me.filtro.asesor.idusuario)\r\n          localStorage.setItem('planificacion_cedula',    me.filtro.asesor.cedula)\r\n          localStorage.setItem('planificacion_vendedor',  me.filtro.asesor.vendedor)\r\n          this.$http.get(this.$server_url + 'listaInsitucionAsesor?todo=yes'+'&asesor_id=' + me.filtro.asesor.idusuario)\r\n            .then(function (res) {\r\n              if(me.filtro.institucion){\r\n              let datos = res.data\r\n              //FILTRO PARA INSTITUCIONES DE PROLIPAS\r\n              if(me.filtro.tipoInstitucion == 1){\r\n                me.informacion = datos.filter(p => p.institucion_id == me.filtro.institucion.idInstitucion)\r\n              //FILTRO POR INSTITUCION TEMPORAL\r\n              }else{\r\n                me.informacion = datos.filter(p => p.institucion_id_temporal == me.filtro.institucion.institucion_temporal_id)\r\n              }\r\n              }else{\r\n              me.informacion = res.data;\r\n              }\r\n              me.tmpInformacion = me.informacion\r\n              //filtro fechas\r\n              me.filterVisited()\r\n            })\r\n            .catch(function (error) {\r\n              console.log(error + ' error');\r\n            })\r\n      },\r\n      abrirCantidadVisitas(){\r\n        let me = this;\r\n        if(me.filtro.asesor == null || me.filtro.asesor == undefined  || me.filtro.asesor == \"\"){\r\n          me.$vs.notify({\r\n            text: 'Seleccione un asesor para buscar la cantidad de visitas',\r\n            color: 'primary',\r\n            iconPack: 'feather',\r\n            icon: 'icon-info',\r\n          })\r\n          return false\r\n        }\r\n        me.getCantidadVisitas();\r\n        me.verCantidadVisitas = true\r\n      },\r\n      getCantidadVisitas(){\r\n        let me = this;\r\n        me.ReportVisitas  = []\r\n        const from = moment(me.fromDate).format('YYYY-MM-DD')\r\n        const to = moment(me.toDate).format('YYYY-MM-DD')\r\n        me.$vs.loading()\r\n        this.$http.get(`${this.$server_url  }cantidadVisitas?fromDate=${  from  }&toDate=${  to}&asesor_id=${me.filtro.asesor.idusuario}`)\r\n          .then(function (res) {\r\n          me.$vs.loading.close()\r\n          me.ReportVisitas = res.data.visitasInstitucion\r\n          me.ReportVisitasTemporales = res.data.visitasInstitucionTemporal\r\n          })\r\n          .catch(function (e) {\r\n          })\r\n      },\r\n      //funciones para add planificacion\r\n      modalAgregar(){\r\n        let me = this;\r\n        me.limpiar()\r\n        if(me.filtro.asesor == null || me.filtro.asesor == undefined  || me.filtro.asesor == \"\"){\r\n          me.$vs.notify({\r\n            text: 'Seleccione un asesor para agregar una planificación',\r\n            color: 'primary',\r\n            iconPack: 'feather',\r\n            icon: 'icon-info',\r\n          })\r\n          return false\r\n        }\r\n        localStorage.setItem('planificacion_asesor_id', me.filtro.asesor.idusuario)\r\n        localStorage.setItem('planificacion_cedula',    me.filtro.asesor.cedula)\r\n        localStorage.setItem('planificacion_vendedor',  me.filtro.asesor.vendedor)\r\n        me.titulo = \"Agregar planificación del asesor \"+ me.filtro.asesor.vendedor\r\n        me.activePromptAddEvent = true\r\n      },\r\n      agregarInstitucionTemporal() {\r\n        let me = this;\r\n        if (me.temporalInstitucion.nombre_institucion == \"\" || me.temporalInstitucion.nombre_institucion == null || me.temporalInstitucion.nombre_institucion == undefined) {\r\n          me.$vs.notify({\r\n              color: 'primary',\r\n              title: 'Mensaje',\r\n              text: 'Debe escribir una institución por favor'\r\n          })\r\n          return false;\r\n        }\r\n        let formData = new FormData();\r\n        formData.append('nombre_institucion', me.temporalInstitucion.nombre_institucion);\r\n        formData.append('ciudad', me.temporalInstitucion.ciudad.nombre);\r\n        formData.append('region', me.temporalInstitucion.region);\r\n        formData.append('asesor_id', localStorage.planificacion_asesor_id);\r\n        me.$vs.loading()\r\n        this.$http.post(this.$server_url + 'GuardarInstitucionTemporal', formData)\r\n          .then(res => {\r\n            me.$vs.loading.close()\r\n            me.popupAddNuevaInstitucion = false;\r\n            me.activePromptAddEvent = true\r\n            me.seleccionadoInsitucion = false;\r\n            me.nombreInstitucion = me.temporalInstitucion.nombre_institucion\r\n            me.institucion_id_temporal = res.data.institucion_temporal_id\r\n            me.institucionesAsesor = []\r\n            me.periodo_id_temporal = res.data.periodo_id\r\n            me.estado_institucion_temporal = 1;\r\n            me.$vs.notify({\r\n              text: \"Se guardo correctamente\",\r\n              color: 'success',\r\n              iconPack: 'feather',\r\n              icon: 'icon-check'\r\n            })\r\n          })\r\n      },\r\n      //lista de ciudades para usar en el select\r\n      listaCiudades() {\r\n        let me = this\r\n        this.$http.get(this.$server_url + `ciudad`).then(res => {\r\n          me.arregloCiudad = res.data;\r\n        })\r\n        .catch(function (error) {\r\n          console.log(error)\r\n        })\r\n      },\r\n      regresar() {\r\n        let me = this;\r\n        me.seleccionadoInsitucion         = false;\r\n        me.institucionesAsesor            = []\r\n        me.error                          = false\r\n      },\r\n      asginarInstitucion(tr) {\r\n        let me = this;\r\n        if(me.tipo == 1){\r\n          me.institucion_id               = tr.idInstitucion\r\n          me.nombreInstitucion            = tr.nombreInstitucion\r\n          me.asesorSelect                 = tr.nombre_asesor + \" \"+ tr.apellido_asesor\r\n          me.estado_institucion_temporal  = 0;\r\n          me.seleccionadoInsitucion       = false;\r\n          me.institucionesAsesor          = []\r\n        }else{\r\n          me.nombreInstitucion            = tr.nombreInstitucion\r\n          me.asesorSelect                 = me.filtro.asesor.vendedor\r\n          me.institucion_id_temporal      = tr.institucion_temporal_id\r\n          me.institucionesAsesor          = []\r\n          me.periodo_id_temporal          = tr.periodo_id\r\n          me.estado_institucion_temporal  = 1;\r\n          me.seleccionadoInsitucion       = false;\r\n        }\r\n      },\r\n      getInstitucionAsesor() {\r\n        let me = this;\r\n        me.institucionesAsesor = [];\r\n        if (me.busquedaInstitucion.length < 5) {\r\n          me.$vs.notify({\r\n            text: 'Minimo 5 caracteres de busqueda',\r\n            color: 'warning',\r\n            iconPack: 'feather',\r\n            icon: 'icon-check'\r\n          })\r\n          return false;\r\n        }\r\n        me.$vs.loading()\r\n        var url = \"\"\r\n        url = 'listaInsitucionAsesor?busqueda=' + me.busquedaInstitucion + '&todasInstituciones=yes'\r\n        this.$http.get(this.$server_url + url)\r\n          .then(function (res) {\r\n            // me.tmpInstituciones = res.data;\r\n            me.institucionesAsesor = res.data;\r\n            // me.filtroRegion();\r\n            me.$vs.loading.close()\r\n            if (res.data.message) {\r\n              me.$vs.notify({\r\n                text: res.data.message,\r\n                color: 'warning',\r\n                iconPack: 'feather',\r\n                icon: 'icon-user',\r\n                time: 8000\r\n              })\r\n            }\r\n          })\r\n          .catch(function (error) {\r\n            console.log(error + ' error');\r\n            me.$vs.loading.close()\r\n          })\r\n      },\r\n        //instituciones creadas por el asesor\r\n         getInstitucionCreadasByAsesor() {\r\n            let me = this;\r\n            me.institucionesAsesor = [];\r\n             this.$http.get(this.$server_url + 'listaInsitucionAsesor?temporales=yes'+'&asesor_id=' + me.filtro.asesor.idusuario)\r\n                .then(function (res) {\r\n                    me.institucionesAsesor = res.data;\r\n                    me.$vs.loading.close()\r\n                    if (res.data.message) {\r\n                        me.$vs.notify({\r\n                            text: res.data.message,\r\n                            color: 'success',\r\n                            iconPack: 'feather',\r\n                            icon: 'icon-user',\r\n                            time: 8000\r\n                        })\r\n                    }\r\n                })\r\n                .catch(function (error) {\r\n                    console.log(error + ' error');\r\n                    me.$vs.loading.close()\r\n                })\r\n        },\r\n        addEvent() {\r\n            let me = this\r\n            me.error = false\r\n            if (this.institucion_id == \"\" && this.institucion_id_temporal == \"\") {\r\n              if (me.longitudCapacitaciones > 1) {\r\n                me.error = true\r\n                me.messageError = \"Existe mas de 2 capacitaciones para este libro, eliga para otro dia\"\r\n                me.activePromptAddEvent = true\r\n                return false\r\n               }\r\n                me.error = true;\r\n                me.messageError = \"Seleccione una institución por favor\";\r\n                me.activePromptAddEvent = true\r\n                return false;\r\n            }\r\n            if (this.title == '' || this.startDate == '' || this.hora_inicio == null || this.hora_fin == null) {\r\n                me.error = true;\r\n                me.messageError = \"Campos con asterisco obligatorios\";\r\n                me.activePromptAddEvent = true\r\n                return false;\r\n            }\r\n            me.error= false;\r\n            //validar que selecciona los checkbox\r\n            let allFalse = Object.values(me.opciones).every(option => option === false);\r\n            if(allFalse) {\r\n              me.error = true;\r\n              me.messageError = \"Debe marcar al menos un recuadro\";\r\n              me.activePromptAddEvent = true;\r\n              return false;\r\n            }\r\n            //si el asesor agrega otra editorial debe validarse que ingrese una institucion\r\n            if (this.opciones.otraEditorial == true) {\r\n                // si es tipo de institucion  de prolipa\r\n                me.activePromptAddEvent = true\r\n                if (this.nombre_editorial == \"\") {\r\n                    me.error = true;\r\n                    me.messageError = \"Ha seleccionado otra editorial tiene que agregar una editorial por favor\";\r\n                    me.activePromptAddEvent = true\r\n                    return false;\r\n                }\r\n                if (this.estado_institucion_temporal == 0) {\r\n                    if (this.institucion_id == \"\" || this.institucion_id == null || this.institucion_id == 0 || this.institucion_id == \"null\") {\r\n                        me.error = true;\r\n                        me.messageError = \"Ha seleccionado otra editorial tiene que agregar una institución por favor\";\r\n                        me.activePromptAddEvent = true\r\n                        return false;\r\n                    }\r\n                }\r\n                if (this.estado_institucion_temporal == 1) {\r\n                    if (this.institucion_id_temporal == \"\" || this.institucion_id_temporal == null || this.institucion_id_temporal == 0 || this.institucion_id_temporal == \"null\") {\r\n                        me.error = true;\r\n                        me.messageError = \"Ha seleccionado otra editorial tiene que agregar una institución por favor\";\r\n                        me.activePromptAddEvent = true\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n            let fecha1 = null\r\n            let fecha2 = null\r\n            if(this.startDate == null || this.startDate == undefined || this.startDate == \"\" || this.startDate == \"null\"){ fecha1 = null }  else{ fecha1 = moment(this.startDate).format('YYYY-MM-DD') }\r\n            if(this.endDate == null || this.endDate == undefined || this.endDate == \"\" || this.endDate == \"null\"){ fecha2 = null }          else{ fecha2 = moment(this.endDate).format('YYYY-MM-DD') }\r\n            const obj = {\r\n                idusuario: localStorage.planificacion_asesor_id,\r\n                id: this.id,\r\n                title: this.title,\r\n                startDate: fecha1,\r\n                endDate: fecha2,\r\n                classes: 'event-' + this.labelLocal.color,\r\n                label: this.labelLocal.text,\r\n                url: this.url,\r\n                hora_inicio: this.hora_inicio.substring(0, 5),\r\n                hora_fin: this.hora_fin.substring(0, 5),\r\n                institucion_id: this.institucion_id,\r\n                opciones: this.opciones,\r\n                institucion_id_temporal: this.institucion_id_temporal,\r\n                estado_institucion_temporal: this.estado_institucion_temporal,\r\n                periodo_id_temporal: this.periodo_id_temporal,\r\n                nombreInstitucion: this.nombreInstitucion,\r\n                otraEditorial: this.opciones.otraEditorial,\r\n                nombre_editorial: this.nombre_editorial\r\n\r\n            }\r\n            if (this.id != 0,1) {\r\n               me.save(obj)\r\n            } else {\r\n                me.save(obj,0)\r\n            }\r\n        },\r\n\r\n        save(obj,tipo){\r\n            let me = this;\r\n            let formData = new FormData();\r\n            if(tipo == 0){\r\n               formData.append('id', 0);\r\n            }else{\r\n             formData.append('id', this.id);\r\n            }\r\n\r\n            formData.append('idusuario', obj.idusuario);\r\n            formData.append('title', obj.title);\r\n            formData.append('label', obj.label);\r\n            formData.append('classes', obj.classes);\r\n            formData.append('startDate', obj.startDate);\r\n            if(obj.endDate == null || obj.endDate == undefined || obj.endDate == \"\" || obj.endDate == \"null\"){\r\n            }else{\r\n              const format2 = \"YYYY-MM-DD\"\r\n              let fAsesor = null\r\n              let fVisita = null\r\n              fAsesor = moment(obj.startDate).format(format2);\r\n              fVisita = moment(obj.endDate).format(format2);\r\n              const fecha1 = new Date(fAsesor)\r\n              const fecha2 = new Date(fVisita)\r\n              var resultado = (fecha2 - fecha1) / (1000 * 60 * 60 * 24);\r\n              formData.append('dias_desface',             resultado)\r\n              formData.append('finalizar',                \"yes\");\r\n              formData.append('fecha_que_visita',         obj.endDate);\r\n            }\r\n            formData.append('hora_inicio',                obj.hora_inicio);\r\n            formData.append('hora_fin',                   obj.hora_fin);\r\n            formData.append('url',                        obj.url);\r\n            formData.append('institucion_id',             obj.institucion_id);\r\n            formData.append('opciones',                   JSON.stringify(obj.opciones));\r\n            formData.append('institucion_id_temporal',    obj.institucion_id_temporal);\r\n            formData.append('estado_institucion_temporal', obj.estado_institucion_temporal);\r\n            formData.append('periodo_id_temporal',        obj.periodo_id_temporal);\r\n            formData.append('nombreInstitucion',          obj.nombreInstitucion);\r\n            formData.append('otraEditorial',              obj.otraEditorial);\r\n            formData.append('nombre_editorial',           obj.nombre_editorial);\r\n            formData.append('admin','yes');\r\n            formData.append('usuario_editor',             me.usuario.idusuario)\r\n            me.$vs.loading()\r\n            this.$http.post(this.$server_url+'save_planificacion', formData)\r\n            .then(res => {\r\n              me.$vs.loading.close()\r\n              me.activePromptAddEvent = false;\r\n              me.limpiar();\r\n              me.getAllVisitas()\r\n              me.$vs.notify({\r\n              text:'Planificación agregada con exito',\r\n              color:'success',\r\n              iconPack: 'feather',\r\n              icon:'icon-check'})\r\n            })\r\n            .catch(function(error){\r\n                  me.$vs.loading()\r\n            });\r\n        },\r\n\r\n        openConfirmarEliminar(tr){\r\n            let me = this;\r\n              me.id = tr.id\r\n            this.$vs.dialog({\r\n                type:'confirm',\r\n                color: 'danger',\r\n                title: `Confirmar`,\r\n                text: 'Esta seguro de eliminar la planificación',\r\n                accept:this.eliminarPlanificacion\r\n            })\r\n        },\r\n        eliminarPlanificacion(){\r\n            let me = this;\r\n            let formData = new FormData();\r\n            formData.append('id', this.id);\r\n            formData.append('desactivar','yes');\r\n            formData.append('usuario_editor',me.usuario.idusuario)\r\n            me.$vs.loading()\r\n            this.$http.post(this.$server_url+'save_planificacion', formData)\r\n              .then(res => {\r\n                  me.$vs.loading.close()\r\n                  me.limpiar();\r\n                  me.getAllVisitas()\r\n                  me.$vs.notify({\r\n                  text:'Planificación eliminada con exito',\r\n                  color:'success',\r\n                  iconPack: 'feather',\r\n                  icon:'icon-check'})\r\n              })\r\n              .catch(function(error){\r\n                   me.$vs.loading()\r\n              });\r\n\r\n        },\r\n        getInstitucionInfo(tr){\r\n          let me = this;\r\n          if (tr.estado_institucion_temporal == \"1\") {\r\n            this.asesorSelect                 = me.filtro.asesor.vendedor\r\n          }else{\r\n            this.$http.get(this.$server_url+`institucionActiva?idInstitucion=${tr.institucion_id}`)\r\n              .then(function (res) {\r\n                 if(res.data.length > 0){\r\n                  let nombreAsesor = res.data[0].nombres + \" \" + res.data[0].apellidos\r\n                  me.setNombre(nombreAsesor)\r\n                 }\r\n              })\r\n              .catch(function (error) {\r\n                  console.log(error + ' error');\r\n              })\r\n          }\r\n        },\r\n        setNombre(nombre){\r\n          this.asesorSelect = nombre\r\n        },\r\n        openEditPlanificacion(tr) {\r\n          let me = this;\r\n          me.limpiar()\r\n          let datos = JSON.parse(tr.opciones)\r\n          this.id = tr.id\r\n          if(tr.title == null){\r\n            tr.title = \"\"\r\n          }else{\r\n            this.title = tr.title.split('(')[0]\r\n          }\r\n          this.startDate = tr.startDate\r\n          this.endDate = tr.fecha_que_visita\r\n          this.url = tr.url\r\n          if(tr.classes == null){\r\n          }else{\r\n            this.labelLocal = {\r\n              text: tr.label,\r\n              color: tr.classes.split('-')[1]\r\n            }\r\n          }\r\n          this.hora_inicio                = tr.hora_inicio\r\n          this.hora_fin                   = tr.hora_fin\r\n          this.label_cancel               = 'Cancelar'\r\n          this.estado                     = tr.estado\r\n          this.opciones.presentacion      = datos.presentacion\r\n          this.opciones.entrega_muestras  = datos.entrega_muestras\r\n          this.opciones.reunion           = datos.reunion\r\n          this.opciones.seguimiento       = datos.seguimiento\r\n          this.opciones.cierre            = datos.cierre\r\n          this.opciones.cobranza          = datos.cobranza\r\n          this.opciones.post_venta        = datos.post_venta\r\n          this.opciones.retiro_cartas     = datos.retiro_cartas\r\n          this.opciones.retiro_muestras   = datos.retiro_muestras\r\n          this.opciones.capacitacion      = datos.capacitacion\r\n          this.opciones.sinSello          = datos.sinSello\r\n          this.opciones.otraEditorial     = datos.otraEditorial\r\n          if (this.opciones.otraEditorial == false) {\r\n              this.nombre_editorial = \"\"\r\n          } else {\r\n              this.nombre_editorial = datos.editorial\r\n          }\r\n\r\n          if (tr.estado_institucion_temporal == \"1\") {\r\n            this.nombreInstitucion            = tr.nombre_institucion_temporal\r\n            this.institucion_id_temporal      = tr.institucion_id_temporal\r\n            this.periodo_id_temporal          = tr.periodo_id\r\n            this.estado_institucion_temporal  = 1\r\n          } else {\r\n            this.nombreInstitucion            = tr.nombreInstitucion\r\n            this.institucion_id               = tr.institucion_id\r\n            this.estado_institucion_temporal  = 0\r\n          }\r\n          this.activePromptAddEvent           = true\r\n        },\r\n        limpiar(){\r\n            let me = this;\r\n            this.labelLocal = {\r\n                text: 'Baja',\r\n                color: 'success'\r\n            }\r\n            me.startDate                = \"\"\r\n            me.endDate                  = \"\"\r\n            me.hora_inicio              = \"\"\r\n            me.hora_fin                 = \"\"\r\n            me.title                    = \"\";\r\n            me.titulo                   = \"\";\r\n            me.hora_fin                 = \"\";\r\n            me.nombre_institucion       = \"\";\r\n            me.url                      = \"\";\r\n            me.nombreInstitucion        = \"\"\r\n            me.institucion_id           = \"\"\r\n            me.institucion_id_temporal  = \"\"\r\n            me.opciones.presentacion    = false\r\n            me.opciones.entrega_muestras = false\r\n            me.opciones.reunion         = false\r\n            me.opciones.seguimiento     = false\r\n            me.opciones.cierre          = false\r\n            me.opciones.cobranza        = false\r\n            me.opciones.post_venta      = false\r\n            me.opciones.retiro_cartas   = false\r\n            me.opciones.retiro_muestras = false\r\n            me.opciones.capacitacion    = false\r\n            me.opciones.sinSello        = false\r\n            me.id = \"\"\r\n        },\r\n        //METODOS PARA EXPORTAR A EXCEL\r\n        exportToExcel() {\r\n            let headerTitle = [ 'Institucion','Periodo', 'Titulo', 'Asesor','Fecha genera visita','Fecha que visita','Dias de diferencia','estado', 'Usuario creador', 'Usuario finalizador'];\r\n            let headerVal = [ 'institucionFinal','periodo', 'title','asesor','startDate','fecha_que_visita','dias_desface','status', 'creador' ,'finalizador'];\r\n            import('@/vendor/Export2Excel').then(excel => {\r\n                const data = this.formatJson(headerVal, this.codigoSelected)\r\n                excel.export_json_to_excel({\r\n                    header: headerTitle,\r\n                    data,\r\n                    filename: this.fileName,\r\n                    autoWidth: this.cellAutoWidth,\r\n                    bookType: this.selectedFormat\r\n                })\r\n                this.clearFields()\r\n                this.guardarActivo = '';\r\n                this.generarActivo = ' ';\r\n                this.textAlertCant = '';\r\n                this.cantidad = '';\r\n                this.codigoSelected = [];\r\n            })\r\n        },\r\n\r\n        formatJson(filterVal, jsonData) {\r\n            return jsonData.map(v => filterVal.map(j => {\r\n                return v[j]\r\n            }))\r\n        },\r\n            //limpiar campos para exportar de nuevo\r\n        clearFields() {\r\n            this.fileName = ''\r\n            this.cellAutoWidth = true\r\n            this.selectedFormat = 'xls'\r\n        },\r\n        //FIN METODOS PARA EXPORTAR A EXCEL\r\n\r\n    }\r\n}\r\n</script>\r\n<style>\r\n@media(max-width: 576px) {\r\n  .filtroInstituciones{\r\n    margin-top:8px;\r\n  }\r\n}\r\n</style>\r\n"]}]}