{"remainingRequest":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\temporadas\\components\\exportContrato.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\src\\views\\temporadas\\components\\exportContrato.vue","mtime":1712682816607},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\laragon\\www\\PRY_NEW_JEYSON\\LOCAL\\plataformaprolipa_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\nimport moment from \"moment\";\r\nimport html2pdf from \"html2pdf.js\"\r\nexport default{\r\n    data(){\r\n        return{\r\n            arregloContrato:[],\r\n            arregloLibros:[],\r\n            contrato:'',\r\n            day:'',\r\n            mes:'',\r\n            year:'',\r\n            anio:'',\r\n            fecha:'',\r\n            telefono:'',\r\n            nombrearchivo:'',\r\n            //fechas generar contrato\r\n            dayGenerar:'',\r\n            mesGenerar:'',\r\n            yearGenerar:'',\r\n        }\r\n    },\r\n    props:{\r\n        id_beneficiario_pedido:{\r\n            type:Number,\r\n            default:0\r\n        },\r\n        contrato:{\r\n            type:String,\r\n            default:''\r\n        },\r\n        tipoFile:{\r\n            type:Number,\r\n            default:0\r\n        },\r\n        beneficiario:{\r\n            type:String,\r\n            default:''\r\n        }\r\n    },\r\n    computed:{\r\n        sumaTotal(){\r\n            let me = this;\r\n            if(me.arregloLibros.length >0){\r\n                let datos = me.arregloLibros.filter(p => p.subtotal)\r\n                let total = datos.reduce((a, b) => a + (b[\"subtotal\"] || 0), 0);\r\n                return total.toFixed(2)\r\n            }\r\n        },\r\n    },\r\n    created(){\r\n        let me = this;\r\n        moment.lang(\"es\")\r\n        me.day = moment().format('DD');\r\n        me.mes = moment().format('MMMM');\r\n        me.year = moment().format('YYYY')\r\n        me.fecha = me.day+'-'+me.mes.substring(0,3)+'-'+me.year\r\n        me.nombrearchivo = me.contrato+\".pdf\"\r\n        //me.contrato = me.$route.params.id\r\n    },\r\n    mounted(){\r\n        let me = this\r\n        me.getPedidos()\r\n    },\r\n    methods:{\r\n        getFechaContrato(item){\r\n            let me = this;\r\n            const fechaGenerarC =  item.fecha_generacion_contrato.substring(0,10)\r\n            me.dayGenerar       = moment(fechaGenerarC).format('DD');\r\n            me.mesGenerar       = moment(fechaGenerarC).format('MMMM');\r\n            me.yearGenerar      = moment(fechaGenerarC).format('YYYY')\r\n            var resultado       = me.dayGenerar +\" de \"+me.mesGenerar + \" \"+me.yearGenerar\r\n            return resultado\r\n        },\r\n        getPedidos(){\r\n            let me = this\r\n            me.$vs.loading();\r\n            this.$http.get(this.$server_url+'get_pedidos_periodo_Only_contrato/'+me.contrato+'/'+me.id_beneficiario_pedido)\r\n            .then(res => {\r\n                me.$vs.loading.close();\r\n                me.arregloContrato = res.data\r\n                if(me.arregloContrato[0].fecha_generacion_contrato == null || me.arregloContrato[0].fecha_generacion_contrato == \"\"  || me.arregloContrato[0].fecha_generacion_contrato == undefined){\r\n                  me.$vs.notify({\r\n                  text: \"El contrato NO tiene fecha de creación. No se puede generar el contrato....\",\r\n                  color: 'danger',\r\n                  iconPack: 'feather',\r\n                  icon: 'icon-file',\r\n                  time:4000\r\n                  })\r\n                  me.$emit('change',true)\r\n                  return\r\n                }\r\n                me.$vs.notify({\r\n                text: \"Espere mientras se va generando el archivo...\",\r\n                color: 'primary',\r\n                iconPack: 'feather',\r\n                icon: 'icon-file',\r\n                time:3000\r\n                })\r\n                me.getLibros(me.arregloContrato[0].id_pedido)\r\n                if(me.arregloContrato[0].telefonoInstitucion == \"\" || me.arregloContrato[0].telefonoInstitucion == null || me.arregloContrato[0].telefonoInstitucion == 0){\r\n                    me.telefono = \"\"\r\n                }else{\r\n                    me.telefono = \"telef. \"+me.arregloContrato[0].telefonoInstitucion+\",\"\r\n                }\r\n            })\r\n        },\r\n        getLibros(id_pedido){\r\n            let me = this\r\n            me.arregloLibros = []\r\n            // this.$http.get(this.$server_url+'get_val_pedidoInfo/'+id_pedido)\r\n            this.$http.get(this.$server_url+'get_val_pedidoInfoTodo/'+id_pedido)\r\n            .then(res => {\r\n              let datos = res.data\r\n              if(datos.length > 0){\r\n                let datos2 = datos.filter(p => p.valor > 0)\r\n                //setear ARRAY\r\n                let preSetear = []\r\n                datos2.forEach(element => {\r\n                  let cal                 = new Object();\r\n                  cal.idlibro             = element.idlibro\r\n                  cal.codigo_liquidacion  = element.codigo_liquidacion\r\n                  cal.nombrelibro         = element.nombrelibro\r\n                  cal.valor               = element.valor\r\n                  cal.precio              = element.precio\r\n                  preSetear.push(cal)\r\n                });\r\n                //Generate unique array\r\n                var preTemplate = []\r\n                datos2.forEach(element => {\r\n                  let cal = new Object();\r\n                  cal.idlibro             = element.idlibro\r\n                  cal.codigo_liquidacion  = element.codigo_liquidacion\r\n                  cal.nombrelibro         = element.nombrelibro\r\n                  cal.precio              = element.precio\r\n                  preTemplate.push(cal)\r\n                });\r\n                //CLEAR REPEAT\r\n                //quitar duplicados\r\n                let hash = {};\r\n                var preArrayUnico = []\r\n                let resultado = preTemplate.filter(o => hash[o.nombrelibro] ? false : hash[o.nombrelibro] = true);\r\n                preArrayUnico  = resultado\r\n                //////\r\n                //SUMAR VALORES PEDIDO + ALCANCES\r\n                const sumarValores = preSetear.reduce((acc,valor) =>{\r\n                  if(acc[valor.idlibro]){\r\n                    acc[valor.idlibro] += valor.valor\r\n                  }else{\r\n                    acc[valor.idlibro] = valor.valor\r\n                  }\r\n                  return acc\r\n                },{})\r\n                //PASAR AL AREGLO UNICO LOS VALORES SUMADOS POR  LIBRO\r\n                const result = preArrayUnico.map((obj) => {\r\n                    obj[\"valor\"] = sumarValores[obj.idlibro];\r\n                    return obj;\r\n                });\r\n                //OBTENER VALORES DE VALOR * CANTIDAD\r\n                var arrayListo = []\r\n                result.forEach(element => {\r\n                  let cal3 = new Object();\r\n                  cal3.idlibro            = element.idlibro\r\n                  cal3.nombrelibro        = element.nombrelibro\r\n                  cal3.codigo_liquidacion = element.codigo_liquidacion\r\n                  cal3.precio             = element.precio\r\n                  cal3.valor              = element.valor\r\n                  cal3.subtotal           = element.valor * element.precio\r\n                  arrayListo.push(cal3)\r\n                });\r\n                // console.log(\"rock\",arrayListo)\r\n                // me.arregloLibros = result\r\n\r\n                ///===ORDENAR ARRAY ==\r\n                me.arregloLibros = arrayListo.sort(function(a, b) {\r\n                var nombreA = a.nombrelibro.toLowerCase();\r\n                var nombreB = b.nombrelibro.toLowerCase();\r\n                var numA = parseInt(nombreA.match(/\\d+$/)); // extraer el número del final (si existe)\r\n                var numB = parseInt(nombreB.match(/\\d+$/)); // extraer el número del final (si existe)\r\n                nombreA = nombreA.replace(/\\d+$/, ''); // quitar el número del final\r\n                nombreB = nombreB.replace(/\\d+$/, ''); // quitar el número del final\r\n\r\n                if (nombreA < nombreB) {\r\n                    return -1;\r\n                }\r\n                if (nombreA > nombreB) {\r\n                    return 1;\r\n                }\r\n                if (numA && !numB) { // si a tiene número y b no, b va primero\r\n                    return 1;\r\n                }\r\n                if (!numA && numB) { // si b tiene número y a no, a va primero\r\n                    return -1;\r\n                }\r\n                if (numA && numB) { // si ambos tienen número, compararlos\r\n                    if (numA < 10 && numB >= 10) { // si a es menor que 10 y b es 10 o mayor, a va primero\r\n                    return -1;\r\n                    }\r\n                    if (numA >= 10 && numB < 10) { // si b es menor que 10 y a es 10 o mayor, b va primero\r\n                    return 1;\r\n                    }\r\n                    return numA - numB; // comparar los números directamente\r\n                }\r\n                return 0; // si son iguales en todo, no hay diferencia\r\n                });\r\n                if(me.tipoFile == 0){\r\n                    setTimeout(function() {me.ExportToDoc()}, 1000);\r\n                }else{\r\n                    setTimeout(function() {me.imprimirEval()}, 1000);\r\n                }\r\n              }//end if\r\n            })\r\n        },\r\n        imprimirEval(){\r\n            let me = this\r\n            var element = document.getElementById('seccionImprimir2');\r\n            // var opt = {\r\n            //     // margin:       0.5,\r\n            //     margin:         [1, 0.5, 0.5, 1],\r\n            //     filename:     me.nombrearchivo,\r\n            //     image:        { type: 'jpeg', quality: 0.98 },\r\n            //     html2canvas:    {scale: 3, letterRendering: true},\r\n            //     pagebreak:      {mode: 'avoid-all',before: \"#page2\"},\r\n            //     // jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }\r\n            //     jsPDF: {unit: 'pt', format: 'letter', orientation: 'portrait'}\r\n            // };\r\n            var opt = {\r\n                margin:       0.5,\r\n                // margin:         [1.5, 0.5, 1, 1],\r\n                filename:     me.nombrearchivo,\r\n                image:        { type: 'jpeg', quality: 0.98 },\r\n                html2canvas:    {scale: 2},\r\n                pagebreak: { mode: 'avoid-all', inside: \"avoid\", before: '#page2el' }  ,\r\n                // jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }\r\n                jsPDF: {unit: 'in', format: 'letter', orientation: 'portrait'}\r\n                //jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }\r\n            };\r\n            html2pdf().from(element).set(opt).save();\r\n            me.arregloContrato = []\r\n            me.arregloLibros   = []\r\n            me.telefono        = ''\r\n            me.$vs.notify({\r\n                text: \"Archivo descargado correctamente\",\r\n                color: 'success',\r\n                iconPack: 'feather',\r\n                icon: 'icon-file',\r\n                time:2000\r\n            })\r\n            me.$emit('change',true)\r\n        },\r\n        ExportToDoc(){\r\n            let me = this\r\n            var filename = me.nombrearchivo\r\n            var HtmlHead = \"<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export HTML To Doc</title></head><body>\";\r\n            var EndHtml = \"</body></html>\";\r\n            //complete html\r\n            var html = HtmlHead +document.getElementById(\"seccionImprimir2\").innerHTML+EndHtml;\r\n            //specify the type\r\n            var blob = new Blob(['\\ufeff', html], {\r\n                type: 'application/msword'\r\n            });\r\n            // Specify link url\r\n            var url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(html);\r\n            // Specify file name\r\n            filename = filename?filename+'.doc':'document.doc';\r\n            // Create download link element\r\n            var downloadLink = document.createElement(\"a\");\r\n            document.body.appendChild(downloadLink);\r\n            if(navigator.msSaveOrOpenBlob ){\r\n                navigator.msSaveOrOpenBlob(blob, filename);\r\n            }else{\r\n                // Create a link to the file\r\n                downloadLink.href = url;\r\n                // Setting the file name\r\n                downloadLink.download = filename;\r\n                //triggering the function\r\n                downloadLink.click();\r\n            }\r\n            document.body.removeChild(downloadLink);\r\n            me.arregloContrato = []\r\n            me.arregloLibros   = []\r\n            me.telefono        = ''\r\n            me.$vs.notify({\r\n                text: \"Archivo descargado correctamente\",\r\n                color: 'success',\r\n                iconPack: 'feather',\r\n                icon: 'icon-file',\r\n                time:2000\r\n            })\r\n            me.$emit('change',true)\r\n        },\r\n    }\r\n}\r\n",{"version":3,"sources":["exportContrato.vue"],"names":[],"mappings":";AA6IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"exportContrato.vue","sourceRoot":"src/views/temporadas/components","sourcesContent":["<template>\r\n    <div>\r\n      <vx-card id=\"seccionImprimir2\" style=\"padding-left: 35px!important;margin-right: 10px!important;\">\r\n          <p style=\"display: flex;justify-content: end;\">\r\n              <small  style=\"margin-top: -15px;text-align: right;\">{{ getFechaContrato(arregloContrato[0]) }} </small>\r\n          </p>\r\n          <h5 style=\"text-align: center;\">CONTRATO DE COMPRA - VENTA <span style=\"margin-left: 45px;\">{{ contrato }}</span></h5>\r\n          <p class=\"letra\" style=\"margin-top: 25px;\">\r\n              En la ciudad de Quito a los {{ day }} días del mes de {{ mes }} del {{ year }} convienen en celebrar el presente\r\n              CONTRATO DE COMPRA Y VENTA, por una parte {{ (arregloContrato[0].asesor).toUpperCase() }} a quien en adelante se denominará PROVEEDOR VENDEDOR\r\n              y {{ (arregloContrato[0].nombreInstitucion).toUpperCase() }} representada en este oportunidad por {{ arregloContrato[0].beneficiario.toUpperCase() }} con\r\n              C.I {{ arregloContrato[0].beneficiario_cedula }} al que en adelante  se denominará como COMPRADOR, contenido en las siguientes\r\n              clausulas:\r\n          </p>\r\n          <p class=\"mt-3 letra\">\r\n              PRIMERO.- {{ (arregloContrato[0].nombreInstitucion).toUpperCase() }}, ubicada en {{ arregloContrato[0].nombre_ciudad.toUpperCase() }}, {{ telefono }}\r\n              solicita para impartir sus clases didácticas al proveedor vendedor, los siguientes textos:\r\n          </p>\r\n          <table class=\"letra\" style=\"margin: 0 auto;margin-top: 31px;\">\r\n              <thead>\r\n                  <tr>\r\n                      <th>CODIGO</th>\r\n                      <th>DESCRIPCION</th>\r\n                      <th>CANTIDAD</th>\r\n                      <th>VALOR</th>\r\n                      <th>TOTAL</th>\r\n                  </tr>\r\n              </thead>\r\n              <tbody>\r\n                  <tr v-for=\"(tr,key) in arregloLibros\" :key=\"key\">\r\n                      <td>{{ tr.codigo_liquidacion }}</td>\r\n                      <td>{{ tr.nombrelibro.toUpperCase() }}</td>\r\n                      <td>{{ tr.valor }}</td>\r\n                      <td>{{ tr.precio}} </td>\r\n                      <td>{{ tr.subtotal.toFixed(2) }}</td>\r\n                  </tr>\r\n                  <tr>\r\n                      <td colspan=\"3\"></td>\r\n                      <td><b>TOTAL</b></td>\r\n                      <td><b>{{ sumaTotal }}</b></td>\r\n                  </tr>\r\n              </tbody>\r\n          </table>\r\n          <p class=\"letra\" style=\"margin-top: 60px;\">\r\n              SEGUNDO.- COMPROMISO DE COMPRA EL COMPRADOR, {{ (arregloContrato[0].nombreInstitucion).toUpperCase() }} a través de su\r\n              representante {{ arregloContrato[0].beneficiario.toUpperCase() }} se compromete a la adquisición\r\n              del total de los libros detallados en la claúsula primera o en cantidad mayor al\r\n              vendedor a través de listas de útiles en cualquier libreria de la localidad.\r\n          </p>\r\n          <p class=\"mt-3 letra\" v-if=\"arregloContrato[0].ifanticipo == 1\">\r\n              TERCERA.- INCENTIVO Y FORMA DE PAGO: El vendedor otorga al comprador como incentivo el {{ beneficiario.comision }}%\r\n              de descuento valor del cual se cancela por anticipado ${{ arregloContrato[0].anticipo_aprobado }} mediante\r\n              Cheque Nº: O de la cuenta Nº del No Aplica y la diferencia a la liquidación final una vez verificado el número que hayan adquirido los textos\r\n          </p>\r\n          <p class=\"mt-3 letra\" v-if=\"arregloContrato[0].ifanticipo == 0\">\r\n              TERCERA.- INCENTIVO Y FORMA DE PAGO: El vendedor otorga al comprador como incentivo el {{ beneficiario.comision }}%\r\n              de descuento asi mismo se cancelará a la liquidación final una vez verificado el número\r\n              de alumnos que hayan adquirido los textos.\r\n          </p>\r\n          <p class=\"mt-3 letra\">\r\n              CUARTO.- PLAZO DE ENTREGA EL PROVEEDOR-VENDEDOR, se compromete a entregar\r\n              oportunamente los libros requeridos por el COMPRADOR en la cantidad suficiente\r\n              para cubrir la demanda solicitada.\r\n          </p>\r\n          <p class=\"letra\">\r\n              En caso de divergencias en el contenido del presente COMPROMISO DE COMPRA-VENTA,\r\n              las partes acuerdan, en primera instancia a resolver las controversias en forma\r\n              pacifica y de no ser asi sujetarse a los jueces competentes de QUITO en\r\n              trámite verbal sumario.\r\n          </p>\r\n          <p class=\"mt-3 letra\">\r\n              Para constancia de lo anteriormente escrito, las partes suscriben el presente\r\n              compromiso en duplicado y de igual contenido.\r\n          </p>\r\n          <!-- <div class=\"flex mb-4\" style=\"margin-top: 80px;\">\r\n              <div class=\"w-1/2 p-2 bg-gray-400 text-center flex\" style=\"flex-direction: row;align-items: center;\">\r\n                  <p class=\"letra\" style=\"margin-top: 38px;\">PROVEEDOR-VENDEDOR</p>\r\n              </div>\r\n              <div class=\"w-1/2 p-2 bg-gray-500 text-left\">\r\n                  <br><br>\r\n                  <p class=\"letra\">{{ arregloContrato[0].beneficiario_nombres.toUpperCase() }}</p>\r\n                  <p class=\"letra\">{{ arregloContrato[0].beneficiario_apellidos.toUpperCase() }}</p>\r\n                  <p class=\"letra\">RUC: {{ arregloContrato[0].beneficiario_cedula }}</p>\r\n                  <p class=\"letra\">{{ (arregloContrato[0].nombreInstitucion).toUpperCase() }}</p>\r\n                  <p class=\"letra\">COMPRADOR</p>\r\n              </div>\r\n          </div> -->\r\n\r\n          <div  style=\"margin-top: 95px;display: flex;\">\r\n              <table>\r\n                  <tr>\r\n                      <td colspan=\"3\"></td>\r\n                      <td colspan=\"1\"><p class=\"letra\">{{ arregloContrato[0].beneficiario_nombres.toUpperCase() }}</p>\r\n                      </td>\r\n                  </tr>\r\n                  <tr>\r\n                      <td colspan=\"3\">PROVEEDOR-VENDEDOR</td>\r\n                      <td colspan=\"1\"><p class=\"letra\">{{ arregloContrato[0].beneficiario_apellidos.toUpperCase() }}</p>\r\n                      </td>\r\n                  </tr>\r\n                  <tr>\r\n                      <td colspan=\"3\"></td>\r\n                      <td colspan=\"1\"><p class=\"letra\">RUC: {{ arregloContrato[0].beneficiario_cedula }}</p>\r\n                      </td>\r\n                  </tr>\r\n                  <tr>\r\n                      <td colspan=\"3\"></td>\r\n                      <td colspan=\"1\"><p class=\"letra\">{{ (arregloContrato[0].nombreInstitucion).toUpperCase() }}</p>\r\n                      </td>\r\n                  </tr>\r\n                  <tr>\r\n                      <td colspan=\"3\"></td>\r\n                      <td colspan=\"1\"><p class=\"letra\">COMPRADOR</p>\r\n                      </td>\r\n                  </tr>\r\n\r\n              </table>\r\n              <!-- <div style=\"width: 20%;\">\r\n                  <p class=\"letra\" style=\"margin-top: 38px;\">PROVEEDOR-VENDEDOR</p>\r\n              </div>\r\n              <div style=\"width: 50%;\">\r\n                  <br><br>\r\n                  <p class=\"letra\">{{ arregloContrato[0].beneficiario_nombres.toUpperCase() }}</p>\r\n                  <p class=\"letra\">{{ arregloContrato[0].beneficiario_apellidos.toUpperCase() }}</p>\r\n                  <p class=\"letra\">RUC: {{ arregloContrato[0].beneficiario_cedula }}</p>\r\n                  <p class=\"letra\">{{ (arregloContrato[0].nombreInstitucion).toUpperCase() }}</p>\r\n                  <p class=\"letra\">COMPRADOR</p>\r\n              </div> -->\r\n          </div>\r\n          <p class=\"letra\" style=\"margin-top: 65px;\">\r\n              Elaborado por: {{ (arregloContrato[0].facturador).toUpperCase() }}\r\n          </p>\r\n          <!-- {{ arregloContrato }} -->\r\n      </vx-card>\r\n      <div class=\"w-full p-2 bg-gray-400 text-center\">\r\n          <vs-button color=\"primary\" @click=\"ExportToDoc()\" type=\"border\">Imprimir</vs-button>\r\n      </div>\r\n    </div>\r\n\r\n</template>\r\n<script>\r\nimport moment from \"moment\";\r\nimport html2pdf from \"html2pdf.js\"\r\nexport default{\r\n    data(){\r\n        return{\r\n            arregloContrato:[],\r\n            arregloLibros:[],\r\n            contrato:'',\r\n            day:'',\r\n            mes:'',\r\n            year:'',\r\n            anio:'',\r\n            fecha:'',\r\n            telefono:'',\r\n            nombrearchivo:'',\r\n            //fechas generar contrato\r\n            dayGenerar:'',\r\n            mesGenerar:'',\r\n            yearGenerar:'',\r\n        }\r\n    },\r\n    props:{\r\n        id_beneficiario_pedido:{\r\n            type:Number,\r\n            default:0\r\n        },\r\n        contrato:{\r\n            type:String,\r\n            default:''\r\n        },\r\n        tipoFile:{\r\n            type:Number,\r\n            default:0\r\n        },\r\n        beneficiario:{\r\n            type:String,\r\n            default:''\r\n        }\r\n    },\r\n    computed:{\r\n        sumaTotal(){\r\n            let me = this;\r\n            if(me.arregloLibros.length >0){\r\n                let datos = me.arregloLibros.filter(p => p.subtotal)\r\n                let total = datos.reduce((a, b) => a + (b[\"subtotal\"] || 0), 0);\r\n                return total.toFixed(2)\r\n            }\r\n        },\r\n    },\r\n    created(){\r\n        let me = this;\r\n        moment.lang(\"es\")\r\n        me.day = moment().format('DD');\r\n        me.mes = moment().format('MMMM');\r\n        me.year = moment().format('YYYY')\r\n        me.fecha = me.day+'-'+me.mes.substring(0,3)+'-'+me.year\r\n        me.nombrearchivo = me.contrato+\".pdf\"\r\n        //me.contrato = me.$route.params.id\r\n    },\r\n    mounted(){\r\n        let me = this\r\n        me.getPedidos()\r\n    },\r\n    methods:{\r\n        getFechaContrato(item){\r\n            let me = this;\r\n            const fechaGenerarC =  item.fecha_generacion_contrato.substring(0,10)\r\n            me.dayGenerar       = moment(fechaGenerarC).format('DD');\r\n            me.mesGenerar       = moment(fechaGenerarC).format('MMMM');\r\n            me.yearGenerar      = moment(fechaGenerarC).format('YYYY')\r\n            var resultado       = me.dayGenerar +\" de \"+me.mesGenerar + \" \"+me.yearGenerar\r\n            return resultado\r\n        },\r\n        getPedidos(){\r\n            let me = this\r\n            me.$vs.loading();\r\n            this.$http.get(this.$server_url+'get_pedidos_periodo_Only_contrato/'+me.contrato+'/'+me.id_beneficiario_pedido)\r\n            .then(res => {\r\n                me.$vs.loading.close();\r\n                me.arregloContrato = res.data\r\n                if(me.arregloContrato[0].fecha_generacion_contrato == null || me.arregloContrato[0].fecha_generacion_contrato == \"\"  || me.arregloContrato[0].fecha_generacion_contrato == undefined){\r\n                  me.$vs.notify({\r\n                  text: \"El contrato NO tiene fecha de creación. No se puede generar el contrato....\",\r\n                  color: 'danger',\r\n                  iconPack: 'feather',\r\n                  icon: 'icon-file',\r\n                  time:4000\r\n                  })\r\n                  me.$emit('change',true)\r\n                  return\r\n                }\r\n                me.$vs.notify({\r\n                text: \"Espere mientras se va generando el archivo...\",\r\n                color: 'primary',\r\n                iconPack: 'feather',\r\n                icon: 'icon-file',\r\n                time:3000\r\n                })\r\n                me.getLibros(me.arregloContrato[0].id_pedido)\r\n                if(me.arregloContrato[0].telefonoInstitucion == \"\" || me.arregloContrato[0].telefonoInstitucion == null || me.arregloContrato[0].telefonoInstitucion == 0){\r\n                    me.telefono = \"\"\r\n                }else{\r\n                    me.telefono = \"telef. \"+me.arregloContrato[0].telefonoInstitucion+\",\"\r\n                }\r\n            })\r\n        },\r\n        getLibros(id_pedido){\r\n            let me = this\r\n            me.arregloLibros = []\r\n            // this.$http.get(this.$server_url+'get_val_pedidoInfo/'+id_pedido)\r\n            this.$http.get(this.$server_url+'get_val_pedidoInfoTodo/'+id_pedido)\r\n            .then(res => {\r\n              let datos = res.data\r\n              if(datos.length > 0){\r\n                let datos2 = datos.filter(p => p.valor > 0)\r\n                //setear ARRAY\r\n                let preSetear = []\r\n                datos2.forEach(element => {\r\n                  let cal                 = new Object();\r\n                  cal.idlibro             = element.idlibro\r\n                  cal.codigo_liquidacion  = element.codigo_liquidacion\r\n                  cal.nombrelibro         = element.nombrelibro\r\n                  cal.valor               = element.valor\r\n                  cal.precio              = element.precio\r\n                  preSetear.push(cal)\r\n                });\r\n                //Generate unique array\r\n                var preTemplate = []\r\n                datos2.forEach(element => {\r\n                  let cal = new Object();\r\n                  cal.idlibro             = element.idlibro\r\n                  cal.codigo_liquidacion  = element.codigo_liquidacion\r\n                  cal.nombrelibro         = element.nombrelibro\r\n                  cal.precio              = element.precio\r\n                  preTemplate.push(cal)\r\n                });\r\n                //CLEAR REPEAT\r\n                //quitar duplicados\r\n                let hash = {};\r\n                var preArrayUnico = []\r\n                let resultado = preTemplate.filter(o => hash[o.nombrelibro] ? false : hash[o.nombrelibro] = true);\r\n                preArrayUnico  = resultado\r\n                //////\r\n                //SUMAR VALORES PEDIDO + ALCANCES\r\n                const sumarValores = preSetear.reduce((acc,valor) =>{\r\n                  if(acc[valor.idlibro]){\r\n                    acc[valor.idlibro] += valor.valor\r\n                  }else{\r\n                    acc[valor.idlibro] = valor.valor\r\n                  }\r\n                  return acc\r\n                },{})\r\n                //PASAR AL AREGLO UNICO LOS VALORES SUMADOS POR  LIBRO\r\n                const result = preArrayUnico.map((obj) => {\r\n                    obj[\"valor\"] = sumarValores[obj.idlibro];\r\n                    return obj;\r\n                });\r\n                //OBTENER VALORES DE VALOR * CANTIDAD\r\n                var arrayListo = []\r\n                result.forEach(element => {\r\n                  let cal3 = new Object();\r\n                  cal3.idlibro            = element.idlibro\r\n                  cal3.nombrelibro        = element.nombrelibro\r\n                  cal3.codigo_liquidacion = element.codigo_liquidacion\r\n                  cal3.precio             = element.precio\r\n                  cal3.valor              = element.valor\r\n                  cal3.subtotal           = element.valor * element.precio\r\n                  arrayListo.push(cal3)\r\n                });\r\n                // console.log(\"rock\",arrayListo)\r\n                // me.arregloLibros = result\r\n\r\n                ///===ORDENAR ARRAY ==\r\n                me.arregloLibros = arrayListo.sort(function(a, b) {\r\n                var nombreA = a.nombrelibro.toLowerCase();\r\n                var nombreB = b.nombrelibro.toLowerCase();\r\n                var numA = parseInt(nombreA.match(/\\d+$/)); // extraer el número del final (si existe)\r\n                var numB = parseInt(nombreB.match(/\\d+$/)); // extraer el número del final (si existe)\r\n                nombreA = nombreA.replace(/\\d+$/, ''); // quitar el número del final\r\n                nombreB = nombreB.replace(/\\d+$/, ''); // quitar el número del final\r\n\r\n                if (nombreA < nombreB) {\r\n                    return -1;\r\n                }\r\n                if (nombreA > nombreB) {\r\n                    return 1;\r\n                }\r\n                if (numA && !numB) { // si a tiene número y b no, b va primero\r\n                    return 1;\r\n                }\r\n                if (!numA && numB) { // si b tiene número y a no, a va primero\r\n                    return -1;\r\n                }\r\n                if (numA && numB) { // si ambos tienen número, compararlos\r\n                    if (numA < 10 && numB >= 10) { // si a es menor que 10 y b es 10 o mayor, a va primero\r\n                    return -1;\r\n                    }\r\n                    if (numA >= 10 && numB < 10) { // si b es menor que 10 y a es 10 o mayor, b va primero\r\n                    return 1;\r\n                    }\r\n                    return numA - numB; // comparar los números directamente\r\n                }\r\n                return 0; // si son iguales en todo, no hay diferencia\r\n                });\r\n                if(me.tipoFile == 0){\r\n                    setTimeout(function() {me.ExportToDoc()}, 1000);\r\n                }else{\r\n                    setTimeout(function() {me.imprimirEval()}, 1000);\r\n                }\r\n              }//end if\r\n            })\r\n        },\r\n        imprimirEval(){\r\n            let me = this\r\n            var element = document.getElementById('seccionImprimir2');\r\n            // var opt = {\r\n            //     // margin:       0.5,\r\n            //     margin:         [1, 0.5, 0.5, 1],\r\n            //     filename:     me.nombrearchivo,\r\n            //     image:        { type: 'jpeg', quality: 0.98 },\r\n            //     html2canvas:    {scale: 3, letterRendering: true},\r\n            //     pagebreak:      {mode: 'avoid-all',before: \"#page2\"},\r\n            //     // jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }\r\n            //     jsPDF: {unit: 'pt', format: 'letter', orientation: 'portrait'}\r\n            // };\r\n            var opt = {\r\n                margin:       0.5,\r\n                // margin:         [1.5, 0.5, 1, 1],\r\n                filename:     me.nombrearchivo,\r\n                image:        { type: 'jpeg', quality: 0.98 },\r\n                html2canvas:    {scale: 2},\r\n                pagebreak: { mode: 'avoid-all', inside: \"avoid\", before: '#page2el' }  ,\r\n                // jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }\r\n                jsPDF: {unit: 'in', format: 'letter', orientation: 'portrait'}\r\n                //jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }\r\n            };\r\n            html2pdf().from(element).set(opt).save();\r\n            me.arregloContrato = []\r\n            me.arregloLibros   = []\r\n            me.telefono        = ''\r\n            me.$vs.notify({\r\n                text: \"Archivo descargado correctamente\",\r\n                color: 'success',\r\n                iconPack: 'feather',\r\n                icon: 'icon-file',\r\n                time:2000\r\n            })\r\n            me.$emit('change',true)\r\n        },\r\n        ExportToDoc(){\r\n            let me = this\r\n            var filename = me.nombrearchivo\r\n            var HtmlHead = \"<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export HTML To Doc</title></head><body>\";\r\n            var EndHtml = \"</body></html>\";\r\n            //complete html\r\n            var html = HtmlHead +document.getElementById(\"seccionImprimir2\").innerHTML+EndHtml;\r\n            //specify the type\r\n            var blob = new Blob(['\\ufeff', html], {\r\n                type: 'application/msword'\r\n            });\r\n            // Specify link url\r\n            var url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(html);\r\n            // Specify file name\r\n            filename = filename?filename+'.doc':'document.doc';\r\n            // Create download link element\r\n            var downloadLink = document.createElement(\"a\");\r\n            document.body.appendChild(downloadLink);\r\n            if(navigator.msSaveOrOpenBlob ){\r\n                navigator.msSaveOrOpenBlob(blob, filename);\r\n            }else{\r\n                // Create a link to the file\r\n                downloadLink.href = url;\r\n                // Setting the file name\r\n                downloadLink.download = filename;\r\n                //triggering the function\r\n                downloadLink.click();\r\n            }\r\n            document.body.removeChild(downloadLink);\r\n            me.arregloContrato = []\r\n            me.arregloLibros   = []\r\n            me.telefono        = ''\r\n            me.$vs.notify({\r\n                text: \"Archivo descargado correctamente\",\r\n                color: 'success',\r\n                iconPack: 'feather',\r\n                icon: 'icon-file',\r\n                time:2000\r\n            })\r\n            me.$emit('change',true)\r\n        },\r\n    }\r\n}\r\n</script>\r\n<style scoped>\r\n.html2canvas-container { width: 3000px !important; height: 3000px !important; }\r\n*{\r\n    font-family: Arial;\r\n}\r\n.letra{\r\n    padding:0px 60px 0px 0px;\r\n    font-size: 11px;\r\n}\r\ntable {\r\n  table-layout: fixed;\r\n  width: 90%;\r\n  border-collapse: collapse;\r\n  border: none;\r\n}\r\nth{\r\n    text-decoration: underline;\r\n}\r\nthead th:nth-child(1) {\r\n  width: 10%;\r\n}\r\n\r\nthead th:nth-child(2) {\r\n  width: 30%;\r\n}\r\n\r\nthead th:nth-child(3) {\r\n  width: 15%;\r\n}\r\n\r\nthead th:nth-child(4) {\r\n  width: 15%;\r\n}\r\nthead th:nth-child(5) {\r\n  width: 20%;\r\n}\r\n@media print {\r\n    td {page-break-before: always;}\r\n    p  {page-break-before: always;}\r\n}\r\n/* th, td {\r\n  padding: 20px;\r\n} */\r\n</style>\r\n"]}]}